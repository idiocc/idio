{
"version":3,
"file":"compile/idio.js",
"lineCount":3393,
"mappings":"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",
"sources":["node_modules/@goa/compose/src/index.js","node_modules/@goa/statuses/src/codes.js","node_modules/@goa/statuses/src/index.js","node_modules/@goa/http-errors/src/index.js","node_modules/assert/index.js","node_modules/tty/index.js","node_modules/util/index.js","node_modules/@idio/debug/src/ms.js","node_modules/@idio/debug/src/bytes.js","node_modules/erte/src/index.js","node_modules/@idio/debug/src/modifiers/f.js","node_modules/@idio/debug/src/node.js","node_modules/@idio/debug/src/common.js","node_modules/@idio/debug/src/index.js","modules/koa-mount/index.js","node_modules/crypto/index.js","node_modules/@goa/cookies/src/keygrip-lib/sign.js","node_modules/@goa/cookies/src/keygrip-lib/ctc.js","node_modules/@goa/cookies/src/Keygrip.js","node_modules/@goa/uuid/src/rng.js","node_modules/@goa/uuid/src/bytes-to-uuid.js","node_modules/@goa/uuid/src/index.js","node_modules/@goa/session/src/lib/session.js","node_modules/@goa/session/src/lib/util.js","node_modules/@goa/session/src/lib/context.js","node_modules/@goa/session/src/index.js","node_modules/@goa/vary/src/index.js","node_modules/@goa/cors/src/index.js","node_modules/path/index.js","node_modules/fs/index.js","node_modules/erotic/src/lib.js","node_modules/os/index.js","node_modules/@artdeco/clean-stack/src/index.js","node_modules/erotic/src/callback.js","node_modules/erotic/src/index.js","node_modules/makepromise/src/index.js","modules/resolve-path/index.js","modules/koa-send/index.js","modules/koa-static/index.js","node_modules/@goa/compress/src/compressible.js","node_modules/@goa/goa/modules/koa-is-json/index.js","node_modules/stream/index.js","node_modules/zlib/index.js","node_modules/@goa/compress/src/bytes/index.js","node_modules/@goa/compress/src/index.js","src/setup-middleware.js","node_modules/@goa/is-generator-function/src/index.js","node_modules/http/index.js","node_modules/events/index.js","node_modules/@goa/goa/modules/ee-first/index.js","node_modules/@goa/goa/modules/on-finished/index.js","node_modules/@goa/goa/modules/destroy.js","node_modules/@goa/mime-types/src/index.js","node_modules/@goa/content-type/src/index.js","node_modules/@goa/type-is/src/media-typer.js","node_modules/@goa/type-is/src/index.js","node_modules/@goa/goa/modules/content-disposition/index.js","node_modules/@goa/goa/modules/error-inject/index.js","node_modules/@goa/goa/modules/cache-content-type/index.js","node_modules/@goa/goa/modules/escape-html/index.js","node_modules/@goa/cookies/src/Cookie.js","node_modules/@goa/cookies/src/index.js","node_modules/@goa/negotiator/src/lib/charset.js","node_modules/@goa/negotiator/src/lib/encoding.js","node_modules/@goa/negotiator/src/lib/language.js","node_modules/@goa/negotiator/src/lib/mediaType.js","node_modules/@goa/negotiator/src/index.js","node_modules/@goa/accepts/src/index.js","node_modules/@goa/goa/modules/delegates/index.js","node_modules/@goa/goa/modules/http-assert/index.js","node_modules/url/index.js","node_modules/net/index.js","node_modules/querystring/index.js","node_modules/@goa/goa/modules/parseurl/index.js","node_modules/@goa/goa/modules/fresh/index.js","node_modules/@goa/goa/src/request.js","node_modules/@goa/goa/src/context.js","node_modules/@goa/goa/src/response.js","node_modules/@goa/goa/src/application.js","node_modules/@goa/router/src/path-to-regexp.js","node_modules/@goa/router/src/layer.js","node_modules/@goa/router/src/index.js","src/idio.js","src/lib.js","src/start-app.js","src/depack.js"],
"sourcesContent":["/**\n * Compose `middleware` returning a fully valid middleware comprised of all those which are passed.\n * @param {!Array<!Function>} middleware\n */\nexport default function compose(middleware) {\n  if (!Array.isArray(middleware))\n    throw new TypeError('Middleware stack must be an array!')\n  for (const fn of middleware) {\n    if (typeof fn != 'function')\n      throw new TypeError('Middleware must be composed of functions!')\n  }\n\n  return (context, next) => {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n\n    function dispatch(i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i == middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)))\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n\n/**\n * @license MIT\n * (c) dead-horse\n * https://npmjs.org/koa-compose\n */","export default {\n  [100]: 'Continue',\n  [101]: 'Switching Protocols',\n  [102]: 'Processing',\n  [103]: 'Early Hints',\n  [200]: 'OK',\n  [201]: 'Created',\n  [202]: 'Accepted',\n  [203]: 'Non-Authoritative Information',\n  [204]: 'No Content',\n  [205]: 'Reset Content',\n  [206]: 'Partial Content',\n  [207]: 'Multi-Status',\n  [208]: 'Already Reported',\n  [226]: 'IM Used',\n  [300]: 'Multiple Choices',\n  [301]: 'Moved Permanently',\n  [302]: 'Found',\n  [303]: 'See Other',\n  [304]: 'Not Modified',\n  [305]: 'Use Proxy',\n  [306]: '(Unused)',\n  [307]: 'Temporary Redirect',\n  [308]: 'Permanent Redirect',\n  [400]: 'Bad Request',\n  [401]: 'Unauthorized',\n  [402]: 'Payment Required',\n  [403]: 'Forbidden',\n  [404]: 'Not Found',\n  [405]: 'Method Not Allowed',\n  [406]: 'Not Acceptable',\n  [407]: 'Proxy Authentication Required',\n  [408]: 'Request Timeout',\n  [409]: 'Conflict',\n  [410]: 'Gone',\n  [411]: 'Length Required',\n  [412]: 'Precondition Failed',\n  [413]: 'Payload Too Large',\n  [414]: 'URI Too Long',\n  [415]: 'Unsupported Media Type',\n  [416]: 'Range Not Satisfiable',\n  [417]: 'Expectation Failed',\n  [418]: 'I\\'m a teapot',\n  [421]: 'Misdirected Request',\n  [422]: 'Unprocessable Entity',\n  [423]: 'Locked',\n  [424]: 'Failed Dependency',\n  [425]: 'Unordered Collection',\n  [426]: 'Upgrade Required',\n  [428]: 'Precondition Required',\n  [429]: 'Too Many Requests',\n  [431]: 'Request Header Fields Too Large',\n  [451]: 'Unavailable For Legal Reasons',\n  [500]: 'Internal Server Error',\n  [501]: 'Not Implemented',\n  [502]: 'Bad Gateway',\n  [503]: 'Service Unavailable',\n  [504]: 'Gateway Timeout',\n  [505]: 'HTTP Version Not Supported',\n  [506]: 'Variant Also Negotiates',\n  [507]: 'Insufficient Storage',\n  [508]: 'Loop Detected',\n  [509]: 'Bandwidth Limit Exceeded',\n  [510]: 'Not Extended',\n  [511]: 'Network Authentication Required',\n}\n","/*!\n * statuses\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2016 Douglas Christopher Wilson\n * MIT Licensed\n */\nimport statusCodes from './codes'\n\n// status code to message map\nexport const STATUS_CODES = statusCodes\n\n// array of status codes\nexport const codes = populateStatusesMap(status, statusCodes)\n\n// status codes for redirects\nexport const redirect = {\n  [300]: true,\n  [301]: true,\n  [302]: true,\n  [303]: true,\n  [305]: true,\n  [307]: true,\n  [308]: true,\n}\n\n// status codes for empty bodies\nexport const empty = {\n  [204]: true,\n  [205]: true,\n  [304]: true,\n}\n\n// status codes for when you should retry the request\nexport const retry = {\n  [502]: true,\n  [503]: true,\n  [504]: true,\n}\n\n/**\n * Populate the statuses map for given codes.\n * @return {!Array<string>}\n * @private\n */\nfunction populateStatusesMap(statuses, allCodes) {\n  const arr = []\n\n  Object.keys(allCodes).forEach((code) => {\n    const message = statusCodes[code]\n    const s = Number(code)\n\n    // Populate properties\n    statuses[s] = message\n    statuses[message] = s\n    statuses[message.toLowerCase()] = s\n\n    // Add to array\n    arr.push(s)\n  })\n\n  return arr\n}\n\n/**\n * @param {string|number} code\n */\nexport default function status(code) {\n  if (typeof code == 'number') {\n    if (!status[code])\n      throw new Error('invalid status code: ' + code)\n    return code\n  }\n\n  if (typeof code != 'string')\n    throw new TypeError('code must be a number or string')\n\n  // '403'\n  var n = parseInt(code, 10)\n  if (!isNaN(n)) {\n    if (!status[n]) throw new Error('invalid status code: ' + n)\n    return n\n  }\n\n  n = status[code.toLowerCase()]\n  if (!n) throw new Error('invalid status message: \"' + code + '\"')\n  return n\n}\n","/*!\n * http-errors\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\nimport statuses, { codes } from '@goa/statuses'\n\nconst deprecate = (msg) => {\n  process.emitWarning(msg, 'DeprecationWarning')\n}\n\n/**\n * Get the code class of a status code.\n * @private\n */\nfunction codeClass(status) {\n  return Number(String(status).charAt(0) + '00')\n}\n\n/**\n * Create a new HTTP Error.\n * @param {...Error|string|number} args\n */\nexport default function createError(...args) {\n  // so much arity going on ~_~\n  let err\n  let msg\n  let status = 500\n  let props = {}\n  for (let i = 0; i < args.length; i++) {\n    let arg = args[i]\n    if (arg instanceof Error) {\n      err = arg\n      status = err.status || err.statusCode || status\n      continue\n    }\n    switch (typeof arg) {\n    case 'string':\n      msg = arg\n      break\n    case 'number':\n      status = arg\n      if (i !== 0) {\n        deprecate('non-first-argument status code; replace with createError(' + arg + ', ...)')\n      }\n      break\n    case 'object':\n      props = arg\n      break\n    }\n  }\n\n  if (typeof status == 'number' && (status < 400 || status >= 600)) {\n    deprecate('non-error status code; use only 4xx or 5xx status codes')\n  }\n\n  if (typeof status != 'number' ||\n    (!statuses[status] && (status < 400 || status >= 600))) {\n    status = 500\n  }\n\n  // constructor\n  const HttpError = createError[status] || createError[codeClass(status)]\n\n  if (!err) {\n    // create error\n    err = HttpError\n      ? new HttpError(msg)\n      : new Error(msg || statuses[status])\n    Error.captureStackTrace(err, createError)\n  }\n\n  if (!HttpError || !(err instanceof HttpError) || err.status !== status) {\n    // add properties to generic error\n    err.expose = status < 500\n    err.status = err.statusCode = status\n  }\n\n  for (let key in props) {\n    if (key != 'status' && key != 'statusCode') {\n      err[key] = props[key]\n    }\n  }\n\n  return err\n}\n\n/**\n * @implements {_httpErrors.HttpError}\n */\nexport class HttpError extends Error {\n  constructor(message) {\n    super()\n    this.message = message\n    this.status = null\n    this.statusCode = null\n    this.expose = false\n    this.headers = null\n  }\n  set code(code) {\n    this.status = code\n    this.statusCode = code\n    if (!this.message) this.message = statuses[code]\n  }\n}\n\ncodes.forEach((code) => {\n  let CodeError\n  const name = toIdentifier(statuses[code])\n  const className = name.match(/Error$/) ? name : name + 'Error'\n\n  switch (codeClass(code)) {\n  case 400:\n    CodeError = class ClientError extends HttpError {\n      constructor(message) {\n        super(message)\n        this.code = code\n        this.name = className\n        this.expose = true\n      }\n    }\n    break\n  case 500:\n    CodeError = class ServerError extends HttpError {\n      constructor(message) {\n        super(message)\n        this.code = code\n        this.name = className\n        this.expose = false\n      }\n    }\n    break\n  }\n\n  if (CodeError) {\n    // export the constructor\n    createError[code] = CodeError\n    createError[name] = CodeError\n  }\n}, {})\n\n\n\n/**\n * Transform the given string into a JavaScript identifier\n * @param {string} str\n */\nfunction toIdentifier(str) {\n  return str\n    .split(' ')\n    .map(function (token) {\n      return token.slice(0, 1).toUpperCase() + token.slice(1)\n    })\n    .join('')\n    .replace(/[^ _0-9a-z]/gi, '')\n}\n\n/*!\n * toidentifier\n * Copyright(c) 2016 Douglas Christopher Wilson\n * MIT Licensed\n */","export default assert\nexport const {\n  AssertionError,\n  deepEqual,\n  deepStrictEqual,\n  doesNotThrow,\n  equal,\n  fail,\n  ifError,\n  notDeepEqual,\n  notDeepStrictEqual,\n  notEqual,\n  notStrictEqual,\n  ok,\n  strictEqual,\n  throws,\n} = assert","export default tty\nexport const {\n  ReadStream,\n  WriteStream,\n  isatty,\n} = tty","export default util\nexport const {\n  TextDecoder,\n  TextEncoder,\n  callbackify,\n  debug,\n  debuglog,\n  deprecate,\n  error,\n  format,\n  getSystemErrorName,\n  inherits,\n  inspect,\n  isArray,\n  isBoolean,\n  isBuffer,\n  isDate,\n  isError,\n  isFunction,\n  isNull,\n  isNullOrUndefined,\n  isNumber,\n  isObject,\n  isPrimitive,\n  isRegExp,\n  isString,\n  isSymbol,\n  isUndefined,\n  log,\n  print,\n  promisify,\n  puts,\n} = util","/**\n * Helpers.\n */\n\nvar s = 1000\nvar m = s * 60\nvar h = m * 60\nvar d = h * 24\nvar w = d * 7\nvar y = d * 365.25\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {string|number} val\n * @param {Object} [options]\n */\nexport default function(val, options = {}) {\n  var type = typeof val\n  if (type == 'string' && val.length > 0) {\n    const t = /** @type {string} */ (val)\n    return parse(t)\n  } else if (type == 'number' && isFinite(val)) {\n    const n = /** @type {number} */ (val)\n    return options.long ? fmtLong(n) : fmtShort(n)\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  )\n}\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {string} str\n * @api private\n */\nfunction parse(str) {\n  str = String(str)\n  if (str.length > 100) {\n    return\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  )\n  if (!match) {\n    return\n  }\n  var n = parseFloat(match[1])\n  var type = (match[2] || 'ms').toLowerCase()\n  switch (type) {\n  case 'years':\n  case 'year':\n  case 'yrs':\n  case 'yr':\n  case 'y':\n    return n * y\n  case 'weeks':\n  case 'week':\n  case 'w':\n    return n * w\n  case 'days':\n  case 'day':\n  case 'd':\n    return n * d\n  case 'hours':\n  case 'hour':\n  case 'hrs':\n  case 'hr':\n  case 'h':\n    return n * h\n  case 'minutes':\n  case 'minute':\n  case 'mins':\n  case 'min':\n  case 'm':\n    return n * m\n  case 'seconds':\n  case 'second':\n  case 'secs':\n  case 'sec':\n  case 's':\n    return n * s\n  case 'milliseconds':\n  case 'millisecond':\n  case 'msecs':\n  case 'msec':\n  case 'ms':\n    return n\n  default:\n    return undefined\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {number} ms\n * @api private\n */\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms)\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd'\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h'\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm'\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's'\n  }\n  return ms + 'ms'\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {number} ms\n * @api private\n */\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms)\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day')\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour')\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute')\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second')\n  }\n  return ms + ' ms'\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '')\n}\n\n/**\n * @license\n * Copyright (c) 2016 Zeit, Inc.\n * https://npmjs.org/ms\n */","/*!\n * bytes\n * Copyright(c) 2012-2014 TJ Holowaychuk\n * Copyright(c) 2015 Jed Watson\n * MIT Licensed\n */\n\nconst formatThousandsRegExp = /\\B(?=(\\d{3})+(?!\\d))/g\nconst formatDecimalsRegExp = /(?:\\.0*|(\\.[^0]+)0+)$/\n\nconst map = {\n  'b':  1,\n  'kb': 1 << 10,\n  'mb': 1 << 20,\n  'gb': 1 << 30,\n  'tb': Math.pow(1024, 4),\n  'pb': Math.pow(1024, 5),\n}\n\nconst parseRegExp = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb|pb)$/i\n\n/**\n * Convert the given value in bytes into a string or parse to string to an integer in bytes.\n *\n * @param {string|number} value\n * @param {{\n *  case: (string|undefined),\n *  decimalPlaces: (number|undefined),\n *  fixedDecimals: (boolean|undefined),\n *  thousandsSeparator: (string|undefined),\n *  unitSeparator: (string|undefined),\n *  }} [options] bytes options.\n *\n * @returns {?(string|number)}\n */\n\nexport default function bytes(value, options) {\n  if (typeof value == 'string') {\n    return parse(value)\n  }\n\n  if (typeof value == 'number') {\n    return format(value, options)\n  }\n\n  return null\n}\n\n/**\n * Format the given value in bytes into a string.\n *\n * If the value is negative, it is kept as such. If it is a float,\n * it is rounded.\n *\n * @param {number} value\n * @param {Object} [options]\n * @param {number} [options.decimalPlaces=2]\n * @param {number} [options.fixedDecimals=false]\n * @param {string} [options.thousandsSeparator=]\n * @param {string} [options.unit=]\n * @param {string} [options.unitSeparator=]\n * @returns {?string}\n */\nexport function format(value, options) {\n  if (!Number.isFinite(value)) {\n    return null\n  }\n\n  const mag = Math.abs(value)\n  const thousandsSeparator = (options && options.thousandsSeparator) || ''\n  const unitSeparator = (options && options.unitSeparator) || ''\n  const decimalPlaces = (options && options.decimalPlaces !== undefined) ? options.decimalPlaces : 2\n  const fixedDecimals = Boolean(options && options.fixedDecimals)\n  let unit = (options && options.unit) || ''\n\n  if (!unit || !map[unit.toLowerCase()]) {\n    if (mag >= map['pb']) {\n      unit = 'PB'\n    } else if (mag >= map['tb']) {\n      unit = 'TB'\n    } else if (mag >= map['gb']) {\n      unit = 'GB'\n    } else if (mag >= map['mb']) {\n      unit = 'MB'\n    } else if (mag >= map['kb']) {\n      unit = 'KB'\n    } else {\n      unit = 'B'\n    }\n  }\n\n  const val = value / map[unit.toLowerCase()]\n  let str = val.toFixed(decimalPlaces)\n\n  if (!fixedDecimals) {\n    str = str.replace(formatDecimalsRegExp, '$1')\n  }\n\n  if (thousandsSeparator) {\n    str = str.replace(formatThousandsRegExp, thousandsSeparator)\n  }\n\n  return str + unitSeparator + unit\n}\n\n/**\n * Parse the string value into an integer in bytes.\n *\n * If no unit is given, it is assumed the value is in bytes.\n *\n * @param {number|string} val\n *\n * @returns {number|null}\n * @public\n */\n\nexport function parse(val) {\n  if (typeof val == 'number' && !isNaN(val)) {\n    return val\n  }\n\n  if (typeof val != 'string') {\n    return null\n  }\n\n  // Test if the string passed is valid\n  const results = parseRegExp.exec(val)\n  let floatValue, unit = 'b'\n\n  if (!results) {\n    // Nothing could be extracted from the given string\n    floatValue = parseInt(val, 10)\n    unit = 'b'\n  } else {\n    // Retrieve the value and the unit\n    floatValue = parseFloat(results[1])\n    unit = results[4].toLowerCase()\n  }\n\n  return Math.floor(map[unit] * floatValue)\n}","import Diff from './diff'\n\nconst colors = {\n  'black': 30,\n  'red': 31,\n  'green': 32,\n  'yellow': 33,\n  'blue': 34,\n  'magenta': 35,\n  'cyan': 36,\n  'white': 37,\n  'grey': 90,\n}\n\nconst backgroundColors = {\n  'black': 40,\n  'red': 41,\n  'green': 42,\n  'yellow': 43,\n  'blue': 44,\n  'magenta': 45,\n  'cyan': 46,\n  'white': 47,\n}\n\n/**\n * Color the foreground.\n * @param {string} string The string to color.\n * @param {_erte.Color} color The color to apply.\n */\nexport function c(string, color) {\n  const cc = colors[color]\n  if (!cc) return string\n  return `\\x1b[${cc}m${string}\\x1b[0m`\n}\n\n/**\n * Color the background.\n * @param {string} string The string to color.\n * @param {_erte.Color} color The color to apply.\n */\nexport function b(string, color) {\n  const cc = backgroundColors[color]\n  if (!cc) return string\n  return `\\x1b[${cc}m${string}\\x1b[0m`\n}\n\n/**\n * Compares two strings and outputs a coloured version where strings don't match.\n * @param {string} source A string to compare.\n * @param {string} target Target string to compare with.\n * @returns {string} A string which uses shell-codes to highligh differences.\n */\nexport default function erte(source, target) {\n  const diff = new Diff()\n  const d = diff.diff(source, target)\n  const m = d.map(({ added, removed, value }) => {\n    let p\n    const s = value.split(' ')\n    if (added) {\n      p = s.map(t => {\n        return t.replace(/\\n$/mg, '\u23ce\\n')\n      }).map(t => c(t, 'green')).join(b(' ', 'green'))\n    } else if (removed) {\n      p = s.map(t => {\n        return t.replace(/\\n$/mg, '\u23ce\\n')\n      }).map(t => c(t, 'red')).join(b(' ', 'red'))\n    } else {\n      p = c(value, 'grey')\n    }\n    return p\n  })\n  const s = m.join('')\n  return s\n}\n\n/* documentary types/index.xml */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {_erte.Color} Color The color to apply.\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {('black'|'red'|'green'|'yellow'|'blue'|'magenta'|'cyan'|'white'|'grey')} _erte.Color The color to apply.\n */\n","import { format } from '../bytes'\nimport { c } from 'erte'\n\nexport default {\n  'f': format,\n  'fy'(v) {\n    return c(format(v) || '', 'yellow')\n  },\n  'fr'(v) {\n    return c(format(v) || '', 'red')\n  },\n  'fb'(v) {\n    return c(format(v) || '', 'blue')\n  },\n  'fg'(v) {\n    return c(format(v) || '', 'green')\n  },\n  'fc'(v) { return c(format(v) || '', 'cyan') },\n  'fm'(v) { return c(format(v) || '', 'magenta') },\n}\n","import tty from 'tty'\nimport { inspect, format } from 'util'\nimport ms from './ms'\nimport f from './modifiers/f'\n\nconst colors = [6, 2, 3, 4, 5, 1]\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\nconst inspectOpts = Object.keys(process.env).filter(key => {\n  return /^debug_/i.test(key)\n}).reduce((obj, key) => {\n  // Camel-case\n  const prop = key\n    .substring(6)\n    .toLowerCase()\n    .replace(/_([a-z])/g, (_, k) => {\n      return k.toUpperCase()\n    })\n\n  // Coerce string value into JS value\n  let val = process.env[key]\n  if (/^(yes|on|true|enabled)$/i.test(val)) {\n    val = true\n  } else if (/^(no|off|false|disabled)$/i.test(val)) {\n    val = false\n  } else if (val === 'null') {\n    val = null\n  } else {\n    val = Number(val)\n  }\n\n  obj[prop] = val\n  return obj\n}, {})\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\nfunction useColors() {\n  return 'colors' in inspectOpts ?\n    Boolean(inspectOpts['colors']) :\n    tty.isatty(process.stderr.fd)\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n * @param {!Array} args\n * @this {_debug.DebugFunction}\n */\nfunction formatArgs(args) {\n  const { namespace, useColors: uc, color, diff } = this\n\n  if (uc) {\n    const c = color\n    const colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c)\n    const prefix = `  ${colorCode};1m${namespace} \\u001B[0m`\n\n    args[0] = prefix + args[0].split('\\n').join('\\n' + prefix)\n    args.push(colorCode + 'm+' + ms(diff) + '\\u001B[0m')\n  } else {\n    args[0] = getDate() + namespace + ' ' + args[0]\n  }\n}\n\nfunction getDate() {\n  if (inspectOpts['hideDate']) {\n    return ''\n  }\n  return new Date().toISOString() + ' '\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\nfunction log(...args) {\n  return process.stderr.write(format(...args) + '\\n')\n}\n\n/**\n * Save `namespaces`.\n * @param {string} namespaces\n */\nfunction save(namespaces) {\n  if (namespaces) {\n    process.env['DEBUG'] = namespaces\n  } else {\n    // If you set a process.env field to null or undefined, it gets cast to the\n    // string 'null' or 'undefined'. Just delete instead.\n    delete process.env['DEBUG']\n  }\n}\n\n/**\n * Load `namespaces`.\n * @return {string} returns the previously persisted debug modes\n */\n\nfunction load() {\n  return process.env['DEBUG']\n}\n\n/**\n * Init logic for `debug` instances.\n * @param {_debug.DebugFunction} debug\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n  debug.inspectOpts = { ...inspectOpts }\n}\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n * @param {Object} v\n * @this {_debug.DebugFunction}\n */\nconst o = function(v) {\n  const opts = {\n    ...this.inspectOpts,\n    colors: this.useColors,\n  }\n  return inspect(v, opts)\n    .replace(/\\s*\\n\\s*/g, ' ')\n}\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n * @param {Object} v\n * @this {_debug.DebugFunction}\n */\nconst O = function(v) {\n  const opts = {\n    ...this.inspectOpts,\n    colors: this.useColors,\n  }\n  return inspect(v, opts)\n}\n\nconst formatters = { 'o': o, 'O': O, ...f }\n\n/** @type {_debug.Env} */\nconst NodeEnv = {\n  init,\n  log,\n  formatArgs,\n  save,\n  load,\n  useColors,\n  colors,\n  inspectOpts,\n  formatters,\n}\n\nexport default NodeEnv\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').DebugFunction} _debug.DebugFunction\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').Env} _debug.Env\n */","class Debug {\n  /**\n   * Create a debugger with the given `namespace`.\n   * @param {_debug.Env} env\n   */\n  constructor(env) {\n    this.colors = env.colors\n    this.formatArgs = env.formatArgs\n    this.inspectOpts = env.inspectOpts\n    this.log = env.log\n    this.save = env.save\n    this.init = env.init\n\n    this.formatters = env.formatters || {}\n\n    /**\n     * Active `debug` instances.\n     * @type {Array<_debug.DebugFunction>}\n     */\n    this.instances = []\n    /**\n\t   * The currently active debug mode names.\n     * @type {Array<!RegExp>}\n\t   */\n    this.names = []\n    /**\n\t   * The currently active names to skip.\n     * @type {Array<!RegExp>}\n\t   */\n    this.skips = []\n  }\n  createDebug() {\n    const debug = this.getDebug()\n\n    // env-specific initialization logic for debug instances\n    if (typeof this.init == 'function') {\n      this.init(debug)\n    }\n\n    this.instances.push(debug)\n    return debug\n  }\n\n  /**\n   * @returns {_debug.DebugFunction}\n   */\n  getDebug() {\n    const formatters = this.formatters\n    const formatArgs = this.formatArgs\n    const log = this.log // comes from the env\n\n    /** @type {number} */\n    let prevTime\n    /** @type {_debug.DebugFunction} */\n    function debug(...args) {\n      if (!debug.enabled) return\n\n      // Set `diff` timestamp\n      const curr = Number(new Date())\n      const time = curr - (prevTime || curr)\n      debug.diff = time\n      debug.prev = prevTime\n      debug.curr = curr\n      prevTime = curr\n\n      args[0] = coerce(args[0])\n\n      if (typeof args[0] != 'string') {\n        // Anything else let's inspect with %O\n        args.unshift('%O')\n      }\n\n      // Apply any `formatters` transformations\n      let index = 0\n      args[0] = args[0].replace(/%([a-zA-Z%]+)/g, (match, format) => {\n        // If we encounter an escaped % then don't increase the array index\n        if (match == '%%') {\n          return match\n        }\n        index++\n        const formatter = formatters[format]\n        if (formatter) {\n          const val = args[index]\n          match = formatter.call(debug, val)\n\n          // Now we need to remove `args[index]` since it's inlined in the `format`\n          args.splice(index, 1)\n          index--\n        }\n        return match\n      })\n\n      // Apply env-specific formatting (colors, etc.)\n      formatArgs.call(debug, args)\n\n      const logFn = debug.log || log\n      logFn.apply(debug, args)\n    }\n    return debug\n  }\n  /**\n\t * Selects a color for a debug namespace\n\t * @param {string} namespace The namespace string for the for the debug instance to be colored\n\t * @return {number|string} An ANSI color code for the given namespace\n\t */\n  selectColor(namespace) {\n    let hash = 0\n\n    for (let i = 0; i < namespace.length; i++) {\n      hash = ((hash << 5) - hash) + namespace.charCodeAt(i)\n      hash |= 0 // Convert to 32bit integer\n    }\n\n    return this.colors[Math.abs(hash) % this.colors.length]\n  }\n  /**\n\t * Enables a debug mode by namespaces. This can include modes\n\t * separated by a colon and wildcards.\n\t *\n\t * @param {string} namespaces\n\t * @api public\n\t */\n  enable(namespaces) {\n    this.save(namespaces)\n\n    this.names = []\n    this.skips = []\n\n    let i\n    const split = (typeof namespaces == 'string' ? namespaces : '').split(/[\\s,]+/)\n    const len = split.length\n\n    for (i = 0; i < len; i++) {\n      if (!split[i]) {\n        // ignore empty strings\n        continue\n      }\n\n      namespaces = split[i].replace(/\\*/g, '.*?')\n\n      if (namespaces[0] == '-') {\n        this.skips.push(new RegExp('^' + namespaces.substr(1) + '$'))\n      } else {\n        this.names.push(new RegExp('^' + namespaces + '$'))\n      }\n    }\n\n    for (i = 0; i < this.instances.length; i++) {\n      const instance = this.instances[i]\n      instance.enabled = this.enabled(instance.namespace)\n    }\n  }\n  destroy(debug) {\n    const index = this.instances.indexOf(debug)\n    if (index !== -1) {\n      this.instances.splice(index, 1)\n      return true\n    }\n    return false\n  }\n  /**\n\t * Disable debug output.\n\t * @return {string} namespaces\n\t */\n  disable() {\n    const namespaces = [\n      ...this.names.map(toNamespace),\n      ...this.skips.map(toNamespace).map(namespace => '-' + namespace),\n    ].join(',')\n    this.enable('')\n    return namespaces\n  }\n  /**\n\t * Returns true if the given mode name is enabled, false otherwise.\n\t * @param {string} name\n\t * @return {boolean}\n\t */\n  enabled(name) {\n    if (name[name.length - 1] == '*') {\n      return true\n    }\n\n    let i\n    let len\n\n    for (i = 0, len = this.skips.length; i < len; i++) {\n      if (this.skips[i].test(name)) {\n        return false\n      }\n    }\n\n    for (i = 0, len = this.names.length; i < len; i++) {\n      if (this.names[i].test(name)) {\n        return true\n      }\n    }\n\n    return false\n  }\n}\n\n/**\n * @param {string} namespace\n * @this {_debug.DebugContext}\n */\nfunction extend(namespace, delimiter) {\n\n}\n\n/**\n * This is the common logic for both the Node.js and web browser implementations of `debug()`.\n * @param {_debug.Env} env\n */\nexport default function setup(env) {\n  const instance = new Debug(env)\n\n  /**\n   * Creates a function to log messages.\n   * @param {string} namespace\n   */\n  function createDebug(namespace) {\n    const debug = instance.createDebug()\n\n    debug.namespace = namespace\n    debug.useColors = env.useColors()\n    debug.enabled = instance.enabled(namespace)\n    debug.color = instance.selectColor(namespace)\n    /** @this {_debug.DebugContext} */\n    debug.destroy = function() {\n      instance.destroy(this)\n    }\n    /** @this {_debug.DebugContext} */\n    debug.extend = function(ns, delimiter) {\n      const newDebug = (this.namespace + (delimiter === undefined ? ':' : delimiter) + ns)\n      newDebug.log = this.log // don't know why this is here\n      return newDebug\n    }\n\n    instance.enable(env.load())\n\n    return debug\n  }\n  return createDebug\n}\n\n/**\n * Convert regexp to namespace.\n *\n * @param {!RegExp} regexp\n * @return {string} namespace\n * @private\n */\nfunction toNamespace(regexp) {\n  return regexp.toString()\n    .substring(2, regexp.toString().length - 2)\n    .replace(/\\.\\*\\?$/, '*')\n}\n\n/**\n * Coerce `val`.\n * @param {!Error|*} val\n * @return {*}\n * @private\n */\nfunction coerce(val) {\n  if (val instanceof Error) {\n    return val.stack || val.message\n  }\n  return val\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').Env} _debug.Env\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').DebugFunction} _debug.DebugFunction\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').DebugContext} _debug.DebugContext\n */","import NodeEnv from './node'\nimport setup from './common'\n\n/**\n * Creates a function to log messages.\n * @param {string} namespace\n */\nexport default function(namespace) {\n  if (!namespace) throw new Error('To use debug, pass the namespace.')\n  const node = setup(NodeEnv)\n  const debug = node(namespace)\n  return debug\n}","import { equal } from 'assert'\nimport Debug from '@idio/debug'\nimport compose from '@goa/compose'\n\nconst debug = Debug('koa-mount')\n\n/**\n * Mount `app` with `prefix`, `app` may be a Koa application or middleware function.\n * @param {string|!_goa.Application|!_goa.Middleware} prefix prefix, app, or middleware\n * @param {!_goa.Application|!_goa.Middleware} app app or middleware\n */\nexport default function mount(prefix, app) {\n  if (typeof prefix != 'string') {\n    app = prefix\n    prefix = '/'\n  }\n\n  equal(prefix[0], '/', 'mount path must begin with \"/\"')\n\n  // compose\n  const downstream = app.middleware\n    ? compose(app.middleware)\n    : app\n\n  // don't need to do mounting here\n  if (prefix == '/') return downstream\n\n  const trailingSlash = prefix.slice(-1) == '/'\n\n  const name = app.name || 'unnamed'\n  debug('mount %s %s', prefix, name)\n\n  /**\n   * @type {!_goa.Middleware}\n   */\n  async function middleware(ctx, upstream) {\n    const prev = ctx.path\n    const newPath = match(prev)\n    debug('mount %s %s -> %s', prefix, name, newPath)\n    if (!newPath) return await upstream()\n\n    ctx['mountPath'] = prefix\n    ctx.path = /** @type {string} */ (newPath)\n    debug('enter %s -> %s', prev, ctx.path)\n\n    await downstream(ctx, async () => {\n      ctx.path = prev\n      await upstream()\n      ctx.path = /** @type {string} */ (newPath)\n    })\n\n    debug('leave %s -> %s', prev, ctx.path)\n    ctx.path = prev\n  }\n\n  /**\n   * Check if `prefix` satisfies a `path`.\n   * Returns the new path.\n   *\n   * match('/images/', '/lkajsldkjf') => false\n   * match('/images', '/images') => /\n   * match('/images/', '/images') => false\n   * match('/images/', '/images/asdf') => /asdf\n   *\n   * @param {string} path\n   * @return {string|boolean}\n   */\n  function match (path) {\n    const p = /** @type {string} */ (prefix)\n    // does not match prefix at all\n    if (path.indexOf(p) != 0) return false\n\n    const newPath = path.replace(p, '') || '/'\n    if (trailingSlash) return newPath\n\n    // `/mount` does not match `/mountlkjalskjdf`\n    if (newPath[0] != '/') return false\n    return newPath\n  }\n  return middleware\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@goa/goa').Application} _goa.Application\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@goa/goa').Middleware} _goa.Middleware\n */","export default _crypto\nexport const {\n  Certificate,\n  Cipher,\n  Credentials,\n  DEFAULT_ENCODING,\n  Decipher,\n  DiffieHellman,\n  ECDH,\n  Hash,\n  Hmac,\n  Verify,\n  createCipher,\n  createCipheriv,\n  createCredentials,\n  createDecipher,\n  createDecipheriv,\n  createDiffieHellman,\n  createECDH,\n  createHash,\n  createHmac,\n  createSign,\n  createVerify,\n  getCiphers,\n  getCurves,\n  getDiffieHellman,\n  getHashes,\n  pbkdf2,\n  pbkdf2Sync,\n  privateDecrypt,\n  privateEncrypt,\n  pseudoRandomBytes,\n  publicDecrypt,\n  publicEncrypt,\n  randomBytes,\n  randomFill,\n  randomFillSync,\n  timingSafeEqual,\n} = _crypto","import { createHmac } from 'crypto'\n\nexport function sign(data, algorithm, key, encoding) {\n  return createHmac(algorithm, key)\n    .update(data).digest(encoding)\n    .replace(/\\/|\\+|=/g, (x) => {\n      return ({ '/': '_', '+': '-', '=': '' })[x]\n    })\n}","// http://codahale.com/a-lesson-in-timing-attacks/\nexport const constantTimeCompare = function(val1, val2){\n  if (val1 == null && val2 != null){\n    return false\n  } else if (val2 == null && val1 != null){\n    return false\n  } else if (val1 == null && val2 == null){\n    return true\n  }\n\n  if (val1.length != val2.length){\n    return false\n  }\n\n  var result = 0\n\n  for (var i = 0; i < val1.length; i++) {\n    result |= val1.charCodeAt(i) ^ val2.charCodeAt(i) //Don't short circuit\n  }\n\n  return result === 0\n}\n","import { sign } from './keygrip-lib/sign'\nimport { constantTimeCompare } from './keygrip-lib/ctc'\n\n/* start example */\n/**\n * @implements {_goa.Keygrip}\n */\nexport default class Keygrip {\n  constructor(keys, algorithm = 'sha1', encoding = 'base64') {\n    if (!keys || !(0 in keys)) {\n      throw new Error('Keys must be provided.')\n    }\n    this.algorithm = algorithm\n    this.encoding = encoding\n    this.keys = keys\n  }\n  sign(data) {\n    return sign(data, this.algorithm, this.keys[0], this.encoding)\n  }\n  verify(data, digest) {\n    return this.index(data, digest) > -1\n  }\n  index(data, digest) {\n    for (let i = 0, l = this.keys.length; i < l; i++) {\n      const sig = sign(data, this.algorithm, this.keys[i], this.encoding)\n      if (constantTimeCompare(digest, sig)) return i\n    }\n\n    return -1\n  }\n}\n/* end example */\n\n/*!\n * keygrip\n * Copyright(c) 2011-2014 Jed Schmidt\n * MIT Licensed\n */\n","import { randomBytes } from 'crypto'\n\nexport default function nodeRNG() {\n  return randomBytes(16)\n}","\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = []\nfor (var j = 0; j < 256; ++j) {\n  byteToHex[j] = (j + 0x100).toString(16).substr(1)\n}\n\nexport default function bytesToUuid(buf, offset = 0) {\n  var i = offset\n  var bth = byteToHex\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]]]).join('')\n}","import rng from './rng'\nimport bytesToUuid from './bytes-to-uuid'\n\n/**\n * Generate and return a RFC4122 v4 UUID.\n * @param {_goa.UuidConfig|string} options Options, or \"binary\" string.\n * @param {Array|Buffer} [buffer] Array or buffer where UUID bytes are to be written.\n\n * @param {number} [offset] Starting index in `buffer` at which to begin writing.\n */\nexport default function v4(options = {}, buffer = null, offset = 0) {\n  var i = buffer && offset\n\n  if (typeof options == 'string') {\n    buffer = options == 'binary' ? new Array(16) : null\n    options = null\n  }\n  const { random, rng: rngFn = rng } = /** @type {_goa.UuidConfig} */ (options)\n\n  const rnds = random || rngFn()\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40\n  rnds[8] = (rnds[8] & 0x3f) | 0x80\n\n  // Copy bytes to buffer, if provided\n  if (buffer) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buffer[i + ii] = rnds[ii]\n    }\n  }\n\n  return buffer || bytesToUuid(rnds)\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('./types').UuidConfig} _goa.UuidConfig\n */","/**\n * Session model.\n * @implements {_idio.KoaSession}\n */\nexport default class Session {\n  /**\n   * Session constructor.\n   * @param {_idio.KoaContextSession} sessionContext\n   * @param {?{ _maxAge: (number|undefined), _session: (boolean|undefined) }} [obj]\n   */\n  constructor(sessionContext, obj) {\n    /**\n     * @type {number}\n     */\n    this._expire = 0\n    /**\n     * Does the session need saving.\n     * @type {boolean}\n     */\n    this._requireSave = false\n    this._sessCtx = sessionContext\n    this._ctx = sessionContext.ctx\n    if (!obj) {\n      this.isNew = true\n    } else {\n      for (const k in obj) {\n        // restore maxAge from store\n        if (k == '_maxAge') this._ctx.sessionOptions.maxAge = obj._maxAge\n        else if (k == '_session') this._ctx.sessionOptions.maxAge = 'session'\n        else {\n          /** @suppress {checkTypes} */\n          this[k] = obj[k]\n        }\n      }\n    }\n  }\n\n  /**\n   * JSON representation of the session.\n   * @return {!Object}\n   */\n  toJSON() {\n    const obj = {}\n\n    Object.keys(this).forEach(key => {\n      if (key == 'isNew') return\n      if (key[0] == '_') return\n      /**\n       * @suppress {checkTypes}\n       */\n      obj[key] = this[key]\n    })\n\n    return obj\n  }\n\n  /**\n   * Alias to `toJSON`.\n   */\n  inspect() {\n    return this.toJSON()\n  }\n\n  /**\n   * Return how many values there are in the session object.\n   * Used to see if it's \"populated\".\n   */\n  get length() {\n    return Object.keys(this.toJSON()).length\n  }\n\n  /**\n   * Populated flag, which is just a boolean alias of .length.\n   */\n  get populated() {\n    return !!this.length\n  }\n\n  /**\n   * Get session maxAge.\n   */\n  get maxAge() {\n    return /** @type {string|number} */ (this._ctx.sessionOptions.maxAge)\n  }\n\n  /**\n   * Set session maxAge.\n   * @param {number|string} val\n   */\n  set maxAge(val) {\n    this._ctx.sessionOptions.maxAge = val\n    // maxAge changed, must save to cookie and store\n    this._requireSave = true\n  }\n\n  /**\n   * Save this session no matter whether it is populated.\n   */\n  save() {\n    this._requireSave = true\n  }\n\n  /**\n   * Commit this session's headers if autoCommit is set to false.\n   */\n  async manuallyCommit() {\n    await this._sessCtx.commit()\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../..').KoaContextSession} _idio.KoaContextSession\n */","// import crc32 from './crc'\n\n/**\n * Decode the base64 cookie value to an object.\n * @param {string} string\n */\nexport function decode(string) {\n  const body = Buffer.from(string, 'base64').toString('utf8')\n  const json = JSON.parse(body)\n  return json\n}\n\n/**\n * Encode an object into a base64-encoded JSON string.\n * @param {*} body\n */\nexport function encode(body) {\n  body = JSON.stringify(body)\n  return Buffer.from(body).toString('base64')\n}\n\nexport function hash(sess) {\n  return JSON.stringify(sess)\n}","import Debug from '@idio/debug'\nimport Session from './session'\nimport { hash } from './util'\n\nconst debug = Debug('koa-session:context')\n\nexport const ONE_DAY = 24 * 60 * 60 * 1000\n\n/**\n * @implements {_idio.KoaContextSession}\n */\nexport default class ContextSession {\n  /**\n   * context session constructor\n   * @param {!_idio.Context} ctx\n   * @param {!_idio.SessionConfig} [opts] Configuration passed to `koa-session`.\n   */\n  constructor(ctx, opts = {}) {\n    this.ctx = ctx\n    this.app = ctx.app\n    this.opts = { ...opts }\n    this.store = opts.ContextStore ? new opts.ContextStore(ctx) : opts.store\n    /** @type {Session|undefined} */\n    this.session = undefined\n    /** @type {string|undefined} */\n    this.externalKey = undefined\n    /** @type {number|undefined} */\n    this.prevHash = undefined\n  }\n\n  /**\n   * Internal logic of `ctx.session`\n   */\n  get() {\n    const { session, store } = this\n    // already retrieved\n    if (session) return session\n    // unset\n    if (session === null) return null\n\n    // cookie session store\n    if (!store) this.initFromCookie()\n    return this.session\n  }\n\n  /**\n   * internal logic of `ctx.session=`\n   * @param {Object} val session object\n   */\n  set(val) {\n    if (val === null) {\n      this.session = null\n      return\n    }\n    if (typeof val == 'object') {\n      // use the original `externalKey` if exists to avoid waste storage\n      this.create(val, this.externalKey)\n      return\n    }\n    throw new Error('this.session can only be set as null or an object.')\n  }\n\n  /**\n   * Init session from external store. Will be called in the front of session middleware.\n   */\n  async initFromExternal() {\n    debug('init from external')\n    const { ctx, opts } = this\n\n    let externalKey\n    if (opts.externalKey) {\n      externalKey = opts.externalKey.get(ctx)\n      debug('get external key from custom %s', externalKey)\n    } else {\n      externalKey = ctx.cookies.get(/** @type {string} */ (opts.key), /** @type {{signed:boolean}} */(opts))\n      debug('get external key from cookie %s', externalKey)\n    }\n\n\n    if (!externalKey) {\n      // create a new `externalKey`\n      this.create()\n      return\n    }\n\n    const json = await this.store.get(externalKey, /** @type {string|number} */ (opts.maxAge), { rolling: opts.rolling || false })\n    if (!this.valid(json, externalKey)) {\n      // create a new `externalKey`\n      this.create()\n      return\n    }\n\n    // create with original `externalKey`\n    this.create(json, externalKey)\n    this.prevHash = hash(this.session.toJSON())\n  }\n\n  /**\n   * Init session from cookie.\n   * @api private\n   */\n  initFromCookie() {\n    debug('init from cookie')\n    const { ctx, opts } = this\n\n    const cookie = ctx.cookies.get(/** @type {string} */ (opts.key), /** @type {{signed:boolean}} */ (opts))\n    if (!cookie) {\n      this.create()\n      return\n    }\n\n    let json\n    debug('parse %s', cookie)\n    try {\n      json = opts.decode(cookie)\n    } catch (err) {\n      // backwards compatibility:\n      // create a new session if parsing fails.\n      // new Buffer(string, 'base64') does not seem to crash\n      // when `string` is not base64-encoded.\n      // but `JSON.parse(string)` will crash.\n      debug('decode %j error: %s', cookie, err)\n      if (!(err instanceof SyntaxError)) {\n        // clean this cookie to ensure next request won't throw again\n        ctx.cookies.set(/** @type {string} */ (opts.key), '', /** @type {!_goa.CookieSetOptions} */ (opts))\n        // ctx.onerror will unset all headers, and set those specified in err\n        err.headers = {\n          'set-cookie': ctx.response.get('set-cookie'),\n        }\n        throw err\n      }\n      this.create()\n      return\n    }\n\n    debug('parsed %j', json)\n\n    if (!this.valid(json)) {\n      this.create()\n      return\n    }\n\n    // support access `ctx.session` before session middleware\n    this.create(json)\n    this.prevHash = hash(this.session.toJSON())\n  }\n\n  /**\n   * Verify session(expired or )\n   * @param {Object} value session object\n   * @param {*} [key] session externalKey(optional)\n   */\n  valid(value, key) {\n    const { ctx } = this\n    if (!value) {\n      this.emit('missed', { key, value, ctx })\n      return false\n    }\n\n    if (value._expire && value._expire < Date.now()) {\n      debug('expired session')\n      this.emit('expired', { key, value, ctx })\n      return false\n    }\n\n    const valid = this.opts.valid\n    if (typeof valid == 'function' && !valid(ctx, value)) {\n      // valid session value fail, ignore this session\n      debug('invalid session')\n      this.emit('invalid', { key, value, ctx })\n      return false\n    }\n    return true\n  }\n\n  /**\n   * @param {string} event event name\n   * @param {*} data event data\n   * @api private\n   */\n  emit(event, data) {\n    setImmediate(() => {\n      this.app.emit(`session:${event}`, data)\n    })\n  }\n\n  /**\n   * Create a new session and attach to ctx.sess\n   * @param {Object} [val] session data\n   * @param {string} [externalKey] session external key\n   */\n  create(val, externalKey) {\n    debug('create session with val: %j externalKey: %s', val, externalKey)\n    if (this.store) this.externalKey = externalKey || this.opts.genid && this.opts.genid(this.ctx)\n    this.session = new Session(this, val)\n  }\n\n  /**\n   * Commit the session changes or removal.\n   *\n   * @api public\n   */\n  async commit() {\n    const { session, opts: { beforeSave }, ctx } = this\n\n    // not accessed\n    if (undefined === session) return\n\n    // removed\n    if (session === null) {\n      await this.remove()\n      return\n    }\n\n    const reason = this._shouldSaveSession()\n    debug('should save session: %s', reason)\n    if (!reason) return\n\n    if (typeof beforeSave == 'function') {\n      debug('before save')\n      beforeSave(ctx, session)\n    }\n    const changed = reason == 'changed'\n    await this.save(changed)\n  }\n\n  _shouldSaveSession() {\n    const { prevHash, session } = this\n\n    // force save session when `session._requireSave` set\n    if (session._requireSave) return 'force'\n\n    // do nothing if new and not populated\n    const json = session.toJSON()\n    if (!prevHash && !Object.keys(json).length) return ''\n\n    // save if session changed\n    const changed = prevHash !== hash(json)\n    if (changed) return 'changed'\n\n    // save if opts.rolling set\n    if (this.opts.rolling) return 'rolling'\n\n    // save if opts.renew and session will expired\n    if (this.opts.renew) {\n      const expire = session._expire\n      const maxAge = session.maxAge\n      // renew when session will expired in maxAge / 2\n      if (expire && maxAge && expire - Date.now() < maxAge / 2) return 'renew'\n    }\n\n    return ''\n  }\n\n  /**\n   * Remove session by calling `.set` on the cookies.\n   * @api private\n   */\n  async remove() {\n    const { opts: { key }, ctx, externalKey, store } = this\n\n    if (externalKey) await store.destroy(externalKey)\n    ctx.cookies.set(/** @type {string} */ (key), '', /** @type {!_goa.CookieSetOptions} */ (this.opts))\n  }\n\n  /**\n   * Save session. Called by the `commit` method.\n   * @param {boolean} changed\n   * @api private\n   */\n  async save(changed) {\n    const { opts: { key, rolling = false, encode, externalKey: optsExternalKey }, externalKey } = this\n    let { opts: { maxAge = ONE_DAY } } = this\n    let json = this.session.toJSON()\n    // set expire for check\n    if (maxAge == 'session') {\n      // do not set _expire in json if maxAge is set to 'session'\n      // also delete maxAge from options\n      this.opts.maxAge = undefined\n      json['_session'] = true\n    } else {\n      // set expire for check\n      json._expire = maxAge + Date.now()\n      json['_maxAge'] = maxAge\n    }\n\n    // save to external store\n    if (externalKey) {\n      debug('save %j to external key %s', json, externalKey)\n      if (typeof maxAge == 'number') {\n        // ensure store expired after cookie\n        maxAge += 10000\n      }\n      await this.store.set(externalKey, json, maxAge, {\n        changed,\n        rolling,\n      })\n      if (optsExternalKey) {\n        optsExternalKey.set(this.ctx, externalKey)\n      } else {\n        this.ctx.cookies.set(/** @type {string} */ (key), externalKey, /** @type {!_goa.CookieSetOptions} */ (this.opts))\n      }\n      return\n    }\n\n    // save to cookie\n    debug('save %j to cookie', json)\n    json = encode(json)\n    debug('save %s', json)\n\n    this.ctx.cookies.set(/** @type {string} */ (key), json, /** @type {!_goa.CookieSetOptions} */ (this.opts))\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../..').SessionConfig} _idio.SessionConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@goa/cookies').CookieSetOptions} _goa.CookieSetOptions\n */","import Debug from '@idio/debug'\nimport v4 from '@goa/uuid'\nimport assert from 'assert'\nimport ContextSession, { ONE_DAY } from './lib/context'\nimport { encode, decode } from './lib/util'\n\nconst debug = Debug('koa-session')\n\nconst CONTEXT_SESSION = Symbol('context#contextSession')\nconst _CONTEXT_SESSION = Symbol('context#_contextSession')\n\n/**\n * @license\n * MIT https://github.com/miguelmota/is-class\n */\nfunction isClass(fn) {\n  return (typeof fn == 'function' &&\n    (/^class[\\s{]/.test(fn.toString()) ||\n      (/classCallCheck\\(/.test(fnBody(fn)))) // babel.js\n  )\n}\nfunction fnBody(fn) {\n  return fn.toString().replace(/^[^{]*{\\s*/,'').replace(/\\s*}[^}]*$/,'')\n}\n\nconst isFunction = fn => typeof fn == 'function'\n\n/**\n * @type {_idio.session}\n */\nfunction Session(opts = {}) {\n  formatOpts(opts)\n\n  /**\n   * @type {!_idio.Middleware}\n   */\n  async function session(ctx, next) {\n    const sess = extendContext(ctx, /** @type {!_idio.SessionConfig} */ (opts))\n\n    if (sess.store) await sess.initFromExternal()\n    try {\n      await next()\n    } finally {\n      if (opts.autoCommit) {\n        await sess.commit()\n      }\n    }\n  }\n  return /** @type {!_goa.Middleware} */ (session)\n}\n\nexport default Session\n\n/**\n * format and check session options\n * @param {!_idio.SessionConfig} [opts] Configuration passed to `koa-session`.\n * @private\n */\nfunction formatOpts(opts = {}) {\n  opts.key = opts.key || 'koa:sess'\n  opts.maxAge = opts.maxAge || ONE_DAY\n\n  // defaults\n  if (opts.overwrite == null) opts.overwrite = true\n  if (opts.httpOnly == null) opts.httpOnly = true\n  if (opts.signed == null) opts.signed = true\n  if (opts.autoCommit == null) opts.autoCommit = true\n\n  debug('session options %j', opts)\n\n  // setup encoding/decoding\n  if (typeof opts.encode != 'function') {\n    opts.encode = encode\n  }\n  if (typeof opts.decode != 'function') {\n    opts.decode = decode\n  }\n\n  const store = opts.store\n  if (store) {\n    assert(isFunction(store.get), 'store.get must be function')\n    assert(isFunction(store.set), 'store.set must be function')\n    assert(isFunction(store.destroy), 'store.destroy must be function')\n  }\n\n  const externalKey = opts.externalKey\n  if (externalKey) {\n    assert(isFunction(externalKey.get), 'externalKey.get must be function')\n    assert(isFunction(externalKey.set), 'externalKey.set must be function')\n  }\n\n  const ContextStore = opts.ContextStore\n  if (ContextStore) {\n    assert(isClass(ContextStore), 'ContextStore must be a class')\n    assert(isFunction(ContextStore.prototype.get), 'ContextStore.prototype.get must be function')\n    assert(isFunction(ContextStore.prototype.set), 'ContextStore.prototype.set must be function')\n    assert(isFunction(ContextStore.prototype.destroy), 'ContextStore.prototype.destroy must be function')\n  }\n\n  if (!opts.genid) {\n    if (opts.prefix) opts.genid = () => `${opts.prefix}${v4()}`\n    else opts.genid = v4\n  }\n}\n\n/**\n * Extend context prototype, add session properties\n * @param {!_idio.Context} context Idio's context prototype.\n * @param {!_idio.SessionConfig} opts Configuration passed to `koa-session`.\n */\nfunction extendContext(context, opts) {\n  if (context.hasOwnProperty(CONTEXT_SESSION)) {\n    return\n  }\n  Object.defineProperties(context, {\n    session: {\n      get() {\n        return sessionContext.get()\n      },\n      set(val) {\n        sessionContext.set(val)\n      },\n      configurable: true,\n    },\n    sessionOptions: {\n      get() {\n        return sessionContext.opts\n      },\n    },\n  })\n  const sessionContext = new ContextSession(context, opts)\n  return sessionContext\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/idio').Context} _idio.Context\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/idio').Middleware} _idio.Middleware\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').SessionConfig} _idio.SessionConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').session} _idio.session\n */","/*!\n * vary\n * Copyright(c) 2014-2017 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n/**\n * RegExp to match field-name in RFC 7230 sec 3.2\n *\n * field-name    = token\n * token         = 1*tchar\n * tchar         = \"!\" / \"#\" / \"$\" / \"%\" / \"&\" / \"'\" / \"*\"\n *               / \"+\" / \"-\" / \".\" / \"^\" / \"_\" / \"`\" / \"|\" / \"~\"\n *               / DIGIT / ALPHA\n *               ; any VCHAR, except delimiters\n */\n\nconst FIELD_NAME_REGEXP = /^[!#$%&'*+\\-.^_`|~0-9A-Za-z]+$/\n\n/**\n * Append a field to a vary header.\n * @param {string} header\n * @param {string|!Array<string>} field\n */\nexport function append(header, field) {\n  if (typeof header != 'string')\n    throw new TypeError('header argument is required')\n\n  if (!field)\n    throw new TypeError('field argument is required')\n\n  // get fields array\n  const fields = !Array.isArray(field) ? parse(`${field}`) : field\n\n  // assert on invalid field names\n  for (let j = 0; j < fields.length; j++) {\n    if (!FIELD_NAME_REGEXP.test(fields[j])) {\n      throw new TypeError('field argument contains an invalid header name')\n    }\n  }\n\n  // existing, unspecified vary\n  if (header == '*') return header\n\n  // enumerate current values\n  var val = header\n  const vals = parse(header.toLowerCase())\n\n  // unspecified vary\n  if (fields.includes('*') || vals.includes('*'))\n    return '*'\n\n  for (let i = 0; i < fields.length; i++) {\n    const fld = fields[i].toLowerCase()\n\n    // append value (case-preserving)\n    if (!vals.includes(fld)) {\n      vals.push(fld)\n      val = val\n        ? val + ', ' + fields[i]\n        : fields[i]\n    }\n  }\n\n  return val\n}\n\n/**\n * Parse a vary header into an array.\n * @param {string} header\n */\nfunction parse(header) {\n  var end = 0\n  var list = []\n  var start = 0\n\n  // gather tokens\n  for (var i = 0, len = header.length; i < len; i++) {\n    switch (header.charCodeAt(i)) {\n    case 0x20: /*   */\n      if (start == end) {\n        start = end = i + 1\n      }\n      break\n    case 0x2c: /* , */\n      list.push(header.substring(start, end))\n      start = end = i + 1\n      break\n    default:\n      end = i + 1\n      break\n    }\n  }\n\n  // final token\n  list.push(header.substring(start, end))\n\n  return list\n}\n\n/**\n * Mark that a request is varied on a header field.\n *\n * @param {http.ServerResponse} res\n * @param {string|!Array<string>} field\n */\nexport default function vary(res, field) {\n  if (!res || !res.getHeader || !res.setHeader) {\n    // quack quack\n    throw new TypeError('res argument is required')\n  }\n\n  // get existing header\n  let val = res.getHeader('Vary') || ''\n  const header = Array.isArray(val)\n    ? val.join(', ')\n    : `${val}`\n\n  // set new header\n  if ((val = append(header, field))) {\n    res.setHeader('Vary', val)\n  }\n}\n\n/* typal types/index.xml */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').ServerResponse} http.ServerResponse\n */\n","import { append } from '@goa/vary'\n\n/**\n * @type {_goa.cors}\n */\nfunction Cors(config = {}) {\n  let {\n    allowMethods = 'GET,HEAD,PUT,POST,DELETE,PATCH',\n    exposeHeaders,\n    allowHeaders,\n    maxAge,\n    credentials = false,\n    keepHeadersOnError = true,\n    origin: Origin,\n  } = config\n\n  if (Array.isArray(allowMethods))\n    allowMethods = allowMethods.join(',')\n\n  if (Array.isArray(exposeHeaders))\n    exposeHeaders = exposeHeaders.join(',')\n\n  if (Array.isArray(allowHeaders))\n    allowHeaders = allowHeaders.join(',')\n\n  if (maxAge) maxAge = `${maxAge}`\n\n  /**\n   * @type {!_goa.Middleware}\n   */\n  async function cors(ctx, next) {\n    // If the Origin header is not present terminate this set of steps.\n    // The request is outside the scope of this specification.\n    const requestOrigin = ctx.get('Origin')\n\n    // Always set Vary header\n    // https://github.com/rs/cors/issues/10\n    ctx.vary('Origin')\n\n    if (!requestOrigin) return await next()\n\n    let origin\n    if (typeof Origin === 'function') {\n      origin = Origin(ctx)\n      if (origin instanceof Promise) origin = await origin\n      if (!origin) return await next()\n    } else {\n      origin = Origin || requestOrigin\n    }\n\n    const headersSet = {}\n\n    function set(key, value) {\n      ctx.set(key, value)\n      headersSet[key] = value\n    }\n\n    if (ctx.method != 'OPTIONS') {\n      // Simple Cross-Origin Request, Actual Request, and Redirects\n      set('Access-Control-Allow-Origin', origin)\n\n      if (credentials)\n        set('Access-Control-Allow-Credentials', 'true')\n\n      if (exposeHeaders)\n        set('Access-Control-Expose-Headers', exposeHeaders)\n\n      if (!keepHeadersOnError) {\n        return await next()\n      }\n      try {\n        return await next()\n      } catch (err) {\n        const errHeadersSet = err['headers'] || {}\n        const varyWithOrigin = append(errHeadersSet['vary'] || errHeadersSet['Vary'] || '', 'Origin')\n        delete errHeadersSet.Vary\n\n        err['headers'] = Object.assign({}, errHeadersSet, headersSet, { 'vary': varyWithOrigin })\n\n        throw err\n      }\n    } else {\n      // Preflight Request\n\n      // If there is no Access-Control-Request-Method header or if parsing failed,\n      // do not set any additional headers and terminate this set of steps.\n      // The request is outside the scope of this specification.\n      if (!ctx.get('Access-Control-Request-Method')) {\n        // this not preflight request, ignore it\n        return await next()\n      }\n\n      ctx.set('Access-Control-Allow-Origin', origin)\n\n      if (credentials)\n        ctx.set('Access-Control-Allow-Credentials', 'true')\n\n      if (maxAge)\n        ctx.set('Access-Control-Max-Age', maxAge)\n\n      if (allowMethods)\n        ctx.set('Access-Control-Allow-Methods', allowMethods)\n\n      if (!allowHeaders)\n        allowHeaders = ctx.get('Access-Control-Request-Headers')\n\n      if (allowHeaders) {\n        ctx.set('Access-Control-Allow-Headers', allowHeaders)\n      }\n\n      ctx.status = 204\n    }\n  }\n  return cors\n}\n\nexport default Cors\n\n/**\n * @typedef {import('../').CorsConfig} _goa.CorsConfig\n */\n/**\n * @typedef {import('../').cors} _goa.cors\n */","export default path\nexport const {\n  basename,\n  delimiter,\n  dirname,\n  extname,\n  format,\n  isAbsolute,\n  join,\n  normalize,\n  parse,\n  posix,\n  relative,\n  resolve,\n  sep,\n  win32,\n} = path","export default fs\nexport const {\n  ReadStream,\n  Stats,\n  WriteStream,\n  access,\n  accessSync,\n  appendFile,\n  appendFileSync,\n  chmod,\n  chmodSync,\n  chown,\n  chownSync,\n  close,\n  closeSync,\n  constants,\n  copyFile,\n  copyFileSync,\n  createReadStream,\n  createWriteStream,\n  exists,\n  existsSync,\n  fchmod,\n  fchmodSync,\n  fchown,\n  fchownSync,\n  fdatasync,\n  fdatasyncSync,\n  fstat,\n  fstatSync,\n  fsync,\n  fsyncSync,\n  ftruncate,\n  ftruncateSync,\n  futimes,\n  futimesSync,\n  lchmod,\n  lchmodSync,\n  lchown,\n  lchownSync,\n  link,\n  linkSync,\n  lstat,\n  lstatSync,\n  mkdir,\n  mkdirSync,\n  mkdtemp,\n  mkdtempSync,\n  open,\n  openSync,\n  read,\n  readFile,\n  readFileSync,\n  readSync,\n  readdir,\n  readdirSync,\n  readlink,\n  readlinkSync,\n  realpath,\n  realpathSync,\n  rename,\n  renameSync,\n  rmdir,\n  rmdirSync,\n  stat,\n  statSync,\n  symlink,\n  symlinkSync,\n  truncate,\n  truncateSync,\n  unlink,\n  unlinkSync,\n  unwatchFile,\n  utimes,\n  utimesSync,\n  watch,\n  watchFile,\n  write,\n  writeFile,\n  writeFileSync,\n  writeSync,\n} = fs","const getLastItem = (array) => {\n  const item = array[array.length - 1]\n  return item\n}\nconst getItemsFrom = (array, from) => array.slice(from)\n\n/**\n * Get a segment of the stack string, defaults are from = 0 and oneLine = false.\n * @param {string} stack the stack string\n * @param {number} [from=0] index from which to slice from\n * @param {boolean} [oneLine=false] Whether just first line must be returned\n * @returns {string} A stack segment starting from the specified line.\n */\nexport const getStackSegment = (stack, from = 0, oneLine = false) => {\n  if (from === 0 && !oneLine) {\n    return stack\n  }\n  const splitStack = stack\n    .split('\\n', oneLine ? from + 1 : undefined)\n  if (oneLine) {\n    const line = getLastItem(splitStack)\n    return line\n  } else {\n    const items = getItemsFrom(splitStack, from)\n    return items.join('\\n')\n  }\n}\n\n/**\n * Get the stack trace part of when the erotic function was called. Disregards\n * first two lines.\n * @param {string} stack error's stack\n * @param {boolean} [transparent] trim the top line as well\n * @returns {string} A part of stack\n */\nexport const getEntryStack = (stack, transparent = false) => {\n  const stackSegment = getStackSegment(stack, 2 + (transparent ? 1 : 0))\n  return stackSegment\n}\n\n/**\n * Get stack line of where the callback was called.\n * @param {string} stack Stack string.\n * @returns {string} Stack line.\n */\nexport const getCalleeStackLine = (stack) => {\n  const calleeStackLine = getStackSegment(stack, 2, true)\n  return calleeStackLine\n}\n\nexport const getStackHeading = message => `Error: ${message}`\n\n/**\n * Extract caller from the function's `arguments`.\n * @param {Object} args arguments\n * @returns {!Function} The caller function from `arguments.callee.caller`.\n */\nexport const getCallerFromArguments = (args) => {\n  const { callee: { caller } } = args\n  return caller\n}","export default os\nexport const {\n  EOL,\n  arch,\n  constants,\n  cpus,\n  endianness,\n  freemem,\n  homedir,\n  hostname,\n  loadavg,\n  networkInterfaces,\n  platform,\n  release,\n  tmpdir,\n  totalmem,\n  type,\n  uptime,\n  userInfo,\n} = os","import { homedir } from 'os'\n\nconst extractPathRegex = /\\s+at.*(?:\\(|\\s)(.*)\\)?/\nconst pathRegex = /^(?:(?:(?:node|(?:internal\\/[\\w/]*|.*node_modules\\/(?:IGNORED_MODULES)\\/.*)?\\w+)\\.js:\\d+:\\d+)|native)/\n\nconst homeDir = homedir()\n\n/**\n * Remove internal Node.JS lines from the error stack traces.\n * @param {string} stack The error stack to update.\n * @param {!_cleanStack.Config} [options] Options for the program.\n * @param {boolean} [options.pretty=false] Replace the absolute path to the home directory with the `~`. Default `false`.\n * @param {!Array<string>} [options.ignoredModules=\"\uff3b'pirates'\uff3d\"] Which modules to ignore in the path. Default `\uff3b'pirates'\uff3d`.\n */\nconst cleanStack = (stack, options) => {\n  const {\n    pretty = false, ignoredModules = ['pirates'],\n  } = options || {}\n  const j = ignoredModules.join('|')\n  const re = new RegExp(pathRegex.source.replace('IGNORED_MODULES', j))\n\n  return stack.replace(/\\\\/g, '/')\n    .split('\\n')\n    .filter(x => {\n      const pathMatches = x.match(extractPathRegex)\n      if (pathMatches === null || !pathMatches[1]) {\n        return true\n      }\n\n      const match = pathMatches[1]\n\n      // Electron\n      if (match.includes('.app/Contents/Resources/electron.asar') ||\n        match.includes('.app/Contents/Resources/default_app.asar')) {\n        return false\n      }\n\n      return !re.test(match)\n    })\n    .filter(x => x.trim())\n    .map(x => {\n      if (pretty) {\n        return x.replace(extractPathRegex, (m, p1) => m.replace(p1, p1.replace(homeDir, '~')))\n      }\n\n      return x\n    })\n    .join('\\n')\n}\n\nexport default cleanStack\n\n/* documentary types/index.xml */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {_cleanStack.Config} Config Options for the program.\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {Object} _cleanStack.Config Options for the program.\n * @prop {boolean} [pretty=false] Replace the absolute path to the home directory with the `~`. Default `false`.\n * @prop {!Array<string>} [ignoredModules=\"\uff3b'pirates'\uff3d\"] Which modules to ignore in the path. Default `\uff3b'pirates'\uff3d`.\n */\n","import cleanStack from '@artdeco/clean-stack'\nimport {\n  getCallerFromArguments, getCalleeStackLine, getStackHeading,\n} from './lib'\n\n/**\n * Create a callback.\n * @param {!Function} entryCaller The function which was called at entry.\n * @param {string} entryStack The first line of the error stack to be returned\n * @param {boolean} [shadow=false] Print only entry stack.\n */\nexport function makeCallback(entryCaller, entryStack, shadow = false) {\n  /**\n   * This callback should be called when an asynchronous error occurred.\n   * @param {(string|Error)} messageOrError A message string or an _Error_ object at the point of actual error.\n   * @returns {Error} An error with the updated stack which includes the callee.\n   */\n  function cb(messageOrError) {\n    const caller = getCallerFromArguments(arguments)\n    const { stack: errorStack } = new Error()\n    const calleeStackLine = getCalleeStackLine(errorStack)\n    const isError = messageOrError instanceof Error\n    const message = isError ? messageOrError.message : messageOrError\n\n    const stackHeading = getStackHeading(message)\n    const entryHasCallee = caller !== null && entryCaller === caller\n    const stackMessage = [\n      stackHeading,\n      ...(entryHasCallee || shadow ? [entryStack] : [\n        calleeStackLine,\n        entryStack,\n      ]),\n    ].join('\\n')\n\n    const stack = cleanStack(stackMessage)\n    const properties = { message, stack }\n    const e = isError ? messageOrError : new Error()\n\n    return /** @type {Error} */ (Object.assign(/** @type {!Object} */ (e), properties))\n  }\n\n  return cb\n}","import {\n  getEntryStack, getCallerFromArguments,\n} from './lib'\nimport { makeCallback } from './callback'\n\n/**\n * Returns a function to create an error with a stack trace starting at the line in code when the call was made by the callee.\n * @param {boolean} [transparent] Pretend as if the call to the function lead to the error, without exposing any of the internal stack.\n */\nexport default function erotic(transparent) {\n  const { stack } = new Error()\n  const caller = getCallerFromArguments(arguments)\n  const entryStack = getEntryStack(stack, transparent)\n\n  return makeCallback(caller, entryStack, transparent)\n}","import erotic from 'erotic'\n\nfunction checkArgumentIndex(length, i) {\n  if (i > length - 2) {\n    throw new Error('Function does not accept that many arguments.')\n  }\n}\n\n/**\n * Get a promise from a function which otherwise accepts a callback.\n * @param {Function} fn A function to promisify.\n * @param {*|Array<*>} [args] An array of arguments to use in the call, or a single argument.\n * @param {*} [resolveValue] A value to override the value with which the promise will be resolved.\n * @returns {Promise<*>} A promise resolved on callback invocation without an error and rejected on callback called with an error.\n */\nexport default async function makePromise(fn, args, resolveValue) {\n  const er = erotic(true)\n  if (typeof fn !== 'function') {\n    throw new Error('Function must be passed.')\n  }\n  const { length: fnLength } = fn\n  if (!fnLength) {\n    throw new Error('Function does not accept any arguments.')\n  }\n\n  const res = await new Promise((resolve, reject)=> {\n    const cb = (err, res) => {\n      if (err) {\n        const error = er(err)\n        return reject(error)\n      }\n      return resolve(resolveValue || res)\n    }\n\n    let allArgs = [cb]\n\n    if (Array.isArray(args)) {\n      args.forEach((arg, i) => {\n        checkArgumentIndex(fnLength, i)\n      })\n      allArgs =  [...args, cb]\n    } else if (Array.from(arguments).length > 1) { // args passed as a single argument, not array\n      checkArgumentIndex(fnLength, 0)\n      allArgs = [args, cb]\n    }\n    fn(...allArgs)\n  })\n  return res\n}","/*!\n * resolve-path\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015-2018 Douglas Christopher Wilson\n * MIT Licensed\n */\n\nimport createError from '@goa/http-errors'\nimport { join, normalize, resolve, sep, isAbsolute } from 'path'\n\n/**\n * Module variables.\n * @private\n */\n\nconst UP_PATH_REGEXP = /(?:^|[\\\\/])\\.\\.(?:[\\\\/]|$)/\n\n/**\n * Resolve relative path against a root path\n * @param {string} rootPath\n * @param {string} relativePath\n * @return {string}\n */\nexport default function resolvePath (rootPath, relativePath) {\n  var path = relativePath\n  var root = rootPath\n\n  // root is optional, similar to root.resolve\n  if (arguments.length === 1) {\n    path = rootPath\n    root = process.cwd()\n  }\n\n  if (root == null) {\n    throw new TypeError('argument rootPath is required')\n  }\n\n  if (typeof root !== 'string') {\n    throw new TypeError('argument rootPath must be a string')\n  }\n\n  if (path == null) {\n    throw new TypeError('argument relativePath is required')\n  }\n\n  if (typeof path !== 'string') {\n    throw new TypeError('argument relativePath must be a string')\n  }\n\n  // containing NULL bytes is malicious\n  if (path.indexOf('\\0') !== -1) {\n    throw createError(400, 'Malicious Path')\n  }\n\n  // path should never be absolute\n  if (isAbsolute(path)) {\n    throw createError(400, 'Malicious Path')\n  }\n\n  // path outside root\n  if (UP_PATH_REGEXP.test(normalize('.' + sep + path))) {\n    throw createError(403)\n  }\n\n  // join the relative path\n  return normalize(join(resolve(root), path))\n}","import Debug from '@idio/debug'\nimport { normalize, basename, extname, resolve, parse, sep } from 'path'\nimport createError from '@goa/http-errors'\nimport assert from 'assert'\nimport { exists as fsExists, stat as fsStat, createReadStream } from 'fs'\nimport makePromise from 'makepromise'\nimport resolvePath from '../resolve-path'\n\nconst exists = async (...args) => {\n  return await makePromise(fsExists, ...args)\n}\nconst stat = async (...args) => {\n  return await makePromise(fsStat, ...args)\n}\n\nconst debug = Debug('koa-send')\n\n/**\n * Send file at `path` with the given `options` to the koa `ctx`.\n * @param {_goa.Context} ctx\n * @param {string} path\n * @param {_idio.KoaSendConfig} [opts]\n */\nexport default async function send(ctx, path, opts = {}) {\n  assert(ctx, 'koa context required')\n  assert(path, 'pathname required')\n\n  // options\n  debug('send \"%s\" %j', path, opts)\n  const root = opts.root ? normalize(resolve(opts.root)) : ''\n  const trailingSlash = path[path.length - 1] == '/'\n  path = path.substr(parse(path).root.length)\n  const index = opts.index\n  const maxage = opts.maxage || opts.maxAge || 0\n  const immutable = opts.immutable || false\n  const hidden = opts.hidden || false\n  const format = opts.format !== false\n  const extensions = Array.isArray(opts.extensions) ? opts.extensions : false\n  const brotli = opts.brotli !== false\n  const gzip = opts.gzip !== false\n  const setHeaders = opts.setHeaders\n\n  if (setHeaders && typeof setHeaders !== 'function') {\n    throw new TypeError('option setHeaders must be function')\n  }\n\n  // normalize path\n  path = decode(path)\n\n  if (path == -1) return ctx.throw(400, 'failed to decode')\n\n  // index file support\n  if (index && trailingSlash) path += index\n\n  path = resolvePath(root, path)\n\n  // hidden file support, ignore\n  if (!hidden && isHidden(root, path)) return\n\n  let encodingExt = ''\n  // serve brotli file when possible otherwise gzipped file when possible\n  if (ctx.acceptsEncodings('br', 'identity') == 'br' && brotli && (await exists(path + '.br'))) {\n    path = path + '.br'\n    ctx.set('Content-Encoding', 'br')\n    ctx.res.removeHeader('Content-Length')\n    encodingExt = '.br'\n  } else if (ctx.acceptsEncodings('gzip', 'identity') == 'gzip' && gzip && (await exists(path + '.gz'))) {\n    path = path + '.gz'\n    ctx.set('Content-Encoding', 'gzip')\n    ctx.res.removeHeader('Content-Length')\n    encodingExt = '.gz'\n  }\n\n  if (extensions && !/\\.[^/]*$/.exec(path)) {\n    const list = [].concat(extensions)\n    for (let i = 0; i < list.length; i++) {\n      let ext = list[i]\n      if (typeof ext !== 'string') {\n        throw new TypeError('option extensions must be array of strings or false')\n      }\n      if (!/^\\./.exec(ext)) ext = '.' + ext\n      if (await exists(path + ext)) {\n        path = path + ext\n        break\n      }\n    }\n  }\n\n  // stat\n  let stats\n  try {\n    stats = await stat(path)\n\n    // Format the path to serve static file servers\n    // and not require a trailing slash for directories,\n    // so that you can do both `/directory` and `/directory/`\n    if (stats.isDirectory()) {\n      if (format && index) {\n        path += '/' + index\n        stats = await stat(path)\n      } else {\n        return\n      }\n    }\n  } catch (err) {\n    const notfound = ['ENOENT', 'ENAMETOOLONG', 'ENOTDIR']\n    if (notfound.includes(err.code)) {\n      throw createError(404, err)\n    }\n    err.status = 500\n    throw err\n  }\n\n  if (setHeaders) setHeaders(ctx.res, path, stats)\n\n  // stream\n  ctx.set('Content-Length', stats.size)\n  if (!ctx.response.get('Last-Modified')) ctx.set('Last-Modified', stats.mtime.toUTCString())\n  if (!ctx.response.get('Cache-Control')) {\n    const directives = ['max-age=' + (maxage / 1000 | 0)]\n    if (immutable) {\n      directives.push('immutable')\n    }\n    ctx.set('Cache-Control', directives.join(','))\n  }\n  if (!ctx.type) ctx.type = type(path, encodingExt)\n  ctx.body = createReadStream(path)\n\n  return path\n}\n\n/**\n * Check if it's hidden.\n */\n\nfunction isHidden (root, path) {\n  path = path.substr(root.length).split(sep)\n  for (let i = 0; i < path.length; i++) {\n    if (path[i][0] == '.') return true\n  }\n  return false\n}\n\n/**\n * File type.\n */\n\nfunction type (file, ext) {\n  return ext !== '' ? extname(basename(file, ext)) : extname(file)\n}\n\n/**\n * Decode `path`.\n */\n\nfunction decode (path) {\n  try {\n    return decodeURIComponent(path)\n  } catch (err) {\n    return -1\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@goa/goa').Context} _goa.Context\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../../types/modules').KoaSendConfig} _idio.KoaSendConfig\n */","import Debug from '@idio/debug'\nimport { resolve } from 'path'\nimport assert from 'assert'\nimport send from '../koa-send'\n\nconst debug = Debug('koa-static')\n\n/**\n * Serve static files from `root`.\n * @param {string} root\n * @param {_idio.KoaStaticConfig} [opts]\n */\nexport default (root, opts = {}) => {\n  assert(root, 'root directory is required to serve files')\n\n  // options\n  debug('static \"%s\" %j', root, opts)\n  opts.root = resolve(root)\n  if (opts.index !== false) opts.index = opts.index || 'index.html'\n\n  if (!opts.defer) {\n    /** @type {!_goa.Middleware} */\n    const serve = async (ctx, next) => {\n      let done = false\n\n      if (ctx.method == 'HEAD' || ctx.method == 'GET') {\n        try {\n          done = await send(ctx, ctx.path, opts)\n        } catch (err) {\n          if (err.status != 404) {\n            throw err\n          }\n        }\n      }\n\n      if (!done) {\n        await next()\n      }\n    }\n    return serve\n  }\n\n  /** @type {!_goa.Middleware} */\n  const serve = async (ctx, next) => {\n    await next()\n\n    if (ctx.method != 'HEAD' && ctx.method != 'GET') return\n    // response is already handled\n    if (ctx.body != null || ctx.status != 404) return\n\n    try {\n      await send(ctx, ctx.path, opts)\n    } catch (err) {\n      if (err.status != 404) {\n        throw err\n      }\n    }\n  }\n  return serve\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../..').KoaStaticConfig} _idio.KoaStaticConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/goa').Middleware} _goa.Middleware\n */","/*!\n * compressible\n * Copyright(c) 2013 Jonathan Ong\n * Copyright(c) 2014 Jeremiah Senkpiel\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\nconst db = require(/* depack-require */ 'mime-db')\n\n/**\n * Module variables.\n * @private\n */\n\nconst COMPRESSIBLE_TYPE_REGEXP = /^text\\/|\\+(?:json|text|xml)$/i\nconst EXTRACT_TYPE_REGEXP = /^\\s*([^;\\s]*)(?:;|\\s|$)/\n\n/**\n * Module exports.\n * @public\n */\n\n/**\n * Checks if a type is compressible.\n *\n * @param {string} type\n * @return {?boolean} compressible\n */\nexport default function compressible (type) {\n  if (!type || typeof type != 'string') {\n    return false\n  }\n\n  // strip parameters\n  const match = EXTRACT_TYPE_REGEXP.exec(type)\n  const mime = match && match[1].toLowerCase()\n  const data = db[mime]\n\n  // return database information\n  if (data && data['compressible'] !== undefined) {\n    return data['compressible']\n  }\n\n  // fallback to regexp or unknown\n  return COMPRESSIBLE_TYPE_REGEXP.test(mime) || null\n}","/**\n * Check if `body` should be interpreted as json.\n */\nexport default function isJSON(body) {\n  if (!body) return false\n  if ('string' == typeof body) return false\n  if ('function' == typeof body['pipe']) return false\n  if (Buffer.isBuffer(body)) return false\n  return true\n}\n\n/**\n * @license MIT\n * Jonathan Ong\n * https://npmjs.org/koa-is-json\n */\n","export default stream\nexport const {\n  Duplex,\n  PassThrough,\n  Readable,\n  Stream,\n  Transform,\n  Writable,\n} = stream","export default zlib\nexport const {\n  Deflate,\n  DeflateRaw,\n  Gunzip,\n  Gzip,\n  Inflate,\n  InflateRaw,\n  Unzip,\n  Z_BEST_COMPRESSION,\n  Z_BEST_SPEED,\n  Z_BLOCK,\n  Z_BUF_ERROR,\n  Z_DATA_ERROR,\n  Z_DEFAULT_COMPRESSION,\n  Z_DEFAULT_STRATEGY,\n  Z_ERRNO,\n  Z_FILTERED,\n  Z_FINISH,\n  Z_FIXED,\n  Z_FULL_FLUSH,\n  Z_HUFFMAN_ONLY,\n  Z_MEM_ERROR,\n  Z_NEED_DICT,\n  Z_NO_COMPRESSION,\n  Z_NO_FLUSH,\n  Z_OK,\n  Z_PARTIAL_FLUSH,\n  Z_RLE,\n  Z_STREAM_END,\n  Z_STREAM_ERROR,\n  Z_SYNC_FLUSH,\n  Z_VERSION_ERROR,\n  constants,\n  createDeflate,\n  createDeflateRaw,\n  createGunzip,\n  createGzip,\n  createInflate,\n  createInflateRaw,\n  createUnzip,\n  deflate,\n  deflateRaw,\n  deflateRawSync,\n  deflateSync,\n  gunzip,\n  gunzipSync,\n  gzip,\n  gzipSync,\n  inflate,\n  inflateRaw,\n  inflateRawSync,\n  inflateSync,\n  unzip,\n  unzipSync,\n} = zlib","/*!\n * bytes\n * Copyright(c) 2012-2014 TJ Holowaychuk\n * Copyright(c) 2015 Jed Watson\n * MIT Licensed\n */\n\nconst formatThousandsRegExp = /\\B(?=(\\d{3})+(?!\\d))/g\nconst formatDecimalsRegExp = /(?:\\.0*|(\\.[^0]+)0+)$/\n\nconst map = {\n  b:  1,\n  kb: 1 << 10,\n  mb: 1 << 20,\n  gb: 1 << 30,\n  tb: Math.pow(1024, 4),\n  pb: Math.pow(1024, 5),\n}\n\nvar parseRegExp = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb|pb)$/i\n\n/**\n * Convert the given value in bytes into a string or parse to string to an integer in bytes.\n *\n * @param {string|number} value\n * @param {{\n *  case: (string|undefined),\n *  decimalPlaces: (number|undefined),\n *  fixedDecimals: (boolean|undefined),\n *  thousandsSeparator: (string|undefined),\n *  unitSeparator: (string|undefined),\n *  }} [options] bytes options.\n *\n * @returns {?(string|number)}\n */\n\nexport default function bytes(value, options) {\n  if (typeof value == 'string') {\n    return parse(value)\n  }\n\n  if (typeof value == 'number') {\n    return format(value, options)\n  }\n\n  return null\n}\n\n/**\n * Format the given value in bytes into a string.\n *\n * If the value is negative, it is kept as such. If it is a float,\n * it is rounded.\n *\n * @param {number} value\n * @param {Object} [options]\n * @param {number} [options.decimalPlaces=2]\n * @param {number} [options.fixedDecimals=false]\n * @param {string} [options.thousandsSeparator=]\n * @param {string} [options.unit=]\n * @param {string} [options.unitSeparator=]\n * @returns {?string}\n */\nexport function format(value, options) {\n  if (!Number.isFinite(value)) {\n    return null\n  }\n\n  var mag = Math.abs(value)\n  var thousandsSeparator = (options && options.thousandsSeparator) || ''\n  var unitSeparator = (options && options.unitSeparator) || ''\n  var decimalPlaces = (options && options.decimalPlaces !== undefined) ? options.decimalPlaces : 2\n  var fixedDecimals = Boolean(options && options.fixedDecimals)\n  var unit = (options && options.unit) || ''\n\n  if (!unit || !map[unit.toLowerCase()]) {\n    if (mag >= map.pb) {\n      unit = 'PB'\n    } else if (mag >= map.tb) {\n      unit = 'TB'\n    } else if (mag >= map.gb) {\n      unit = 'GB'\n    } else if (mag >= map.mb) {\n      unit = 'MB'\n    } else if (mag >= map.kb) {\n      unit = 'KB'\n    } else {\n      unit = 'B'\n    }\n  }\n\n  var val = value / map[unit.toLowerCase()]\n  var str = val.toFixed(decimalPlaces)\n\n  if (!fixedDecimals) {\n    str = str.replace(formatDecimalsRegExp, '$1')\n  }\n\n  if (thousandsSeparator) {\n    str = str.replace(formatThousandsRegExp, thousandsSeparator)\n  }\n\n  return str + unitSeparator + unit\n}\n\n/**\n * Parse the string value into an integer in bytes.\n *\n * If no unit is given, it is assumed the value is in bytes.\n *\n * @param {number|string} val\n *\n * @returns {number|null}\n * @public\n */\n\nexport function parse(val) {\n  if (typeof val === 'number' && !isNaN(val)) {\n    return val\n  }\n\n  if (typeof val !== 'string') {\n    return null\n  }\n\n  // Test if the string passed is valid\n  var results = parseRegExp.exec(val)\n  var floatValue\n  var unit = 'b'\n\n  if (!results) {\n    // Nothing could be extracted from the given string\n    floatValue = parseInt(val, 10)\n    unit = 'b'\n  } else {\n    // Retrieve the value and the unit\n    floatValue = parseFloat(results[1])\n    unit = results[4].toLowerCase()\n  }\n\n  return Math.floor(map[unit] * floatValue)\n}","import compressible from './compressible'\nimport isJSON from '@goa/goa/modules/koa-is-json'\nimport { empty } from '@goa/statuses'\nimport Stream from 'stream'\nimport { createGzip, createDeflate } from 'zlib'\nimport bytes from './bytes'\n\n/**\n * Encoding methods supported.\n */\nconst encodingMethods = {\n  gzip: createGzip,\n  deflate: createDeflate,\n}\n\n/**\n * @type {_goa.compress}\n */\nfunction Compress(options = {}) {\n  let { filter = compressible, threshold = 1024 } = options\n  if (typeof threshold == 'string') threshold = bytes(threshold)\n\n  /**\n   * @type {!_idio.Middleware}\n   */\n  async function middleware(ctx, next) {\n    ctx.vary('Accept-Encoding')\n\n    await next()\n\n    let { body } = ctx\n    if (!body) return\n    if (ctx.res.headersSent || !ctx.writable) return\n    if (ctx.compress === false) return\n    if (ctx.request.method == 'HEAD') return\n    if (empty[ctx.response.status]) return\n    if (ctx.response.get('Content-Encoding')) return\n\n    // forced compression or implied\n    if (!(ctx.compress === true || filter(ctx.response.type))) return\n\n    // identity\n    const encoding = /** @type {string} */ (ctx.acceptsEncodings('gzip', 'deflate', 'identity'))\n    if (!encoding) ctx.throw(406, 'supported encodings: gzip, deflate, identity')\n    if (encoding == 'identity') return\n\n    // json\n    if (isJSON(body)) body = ctx.body = JSON.stringify(body)\n\n    // threshold\n    if (threshold && ctx.response.length < threshold) return\n\n    ctx.set('Content-Encoding', encoding)\n    ctx.res.removeHeader('Content-Length')\n\n    const stream = ctx.body = encodingMethods[encoding](options)\n\n    if (body instanceof Stream) {\n      body.pipe(stream)\n    } else {\n      stream.end(body)\n    }\n  }\n  return /** @type {!_goa.Middleware} */ (middleware)\n}\n\nexport default Compress\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/idio').Middleware} _idio.Middleware\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CompressConfig} _goa.CompressConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').compress} _goa.compress\n */","import compose from '@goa/compose'\nimport session from '@goa/session'\nimport Keygrip from '@goa/cookies/src/Keygrip'\nimport cors from '@goa/cors'\nimport serve from '../modules/koa-static'\nimport Mount from '../modules/koa-mount'\nimport compress from '@goa/compress'\nimport { Z_SYNC_FLUSH } from 'zlib'\n\nconst map = {\n  // multer: setupMulter,\n  // csrf: setupCsrf,\n  // bodyparser: setupBodyParser,\n  // checkauth: setupCheckAuth,\n  // logger: setupLogger,\n  /**\n   * @param {!_goa.Application} app\n   * @param {_idio.KoaStaticConfig} config\n   * @param {_idio.StaticOptions} options\n   */\n  'static'(app, config, {\n    root = [],\n    maxage,\n    mount,\n  }) {\n    const roots = Array.isArray(root) ? root : [root]\n    const m = roots.map((r) => {\n      const fn = serve(r, {\n        maxage,\n        ...config,\n      })\n      return fn\n    })\n    const c = compose(m)\n    if (mount) return Mount(mount, c)\n    return c\n  },\n  /**\n   * @param {!_goa.Application} app\n   * @param {_goa.CompressConfig} config\n   * @param {_idio.CompressOptions} options\n   */\n  'compress'(app, config, {\n    threshold = 1024,\n  }) {\n    const fn = compress({\n      threshold,\n      flush: Z_SYNC_FLUSH,\n      ...config,\n    })\n    return fn\n  },\n  /**\n   * The session middleware.\n   * @param {!_goa.Application} app\n   * @param {!_idio.SessionConfig} config\n   * @param {!_idio.SessionOptions} options\n   */\n  'session'(app, config, { keys }) {\n    if (!(keys instanceof Keygrip) && !Array.isArray(keys))\n      throw new Error('Keys must be an array or an instance of Keygrip / child classes.')\n\n    app.keys = keys\n    const ses = session(config)\n    return ses\n  },\n  /**\n   * The CORS middleware.\n   * @param {!_goa.Application} app\n   * @param {_goa.CorsConfig} config\n   * @param {_idio.CorsOptions} options\n   */\n  'cors'(app, config, { origin }) {\n    const o = Array.isArray(origin) ? (ctx) => {\n      const oh = ctx.get('Origin')\n      const found = origin.find(a => a == oh)\n      return found\n    } : origin\n    const fn = cors({\n      origin: o,\n      ...config,\n    })\n    return fn\n  },\n  // frontend: setupFrontend,\n}\n\n/**\n * Initialise the middleware function, either using the middleware constructors from the bundle, or a custom one.\n * @param {string} name The name of the middleware.\n * @param {!_idio.ConfigItem} conf The item from the middleware config.\n * @param {!_goa.Application} app The application instance.\n */\nasync function initMiddleware(name, conf, app) {\n  if (typeof conf == 'function') {\n    const c = conf\n    app.use(c)\n    return c\n  }\n  const { use, config = {}, middlewareConstructor,\n    ...options } = conf\n\n  /** @type {!_idio.MiddlewareConstructor} */\n  let fn\n  if (name in map) {\n    fn = map[name]\n  } else if (middlewareConstructor) {\n    fn = middlewareConstructor\n    if (typeof fn != 'function') {\n      throw new Error(`Expecting a function in the \"middlewareConstructor\" of the ${name} middleware.`)\n    }\n  } else {\n    throw new Error(`Unknown middleware config item \"${name}\". Either specify one from the idio bundle, or pass the \"middlewareConstructor\" property.`)\n  }\n  const res = await fn(app, config, options)\n\n  if (use) app.use(res)\n  return res\n}\n\n/**\n * @param {!_idio.MiddlewareConfig} middlewareConfig\n * @param {!_goa.Application} app\n */\nexport default async function setupMiddleware(middlewareConfig, app) {\n  /** @type {Object.<string, !_goa.Middleware>} */\n  const res = await Object.keys(middlewareConfig)\n    .reduce(async (acc, name) => {\n      acc = await acc\n      const conf = middlewareConfig[name]\n      let installed\n      if (Array.isArray(conf)) {\n        const p = conf.map(async (c) => {\n          await initMiddleware(name, c, app)\n        })\n        installed = await Promise.all(p)\n      } else {\n        installed = await initMiddleware(name, conf, app)\n      }\n      return {\n        ...acc,\n        [name]: installed,\n      }\n    }, {})\n  return res\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/goa').Application} _goa.Application\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/goa').Middleware} _goa.Middleware\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').StaticOptions} _idio.StaticOptions\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CompressOptions} _idio.CompressOptions\n */\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').SessionOptions} _idio.SessionOptions\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').SessionConfig} _idio.SessionConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CorsOptions} _idio.CorsOptions\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CorsConfig} _goa.CorsConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').KoaStaticConfig} _idio.KoaStaticConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CompressConfig} _goa.CompressConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').MiddlewareConfig} _idio.MiddlewareConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').ConfigItem} _idio.ConfigItem\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').MiddlewareConstructor} _idio.MiddlewareConstructor\n */","/**\n * @license MIT 2014 Jordan Harband\n * https://github.com/ljharb/is-generator-function\n */\nconst toStr = Object.prototype.toString\nconst fnToStr = Function.prototype.toString\nconst isFnRegex = /^\\s*(?:function)?\\*/\nconst hasToStringTag = typeof Symbol == 'function' && typeof Symbol.toStringTag == 'symbol'\nconst getProto = Object.getPrototypeOf\nconst getGeneratorFunc = function () { // eslint-disable-line consistent-return\n  if (!hasToStringTag) {\n    return false\n  }\n  try {\n    return Function('return function*() {}')()\n  } catch (e) { /**/}\n}\nconst generatorFunc = getGeneratorFunc()\nconst GeneratorFunction = generatorFunc ? getProto(generatorFunc) : {}\n\n/**\n * Check if the function is a generator function.\n * @param {!Function} fn The function to check for being a generator.\n */\nexport default function isGeneratorFunction(fn) {\n  if (typeof fn != 'function') {\n    return false\n  }\n  if (isFnRegex.test(fnToStr.call(fn))) {\n    return true\n  }\n  if (!hasToStringTag) {\n    const str = toStr.call(fn)\n    return str == '[object GeneratorFunction]'\n  }\n  return getProto(fn) == GeneratorFunction\n}","export default http\nexport const {\n  Agent,\n  ClientRequest,\n  IncomingMessage,\n  METHODS,\n  OutgoingMessage,\n  STATUS_CODES,\n  Server,\n  ServerResponse,\n  createServer,\n  get,\n  globalAgent,\n  maxHeaderSize,\n  request,\n} = http","export default events\nexport const {\n  EventEmitter,\n} = events","/*!\n * ee-first\n * Copyright(c) 2014 Jonathan Ong\n * MIT Licensed\n */\n\n/**\n * Get the first event in a set of event emitters and event pairs.\n *\n * @param {!Array} stuff\n * @param {Function} done\n */\nexport default function first(stuff, done) {\n  if (!Array.isArray(stuff))\n    throw new TypeError('arg must be an array of [ee, events...] arrays')\n\n  var cleanups = []\n\n  for (var i = 0; i < stuff.length; i++) {\n    var arr = stuff[i]\n\n    if (!Array.isArray(arr) || arr.length < 2)\n      throw new TypeError('each array member must be [ee, events...]')\n\n    var ee = arr[0]\n\n    for (var j = 1; j < arr.length; j++) {\n      var event = arr[j]\n      var fn = listener(event, callback)\n\n      // listen to the event\n      ee.on(event, fn)\n      // push this listener to the list of cleanups\n      cleanups.push({\n        ee: ee,\n        event: event,\n        fn: fn,\n      })\n    }\n  }\n\n  function callback() {\n    cleanup()\n    done.apply(null, arguments)\n  }\n\n  function cleanup() {\n    var x\n    for (var i = 0; i < cleanups.length; i++) {\n      x = cleanups[i]\n      x.ee.removeListener(x.event, x.fn)\n    }\n  }\n\n  function thunk(fn) {\n    done = fn\n  }\n\n  thunk.cancel = cleanup\n\n  return thunk\n}\n\n/**\n * Create the event listener.\n * @private\n */\nfunction listener(event, done) {\n  return function onevent(arg1) {\n    var args = new Array(arguments.length)\n    var ee = this\n    var err = event == 'error'\n      ? arg1\n      : null\n\n    // copy args to prevent arguments escaping scope\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i]\n    }\n\n    done(err, ee, event, args)\n  }\n}\n","/*!\n * on-finished\n * Copyright(c) 2013 Jonathan Ong\n * Copyright(c) 2014 Douglas Christopher Wilson\n * MIT Licensed\n */\n\nimport first from '../ee-first'\n\n/**\n * Invoke callback when the response has finished, useful for\n * cleaning up resources afterwards.\n *\n * @param {!(http.IncomingMessage|http.OutgoingMessage)} msg\n * @param {!Function} listener\n */\nexport default function onFinished(msg, listener) {\n  if (isFinished(msg) !== false) {\n    setImmediate(listener, null, msg)\n    return msg\n  }\n\n  // attach the listener to the message\n  attachListener(msg, listener)\n\n  return msg\n}\n\n/**\n * Determine if message is already finished.\n *\n * @param {!(http.IncomingMessage|http.OutgoingMessage)} msg\n * @public\n */\nexport function isFinished(msg) {\n  const socket = msg.socket\n\n  if (typeof msg.finished == 'boolean') {\n    // OutgoingMessage\n    return Boolean(msg.finished || (socket && !socket.writable))\n  }\n\n  if (typeof msg.complete == 'boolean') {\n    // IncomingMessage\n    /**\n     * @suppress {checkTypes}\n     */\n    const u = msg['upgrade']\n    return Boolean(u || !socket || !socket.readable || (msg.complete && !msg.readable))\n  }\n\n  // don't know\n  return undefined\n}\n\n/**\n * Attach a finished listener to the message.\n *\n * @param {!(http.IncomingMessage|http.OutgoingMessage)} msg\n * @param {Function} callback\n * @private\n */\nfunction attachFinishedListener(msg, callback) {\n  var eeMsg\n  var eeSocket\n  var finished = false\n\n  function onFinish(error) {\n    eeMsg.cancel()\n    eeSocket.cancel()\n\n    finished = true\n    callback(error)\n  }\n\n  // finished on first message event\n  eeMsg = eeSocket = first([[msg, 'end', 'finish']], onFinish)\n\n  function onSocket(socket) {\n    // remove listener\n    msg.removeListener('socket', onSocket)\n\n    if (finished) return\n    if (eeMsg !== eeSocket) return\n\n    // finished on first socket event\n    eeSocket = first([[socket, 'error', 'close']], onFinish)\n  }\n\n  if (msg.socket) {\n    // socket already assigned\n    onSocket(msg.socket)\n    return\n  }\n\n  // wait for socket to be assigned\n  msg.on('socket', onSocket)\n}\n\n/**\n * Attach the listener to the message.\n *\n * @param {!(http.IncomingMessage|http.OutgoingMessage)} msg\n * @private\n */\nfunction attachListener(msg, listener) {\n  var attached = msg.__onFinished\n\n  // create a private single listener with queue\n  if (!attached || !attached.queue) {\n    attached = msg.__onFinished = createListener(msg)\n    attachFinishedListener(msg, attached)\n  }\n\n  attached.queue.push(listener)\n}\n\n/**\n * Create listener on message.\n *\n * @param {!(http.IncomingMessage|http.OutgoingMessage)} msg\n * @return {Function}\n * @private\n */\nfunction createListener(msg) {\n  function listener(err) {\n    if (msg.__onFinished === listener) msg.__onFinished = null\n    if (!listener.queue) return\n\n    var queue = listener.queue\n    listener.queue = null\n\n    for (var i = 0; i < queue.length; i++) {\n      queue[i](err, msg)\n    }\n  }\n\n  listener.queue = []\n\n  return listener\n}\n\n// /**\n//  * Patch ServerResponse.prototype.assignSocket for node.js 0.8.\n//  *\n//  * @param {!http.ServerResponse} res\n//  * @param {Function} callback\n//  * @private\n//  */\n// function patchAssignSocket(res, callback) {\n//   /** @suppress {checkTypes} */\n//   const assignSocket = res['assignSocket']\n\n//   if (typeof assignSocket != 'function') return\n\n//   // res.on('socket', callback) is broken in 0.8\n//   res.assignSocket = function _assignSocket(socket) {\n//     assignSocket.call(this, socket)\n//     callback(socket)\n//   }\n// }\n\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').OutgoingMessage} http.OutgoingMessage\n */","import { ReadStream } from 'fs'\nimport Stream from 'stream'\n\n/**\n * Destroy a stream.\n * @param {!(Stream|ReadStream)} stream\n */\nexport default function destroy(stream) {\n  if (stream instanceof ReadStream) {\n    return destroyReadStream(stream)\n  }\n\n  if (!(stream instanceof Stream)) {\n    return stream\n  }\n\n  if (typeof stream.destroy == 'function') {\n    stream.destroy()\n  }\n\n  return stream\n}\n\n/**\n * Destroy a ReadStream.\n * @param {!ReadStream} stream\n * @private\n */\nfunction destroyReadStream(stream) {\n  stream.destroy()\n\n  if (typeof stream.close == 'function') {\n    // node.js core bug work-around\n    stream.on('open', onOpenClose)\n  }\n\n  return stream\n}\n\n/**\n * On open handler to close stream.\n * @this {Stream}\n * @private\n */\nfunction onOpenClose() {\n  if (typeof this.fd == 'number') {\n    // actually close down the fd\n    this.close()\n  }\n}\n\n/**\n * @license MIT\n * Copyright(c) 2014 Jonathan Ong\n * https://npmjs.org/destroy\n */","const db = require(/* ok depack*/ 'mime-db')\nimport { extname } from 'path'\n\nconst EXTRACT_TYPE_REGEXP = /^\\s*([^;\\s]*)(?:;|\\s|$)/\nconst TEXT_TYPE_REGEXP = /^text\\//i\n\nexport const charsets = { 'lookup': charset }\n\nexport const extensions = Object.create(null)\nexport const types = Object.create(null)\n\n// Populate the extensions/types maps\npopulateMaps(extensions, types)\n\n/**\n * Get the default charset for a MIME type.\n * @param {string} type\n * @return {boolean|string}\n */\nexport function charset(type) {\n  if (!type || typeof type != 'string') return false\n\n  // TODO: use media-typer\n  const match = EXTRACT_TYPE_REGEXP.exec(type)\n  const mime = match && db[match[1].toLowerCase()]\n\n  if (mime && mime['charset']) return mime['charset']\n\n  // default text/* to utf-8\n  if (match && TEXT_TYPE_REGEXP.test(match[1])) return 'UTF-8'\n\n  return false\n}\n\n/**\n * Create a full Content-Type header given a MIME type or extension.\n * @param {string} str\n * @return {boolean|string}\n */\nexport function contentType(str) {\n  // TODO: should this even be in this module?\n  if (!str || typeof str != 'string') return false\n\n  let mime = str.indexOf('/') == -1\n    ? lookup(str)\n    : str\n\n  if (!mime) return false\n\n  let m = /** @type {string} */ (mime)\n  // TODO: use content-type or other module\n  if (!m.includes('charset')) {\n    const c = charset(m)\n    if (c) m += '; charset=' + c.toLowerCase()\n  }\n\n  return m\n}\n\n/**\n * Get the default extension for a MIME type.\n * @param {string} type\n * @return {boolean|string}\n */\nexport function extension(type) {\n  if (!type || typeof type != 'string') return false\n\n  // TODO: use media-typer\n  const match = EXTRACT_TYPE_REGEXP.exec(type)\n\n  // get extensions\n  const exts = match && extensions[match[1].toLowerCase()]\n\n  if (!exts || !exts.length) return false\n\n  return exts[0]\n}\n\n/**\n * Lookup the MIME type for a file path/extension.\n * @param {string} path\n * @return {boolean|string}\n */\nexport function lookup(path) {\n  if (!path || typeof path != 'string') return false\n\n  // get the extension (\"ext\" or \".ext\" or full path)\n  let e = extname('x.' + path)\n    .toLowerCase()\n    .substr(1)\n\n  if (!e) return false\n\n  return types[e] || false\n}\n\n/**\n * Populate the extensions and types maps.\n * @private\n */\nfunction populateMaps(es, ts) {\n  // source preference (least -> most)\n  const preference = ['nginx', 'apache', undefined, 'iana']\n\n  Object.keys(db).forEach((type) => {\n    const mime = db[type]\n    const exts = mime['extensions']\n\n    if (!exts || !exts.length) return\n\n    // mime -> extensions\n    es[type] = exts\n\n    // extension -> mime\n    for (let i = 0; i < exts.length; i++) {\n      const e = exts[i]\n\n      if (ts[e]) {\n        const from = preference.indexOf(db[ts[e]]['source'])\n        const to = preference.indexOf(mime['source'])\n\n        if (ts[e] != 'application/octet-stream' &&\n          (from > to || (from == to && ts[e].substr(0, 12) == 'application/'))) {\n          // skip the remapping\n          continue\n        }\n      }\n\n      // set the extension -> mime\n      ts[e] = type\n    }\n  })\n}\n\n/**\n * @license MIT\n * Copyright (c) 2014 Jonathan Ong <me@jongleberry.com>\n * Copyright (c) 2015 Douglas Christopher Wilson <doug@somethingdoug.com>\n * https://npmjs.com/package/mime-types\n */","/**\n * RegExp to match *( \";\" parameter ) in RFC 7231 sec 3.1.1.1\n *\n * parameter     = token \"=\" ( token / quoted-string )\n * token         = 1*tchar\n * tchar         = \"!\" / \"#\" / \"$\" / \"%\" / \"&\" / \"'\" / \"*\"\n *               / \"+\" / \"-\" / \".\" / \"^\" / \"_\" / \"`\" / \"|\" / \"~\"\n *               / DIGIT / ALPHA\n *               ; any VCHAR, except delimiters\n * quoted-string = DQUOTE *( qdtext / quoted-pair ) DQUOTE\n * qdtext        = HTAB / SP / %x21 / %x23-5B / %x5D-7E / obs-text\n * obs-text      = %x80-FF\n * quoted-pair   = \"\\\" ( HTAB / SP / VCHAR / obs-text )\n */\nconst PARAM_REGEXP = /; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *(\"(?:[\\u000b\\u0020\\u0021\\u0023-\\u005b\\u005d-\\u007e\\u0080-\\u00ff]|\\\\[\\u000b\\u0020-\\u00ff])*\"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g\nconst TEXT_REGEXP = /^[\\u000b\\u0020-\\u007e\\u0080-\\u00ff]+$/\nconst TOKEN_REGEXP = /^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/\n\n/**\n * RegExp to match quoted-pair in RFC 7230 sec 3.2.6\n *\n * quoted-pair = \"\\\" ( HTAB / SP / VCHAR / obs-text )\n * obs-text    = %x80-FF\n */\nconst QESC_REGEXP = /\\\\([\\u000b\\u0020-\\u00ff])/g\n\n/**\n * RegExp to match chars that must be quoted-pair in RFC 7230 sec 3.2.6\n */\nconst QUOTE_REGEXP = /([\\\\\"])/g\n\n/**\n * RegExp to match type in RFC 7231 sec 3.1.1.1\n *\n * media-type = type \"/\" subtype\n * type       = token\n * subtype    = token\n */\nconst TYPE_REGEXP = /^[!#$%&'*+.^_`|~0-9A-Za-z-]+\\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/\n\n/**\n * Format object to media type.\n *\n * @param {!ContentType} obj\n */\nexport function format(obj) {\n  if (!obj || typeof obj !== 'object') {\n    throw new TypeError('argument obj is required')\n  }\n\n  const { parameters, type } = obj\n\n  if (!type || !TYPE_REGEXP.test(type)) {\n    throw new TypeError('invalid type')\n  }\n\n  let string = type\n\n  // append parameters\n  if (parameters && typeof parameters == 'object') {\n    let param\n    const params = Object.keys(parameters).sort()\n\n    for (let i = 0; i < params.length; i++) {\n      param = params[i]\n\n      if (!TOKEN_REGEXP.test(param)) {\n        throw new TypeError('invalid parameter name')\n      }\n\n      string += '; ' + param + '=' + qstring(parameters[param])\n    }\n  }\n\n  return string\n}\n\n/**\n * Parse media type to object.\n * @param {string|!http.IncomingMessage|!http.ServerResponse} string\n */\nexport function parse(string) {\n  if (!string) {\n    throw new TypeError('argument string is required')\n  }\n\n  // support req/res-like objects as argument\n  const header = typeof string == 'object'\n    ? getcontenttype(string)\n    : string\n\n  if (typeof header != 'string') {\n    throw new TypeError('argument string is required to be a string')\n  }\n\n  let index = header.indexOf(';')\n  const type = index != -1\n    ? header.substr(0, index).trim()\n    : header.trim()\n\n  if (!TYPE_REGEXP.test(type)) {\n    throw new TypeError('invalid media type')\n  }\n\n  const obj = new ContentType(type.toLowerCase())\n\n  // parse parameters\n  if (index != -1) {\n    let key\n    let match\n    let value\n\n    PARAM_REGEXP.lastIndex = index\n\n    while ((match = PARAM_REGEXP.exec(header))) {\n      if (match.index !== index) {\n        throw new TypeError('invalid parameter format')\n      }\n\n      index += match[0].length\n      key = match[1].toLowerCase()\n      value = match[2]\n\n      if (value[0] == '\"') {\n        // remove quotes and escapes\n        value = value\n          .substr(1, value.length - 2)\n          .replace(QESC_REGEXP, '$1')\n      }\n\n      obj.parameters[key] = value\n    }\n\n    if (index != header.length) {\n      throw new TypeError('invalid parameter format')\n    }\n  }\n\n  return obj\n}\n\n/**\n * Get content-type from req/res objects.\n *\n * @param {!http.IncomingMessage|!http.ServerResponse|string} obj\n */\nfunction getcontenttype(obj) {\n  let header\n\n  if (typeof obj.getHeader == 'function') {\n    // res-like\n    header = obj.getHeader('content-type')\n  } else if (typeof obj.headers == 'object') {\n    // req-like\n    const h = /** @type {!Object} */ (obj.headers)\n    header = h && h['content-type']\n  }\n\n  if (typeof header != 'string') {\n    throw new TypeError('content-type header is missing from object')\n  }\n\n  return header\n}\n\n/**\n * Quote a string if necessary.\n *\n * @param {string} val\n * @private\n */\nfunction qstring(val) {\n  const str = String(val)\n\n  // no need to quote tokens\n  if (TOKEN_REGEXP.test(str)) {\n    return str\n  }\n\n  if (str.length > 0 && !TEXT_REGEXP.test(str)) {\n    throw new TypeError('invalid parameter value')\n  }\n\n  return '\"' + str.replace(QUOTE_REGEXP, '\\\\$1') + '\"'\n}\n\n/**\n * Class to represent a content type.\n * @implements {_goa.ContentType}\n */\nclass ContentType {\n  constructor(type) {\n    this.parameters = {}\n    this.type = type\n  }\n}\n\n/**\n * @license MIT content-type\n * 2015 Douglas Christopher Wilson\n */\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').ServerResponse} http.ServerResponse\n */\n","/**\n * RegExp to match type in RFC 6838\n *\n * type-name = restricted-name\n * subtype-name = restricted-name\n * restricted-name = restricted-name-first *126restricted-name-chars\n * restricted-name-first  = ALPHA / DIGIT\n * restricted-name-chars  = ALPHA / DIGIT / \"!\" / \"#\" /\n *                          \"$\" / \"&\" / \"-\" / \"^\" / \"_\"\n * restricted-name-chars =/ \".\" ; Characters before first dot always\n *                              ; specify a facet name\n * restricted-name-chars =/ \"+\" ; Characters after last plus always\n *                              ; specify a structured syntax suffix\n * ALPHA =  %x41-5A / %x61-7A   ; A-Z / a-z\n * DIGIT =  %x30-39             ; 0-9\n */\nconst SUBTYPE_NAME_REGEXP = /^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/\nconst TYPE_NAME_REGEXP = /^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/\nconst TYPE_REGEXP = /^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/\n\n/**\n * Format object to media type.\n *\n * @param {MediaType} obj\n */\nexport function format(obj) {\n  if (!obj || typeof obj !== 'object') {\n    throw new TypeError('argument obj is required')\n  }\n\n  const { subtype, suffix, type } = obj\n\n  if (!type || !TYPE_NAME_REGEXP.test(type)) {\n    throw new TypeError('invalid type')\n  }\n\n  if (!subtype || !SUBTYPE_NAME_REGEXP.test(subtype)) {\n    throw new TypeError('invalid subtype')\n  }\n\n  // format as type/subtype\n  let string = [type, subtype].join('/')\n\n  // append +suffix\n  if (suffix) {\n    if (!TYPE_NAME_REGEXP.test(suffix)) {\n      throw new TypeError('invalid suffix')\n    }\n\n    string += '+' + suffix\n  }\n\n  return string\n}\n\n/**\n * Test media type.\n *\n * @param {string} string\n */\nexport function test(string) {\n  if (!string) {\n    throw new TypeError('argument string is required')\n  }\n\n  if (typeof string != 'string') {\n    throw new TypeError('argument string is required to be a string')\n  }\n\n  return TYPE_REGEXP.test(string.toLowerCase())\n}\n\n/**\n * Parse media type to object.\n *\n * @param {string} string\n */\nexport function parse(string) {\n  if (!string) {\n    throw new TypeError('argument string is required')\n  }\n\n  if (typeof string !== 'string') {\n    throw new TypeError('argument string is required to be a string')\n  }\n\n  const match = TYPE_REGEXP.exec(string.toLowerCase())\n\n  if (!match) {\n    throw new TypeError('invalid media type')\n  }\n\n  const type = match[1]\n  let subtype = match[2]\n  let suffix\n\n  // suffix after last +\n  const index = subtype.lastIndexOf('+')\n  if (index != -1) {\n    suffix = subtype.substr(index + 1)\n    subtype = subtype.substr(0, index)\n  }\n\n  return new MediaType(type, subtype, suffix)\n}\n\n/**\n * Class for MediaType object.\n */\nclass MediaType {\n  constructor(type, subtype, suffix) {\n    this.type = type\n    this.subtype = subtype\n    this.suffix = suffix\n  }\n}\n\n/**\n * @license MIT media-typer\n * 2014-2017 Douglas Christopher Wilson\n */","import { lookup } from '@goa/mime-types'\nimport { parse } from '@goa/content-type'\nimport http from 'http' // eslint-disable-line\nimport { test } from './media-typer'\n\nexport { typeis as is }\nexport { hasbody as hasBody }\nexport { mimeMatch as match }\n\n/**\n * Compare a `value` content-type with `types`.\n * Each `type` can be an extension like `html`,\n * a special shortcut like `multipart` or `urlencoded`,\n * or a mime type.\n *\n * If no types match, `false` is returned.\n * Otherwise, the first `type` that matches is returned.\n *\n * @param {string} value\n * @param {!Array<string>|string} [types]\n * @param {...string} args\n */\nfunction typeis(value, types, ...args) {\n  let i\n  // remove parameters and normalize\n  const val = tryNormalizeType(value)\n\n  // no type or invalid\n  if (!val) {\n    return false\n  }\n\n  // support flattened arguments\n  if (types && !Array.isArray(types)) {\n    types = [types, ...args]\n  }\n\n  // no types, return the content type\n  if (!types || !types.length) {\n    return val\n  }\n\n  let type\n  for (i = 0; i < types.length; i++) {\n    if (mimeMatch(normalize(type = types[i]), val)) {\n      return type[0] == '+' || type.indexOf('*') !== -1\n        ? val\n        : type\n    }\n  }\n\n  // no matches\n  return false\n}\n\n/**\n * Check if a request has a request body.\n * A request with a body __must__ either have `transfer-encoding`\n * or `content-length` headers set.\n * http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.3\n *\n * @param {http.IncomingMessage} req\n */\nfunction hasbody(req) {\n  const headers = /** @type {Object} */ (req.headers)\n  return headers['transfer-encoding'] !== undefined ||\n    !isNaN(headers['content-length'])\n}\n\n/**\n * Check if the incoming request contains the \"Content-Type\"\n * header field, and it contains any of the give mime `type`s.\n * If there is no request body, `null` is returned.\n * If there is no content type, `false` is returned.\n * Otherwise, it returns the first `type` that matches.\n *\n * Examples:\n *\n *     // With Content-Type: text/html; charset=utf-8\n *     this.is('html'); // => 'html'\n *     this.is('text/html'); // => 'text/html'\n *     this.is('text/*', 'application/json'); // => 'text/html'\n *\n *     // When Content-Type is application/json\n *     this.is('json', 'urlencoded'); // => 'json'\n *     this.is('application/json'); // => 'application/json'\n *     this.is('html', 'application/*'); // => 'application/json'\n *\n *     this.is('html'); // => false\n *\n * @param {http.IncomingMessage} req\n * @param {string|!Array<string>} [types]\n * @param {...string} args\n */\nexport default function typeofrequest(req, types, ...args) {\n  // no body\n  if (!hasbody(req)) {\n    return null\n  }\n\n  // support flattened arguments\n  if (arguments.length > 2) {\n    types = [types, ...args]\n  }\n\n  // request content type\n  const headers = /** @type {Object} */ (req.headers)\n  const value = headers['content-type']\n\n  return typeis(value, types)\n}\n\n/**\n * Normalize a mime type.\n * If it's a shorthand, expand it to a valid mime type.\n *\n * In general, you probably want:\n *\n *   var type = is(req, ['urlencoded', 'json', 'multipart']);\n *\n * Then use the appropriate body parsers.\n * These three are the most common request body types\n * and are thus ensured to work.\n *\n * @param {string} type\n * @private\n */\nfunction normalize(type) {\n  if (typeof type != 'string') {\n    // invalid type\n    return false\n  }\n\n  switch (type) {\n  case 'urlencoded':\n    return 'application/x-www-form-urlencoded'\n  case 'multipart':\n    return 'multipart/*'\n  }\n\n  if (type[0] == '+') {\n    // \"+json\" -> \"*/*+json\" expando\n    return '*/*' + type\n  }\n\n  return type.indexOf('/') == -1\n    ? lookup(type)\n    : type\n}\n\n/**\n * Check if `expected` mime type matches `actual` mime type with wildcard and +suffix support.\n *\n * @param {string|boolean} expected\n * @param {string} actual\n * @private\n */\nfunction mimeMatch(expected, actual) {\n  // invalid type\n  if (expected === false) {\n    return false\n  }\n\n  // split types\n  const actualParts = actual.split('/')\n  const expectedParts = expected.split('/')\n\n  // invalid format\n  if (actualParts.length != 2 || expectedParts.length != 2) {\n    return false\n  }\n\n  // validate type\n  if (expectedParts[0] != '*' && expectedParts[0] != actualParts[0]) {\n    return false\n  }\n\n  // validate suffix wildcard\n  if (expectedParts[1].substr(0, 2) == '*+') {\n    return expectedParts[1].length <= actualParts[1].length + 1 &&\n      expectedParts[1].substr(1) == actualParts[1].substr(1 - expectedParts[1].length)\n  }\n\n  // validate subtype\n  if (expectedParts[1] != '*' && expectedParts[1] != actualParts[1]) {\n    return false\n  }\n\n  return true\n}\n\n/**\n * Normalize a type and remove parameters.\n * @param {string} value\n * @private\n */\nfunction normalizeType(value) {\n  // parse the type\n  const { type } = parse(value)\n\n  if (!test(type)) {\n    return null\n  }\n\n  return type\n}\n\n/**\n * Try to normalize a type and remove parameters.\n * @param {string} value\n * @private\n */\nfunction tryNormalizeType(value) {\n  if (typeof value != 'string') {\n    return null\n  }\n\n  try {\n    return normalizeType(value)\n  } catch (err) {\n    return null\n  }\n}\n\n/**\n * @license MIT\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * https://npmjs.org/type-is\n */","/*!\n * content-disposition\n * Copyright(c) 2014-2017 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n\nimport { basename } from 'path'\n\n/**\n * RegExp to match non attr-char, *after* encodeURIComponent (i.e. not including \"%\")\n * @private\n */\n\nvar ENCODE_URL_ATTR_CHAR_REGEXP = /[\\x00-\\x20\"'()*,/:;<=>?@[\\\\\\]{}\\x7f]/g // eslint-disable-line no-control-regex\n\n/**\n * RegExp to match percent encoding escape.\n * @private\n */\n\nvar HEX_ESCAPE_REGEXP = /%[0-9A-Fa-f]{2}/\nvar HEX_ESCAPE_REPLACE_REGEXP = /%([0-9A-Fa-f]{2})/g\n\n/**\n * RegExp to match non-latin1 characters.\n * @private\n */\n\nvar NON_LATIN1_REGEXP = /[^\\x20-\\x7e\\xa0-\\xff]/g\n\n/**\n * RegExp to match quoted-pair in RFC 2616\n *\n * quoted-pair = \"\\\" CHAR\n * CHAR        = <any US-ASCII character (octets 0 - 127)>\n * @private\n */\n\nvar QESC_REGEXP = /\\\\([\\u0000-\\u007f])/g // eslint-disable-line no-control-regex\n\n/**\n * RegExp to match chars that must be quoted-pair in RFC 2616\n * @private\n */\n\nvar QUOTE_REGEXP = /([\\\\\"])/g\n\n/**\n * RegExp for various RFC 2616 grammar\n *\n * parameter     = token \"=\" ( token | quoted-string )\n * token         = 1*<any CHAR except CTLs or separators>\n * separators    = \"(\" | \")\" | \"<\" | \">\" | \"@\"\n *               | \",\" | \";\" | \":\" | \"\\\" | <\">\n *               | \"/\" | \"[\" | \"]\" | \"?\" | \"=\"\n *               | \"{\" | \"}\" | SP | HT\n * quoted-string = ( <\"> *(qdtext | quoted-pair ) <\"> )\n * qdtext        = <any TEXT except <\">>\n * quoted-pair   = \"\\\" CHAR\n * CHAR          = <any US-ASCII character (octets 0 - 127)>\n * TEXT          = <any OCTET except CTLs, but including LWS>\n * LWS           = [CRLF] 1*( SP | HT )\n * CRLF          = CR LF\n * CR            = <US-ASCII CR, carriage return (13)>\n * LF            = <US-ASCII LF, linefeed (10)>\n * SP            = <US-ASCII SP, space (32)>\n * HT            = <US-ASCII HT, horizontal-tab (9)>\n * CTL           = <any US-ASCII control character (octets 0 - 31) and DEL (127)>\n * OCTET         = <any 8-bit sequence of data>\n * @private\n */\n\nvar PARAM_REGEXP = /;[\\x09\\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\\x09\\x20]*=[\\x09\\x20]*(\"(?:[\\x20!\\x23-\\x5b\\x5d-\\x7e\\x80-\\xff]|\\\\[\\x20-\\x7e])*\"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\\x09\\x20]*/g // eslint-disable-line no-control-regex\nvar TEXT_REGEXP = /^[\\x20-\\x7e\\x80-\\xff]+$/\nvar TOKEN_REGEXP = /^[!#$%&'*+.0-9A-Z^_`a-z|~-]+$/\n\n/**\n * RegExp for various RFC 5987 grammar\n *\n * ext-value     = charset  \"'\" [ language ] \"'\" value-chars\n * charset       = \"UTF-8\" / \"ISO-8859-1\" / mime-charset\n * mime-charset  = 1*mime-charsetc\n * mime-charsetc = ALPHA / DIGIT\n *               / \"!\" / \"#\" / \"$\" / \"%\" / \"&\"\n *               / \"+\" / \"-\" / \"^\" / \"_\" / \"`\"\n *               / \"{\" / \"}\" / \"~\"\n * language      = ( 2*3ALPHA [ extlang ] )\n *               / 4ALPHA\n *               / 5*8ALPHA\n * extlang       = *3( \"-\" 3ALPHA )\n * value-chars   = *( pct-encoded / attr-char )\n * pct-encoded   = \"%\" HEXDIG HEXDIG\n * attr-char     = ALPHA / DIGIT\n *               / \"!\" / \"#\" / \"$\" / \"&\" / \"+\" / \"-\" / \".\"\n *               / \"^\" / \"_\" / \"`\" / \"|\" / \"~\"\n * @private\n */\n\nvar EXT_VALUE_REGEXP = /^([A-Za-z0-9!#$%&+\\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/\n\n/**\n * RegExp for various RFC 6266 grammar\n *\n * disposition-type = \"inline\" | \"attachment\" | disp-ext-type\n * disp-ext-type    = token\n * disposition-parm = filename-parm | disp-ext-parm\n * filename-parm    = \"filename\" \"=\" value\n *                  | \"filename*\" \"=\" ext-value\n * disp-ext-parm    = token \"=\" value\n *                  | ext-token \"=\" ext-value\n * ext-token        = <the characters in token, followed by \"*\">\n * @private\n */\n\nvar DISPOSITION_TYPE_REGEXP = /^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\\x09\\x20]*(?:$|;)/ // eslint-disable-line no-control-regex\n\n/**\n * Create an attachment Content-Disposition header.\n *\n * @param {string} [filename]\n * @param {Object} [options]\n * @param {string} [options.type=attachment]\n * @param {string|boolean} [options.fallback=true]\n */\nexport default function contentDisposition(filename, options = {}) {\n  const { type = 'attachment', fallback = true } = options\n\n  // get parameters\n  const params = createparams(filename, fallback)\n\n  // format into string\n  return format(new ContentDisposition(type, params))\n}\n\n/**\n * Create parameters object from filename and fallback.\n *\n * @param {string} [filename]\n * @param {string|boolean} [fallback=true]\n */\nfunction createparams(filename, fallback = true) {\n  if (filename === undefined) {\n    return\n  }\n\n  var params = {}\n\n  if (typeof filename != 'string') {\n    throw new TypeError('filename must be a string')\n  }\n\n  if (typeof fallback != 'string' && typeof fallback != 'boolean') {\n    throw new TypeError('fallback must be a string or boolean')\n  }\n\n  if (typeof fallback == 'string' && NON_LATIN1_REGEXP.test(fallback)) {\n    throw new TypeError('fallback must be ISO-8859-1 string')\n  }\n\n  // restrict to file base name\n  var name = basename(filename)\n\n  // determine if name is suitable for quoted string\n  var isQuotedString = TEXT_REGEXP.test(name)\n\n  // generate fallback name\n  const fallbackName = typeof fallback != 'string'\n    ? fallback && getlatin1(name)\n    : basename(fallback)\n  const hasFallback = typeof fallbackName == 'string' && fallbackName != name\n\n  // set extended filename parameter\n  if (hasFallback || !isQuotedString || HEX_ESCAPE_REGEXP.test(name)) {\n    params['filename*'] = name\n  }\n\n  // set filename parameter\n  if (isQuotedString || hasFallback) {\n    params.filename = hasFallback\n      ? fallbackName\n      : name\n  }\n\n  return params\n}\n\n/**\n * Format object to Content-Disposition header.\n * @param {!ContentDisposition} obj\n * @private\n */\nfunction format({ parameters, type }) {\n  if (typeof type != 'string' || !TOKEN_REGEXP.test(type)) {\n    throw new TypeError('invalid type')\n  }\n\n  // start with normalized type\n  let string = `${type}`.toLowerCase()\n\n  // append parameters\n  if (parameters && typeof parameters == 'object') {\n    let param\n    const params = Object.keys(parameters).sort()\n\n    for (let i = 0; i < params.length; i++) {\n      param = params[i]\n\n      const val = param.substr(-1) == '*'\n        ? ustring(parameters[param])\n        : qstring(parameters[param])\n\n      string += '; ' + param + '=' + val\n    }\n  }\n\n  return string\n}\n\n/**\n * Decode a RFC 6987 field value (gracefully).\n *\n * @param {string} str\n * @return {string}\n * @private\n */\n\nfunction decodefield (str) {\n  var match = EXT_VALUE_REGEXP.exec(str)\n\n  if (!match) {\n    throw new TypeError('invalid extended field value')\n  }\n\n  var charset = match[1].toLowerCase()\n  var encoded = match[2]\n  var value\n\n  // to binary string\n  var binary = encoded.replace(HEX_ESCAPE_REPLACE_REGEXP, pdecode)\n\n  switch (charset) {\n  case 'iso-8859-1':\n    value = getlatin1(binary)\n    break\n  case 'utf-8':\n    value = Buffer.from(binary, 'binary').toString('utf8')\n    break\n  default:\n    throw new TypeError('unsupported charset in extended field')\n  }\n\n  return value\n}\n\n/**\n * Get ISO-8859-1 version of string.\n *\n * @param {string} val\n * @return {string}\n * @private\n */\n\nfunction getlatin1 (val) {\n  // simple Unicode -> ISO-8859-1 transformation\n  return String(val).replace(NON_LATIN1_REGEXP, '?')\n}\n\n/**\n * Parse Content-Disposition header string.\n *\n * @param {string} string\n * @return {Object}\n * @public\n */\n\nexport function parse (string) {\n  if (!string || typeof string !== 'string') {\n    throw new TypeError('argument string is required')\n  }\n\n  var match = DISPOSITION_TYPE_REGEXP.exec(string)\n\n  if (!match) {\n    throw new TypeError('invalid type format')\n  }\n\n  // normalize type\n  var index = match[0].length\n  var type = match[1].toLowerCase()\n\n  var key\n  var names = []\n  var params = {}\n  var value\n\n  // calculate index to start at\n  index = PARAM_REGEXP.lastIndex = match[0].substr(-1) === ';'\n    ? index - 1\n    : index\n\n  // match parameters\n  while ((match = PARAM_REGEXP.exec(string))) {\n    if (match.index !== index) {\n      throw new TypeError('invalid parameter format')\n    }\n\n    index += match[0].length\n    key = match[1].toLowerCase()\n    value = match[2]\n\n    if (names.indexOf(key) !== -1) {\n      throw new TypeError('invalid duplicate parameter')\n    }\n\n    names.push(key)\n\n    if (key.indexOf('*') + 1 === key.length) {\n      // decode extended value\n      key = key.slice(0, -1)\n      value = decodefield(value)\n\n      // overwrite existing value\n      params[key] = value\n      continue\n    }\n\n    if (typeof params[key] === 'string') {\n      continue\n    }\n\n    if (value[0] === '\"') {\n      // remove quotes and escapes\n      value = value\n        .substr(1, value.length - 2)\n        .replace(QESC_REGEXP, '$1')\n    }\n\n    params[key] = value\n  }\n\n  if (index !== -1 && index !== string.length) {\n    throw new TypeError('invalid parameter format')\n  }\n\n  return new ContentDisposition(type, params)\n}\n\n/**\n * Percent decode a single character.\n *\n * @param {string} str\n * @param {string} hex\n * @return {string}\n * @private\n */\n\nfunction pdecode (str, hex) {\n  return String.fromCharCode(parseInt(hex, 16))\n}\n\n/**\n * Percent encode a single character.\n *\n * @param {string} char\n * @return {string}\n * @private\n */\n\nfunction pencode (char) {\n  return '%' + String(char)\n    .charCodeAt(0)\n    .toString(16)\n    .toUpperCase()\n}\n\n/**\n * Quote a string for HTTP.\n *\n * @param {string} val\n * @return {string}\n * @private\n */\n\nfunction qstring (val) {\n  var str = String(val)\n\n  return '\"' + str.replace(QUOTE_REGEXP, '\\\\$1') + '\"'\n}\n\n/**\n * Encode a Unicode string for HTTP (RFC 5987).\n *\n * @param {string} val\n * @return {string}\n * @private\n */\n\nfunction ustring (val) {\n  var str = String(val)\n\n  // percent encode as UTF-8\n  var encoded = encodeURIComponent(str)\n    .replace(ENCODE_URL_ATTR_CHAR_REGEXP, pencode)\n\n  return 'UTF-8\\'\\'' + encoded\n}\n\n/**\n * Class for parsed Content-Disposition header for v8 optimization\n */\nclass ContentDisposition {\n  /**\n   * @param {string} type\n   * @param {Object} parameters\n   */\n  constructor(type, parameters) {\n    this.type = type\n    this.parameters = parameters\n  }\n}","import Stream from 'stream'\n\nexport default function (stream, error) {\n  if (stream instanceof Stream && !stream.listeners('error').includes(error)) {\n    stream.on('error', error)\n  }\n  return stream\n}\n\n/**\n * @license MIT\n * Author dead_horse <dead_horse@qq.com>\n * https://github.com/node-modules/error-inject\n */","import { contentType } from '@goa/mime-types'\n\nexport default type => {\n  let mimeType = typeLRUCache.get(type)\n  if (!mimeType) {\n    mimeType = contentType(type)\n    typeLRUCache.set(type, mimeType)\n  }\n  return mimeType\n}\n\n/**\n * Extends LRU base on hashlru.\n */\nclass LRU {\n  constructor(max) {\n    this.max = max\n    this.size = 0\n    this.cache = new Map()\n    this._cache = new Map()\n  }\n\n  get(key, options = {}) {\n    let item = this.cache.get(key)\n    const { maxAge } = options\n    // only call Date.now() when necessary\n    let now\n    function getNow() {\n      now = now || Date.now()\n      return now\n    }\n    if (item) {\n      // check expired\n      if (item.expired && getNow() > item.expired) {\n        item.expired = 0\n        item.value = undefined\n      } else {\n        // update expired in get\n        if (maxAge !== undefined) {\n          const expired = maxAge ? getNow() + maxAge : 0\n          item.expired = expired\n        }\n      }\n      return item.value\n    }\n\n    // try to read from _cache\n    item = this._cache.get(key)\n    if (item) {\n      // check expired\n      if (item.expired && getNow() > item.expired) {\n        item.expired = 0\n        item.value = undefined\n      } else {\n        // not expired, save to cache\n        this._update(key, item)\n        // update expired in get\n        if (maxAge !== undefined) {\n          const expired = maxAge ? getNow() + maxAge : 0\n          item.expired = expired\n        }\n      }\n      return item.value\n    }\n  }\n\n  set(key, value, options = {}) {\n    const { maxAge } = options\n    const expired = maxAge ? Date.now() + maxAge : 0\n    let item = this.cache.get(key)\n    if (item) {\n      item.expired = expired\n      item.value = value\n    } else {\n      item = {\n        value,\n        expired,\n      }\n      this._update(key, item)\n    }\n  }\n\n  keys() {\n    const cacheKeys = new Set()\n    const now = Date.now()\n\n    for (const entry of this.cache.entries()) {\n      checkEntry(entry)\n    }\n\n    for (const entry of this._cache.entries()) {\n      checkEntry(entry)\n    }\n\n    function checkEntry(entry) {\n      const key = entry[0]\n      const item = entry[1]\n      if (entry[1].value && (!entry[1].expired) || item.expired >= now) {\n        cacheKeys.add(key)\n      }\n    }\n\n    return Array.from(cacheKeys.keys())\n  }\n\n  _update(key, item) {\n    this.cache.set(key, item)\n    this.size++\n    if (this.size >= this.max) {\n      this.size = 0\n      this._cache = this.cache\n      this.cache = new Map()\n    }\n  }\n}\n\nconst typeLRUCache = new LRU(100)\n\n\n/**\n * @license MIT\n * [cache-content-type] Author dead_horse <dead_horse@qq.com>\n * https://github.com/node-modules/cache-content-type\n * [ylru] Author fengmk2\n * https://github.com/node-modules/ylru\n */","/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\n\nvar matchHtmlRegExp = /[\"'&<>]/\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n */\nexport default function escapeHtml(string) {\n  var str = '' + string\n  var match = matchHtmlRegExp.exec(str)\n\n  if (!match) {\n    return str\n  }\n\n  var escape\n  var html = ''\n  var index = 0\n  var lastIndex = 0\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n    case 34: // \"\n      escape = '&quot;'\n      break\n    case 38: // &\n      escape = '&amp;'\n      break\n    case 39: // '\n      escape = '&#39;'\n      break\n    case 60: // <\n      escape = '&lt;'\n      break\n    case 62: // >\n      escape = '&gt;'\n      break\n    default:\n      continue\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index)\n    }\n\n    lastIndex = index + 1\n    html += escape\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html\n}\n","/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\nconst fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/\n\n/**\n * RegExp to match Same-Site cookie attribute value.\n */\nconst sameSiteRegExp = /^(?:lax|strict)$/i\n\n/**\n * @implements {_goa.CookieAttributes}\n */\nexport default class Cookie {\n  /**\n   * @param {string} name\n   * @param {?string} [value]\n   * @param {!_goa.CookieAttributes} [attrs]\n   */\n  constructor(name, value, attrs) {\n    this.path = '/'\n    this.expires = undefined\n    this.domain = undefined\n    this.maxAge = undefined\n    this.httpOnly = true\n    this.sameSite = false\n    this.secure = false\n    this.overwrite = false\n\n    if (!fieldContentRegExp.test(name)) {\n      throw new TypeError('argument name is invalid')\n    }\n\n    if (value && !fieldContentRegExp.test(value)) {\n      throw new TypeError('argument value is invalid')\n    }\n\n    value || (this.expires = new Date(0))\n\n    this.name = name\n    this.value = value || ''\n\n    for (let n in attrs) {\n      /** @suppress {checkTypes} */\n      this[n] = attrs[n]\n    }\n\n    if (this.path && !fieldContentRegExp.test(this.path)) {\n      throw new TypeError('option path is invalid')\n    }\n\n    if (this.domain && !fieldContentRegExp.test(this.domain)) {\n      throw new TypeError('option domain is invalid')\n    }\n\n    if (this.sameSite && this.sameSite !== true && !sameSiteRegExp.test(this.sameSite)) {\n      throw new TypeError('option sameSite is invalid')\n    }\n  }\n  toHeader() {\n    var header = this.toString()\n\n    if (this.maxAge) this.expires = new Date(Date.now() + this.maxAge)\n\n    if (this.path) header += '; path=' + this.path\n    if (this.expires) header += '; expires=' + this.expires.toUTCString()\n    if (this.domain) header += '; domain=' + this.domain\n    if (this.sameSite) {\n      header += '; samesite='\n      if (this.sameSite === true) header += 'strict'\n      else {\n        /**\n         * @suppress {checkTypes}\n         * @type {string}\n         */\n        const sameSite = this.sameSite.toLowerCase()\n        header += sameSite\n      }\n    }\n    if (this.secure) header += '; secure'\n    if (this.httpOnly) header += '; httponly'\n\n    return header\n  }\n  toString() {\n    return this.name + '=' + this.value\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').CookieAttributes} _goa.CookieAttributes\n */","/*!\n * cookies\n * Copyright(c) 2014 Jed Schmidt, http://jed.is/\n * Copyright(c) 2015-2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\nimport Keygrip from './Keygrip'\nimport { OutgoingMessage } from 'http'\nimport Cookie from './Cookie'\n\nconst cache = {}\n\n/**\n * @implements {_goa.Cookies}\n */\nexport default class Cookies {\n  /**\n   * Creates a new cookies object to handle cookies.\n   * @param {!http.IncomingMessage} request\n   * @param {!http.ServerResponse} response\n   * @param {!_goa.CookiesOptions} [options] Options for the constructor.\n   */\n  constructor(request, response, options) {\n    this.secure = undefined\n    this.request = request\n    this.response = response\n    if (options) {\n      /** @type {!_goa.Keygrip|undefined} */\n      this.keys = Array.isArray(options.keys) ? new Keygrip(options.keys) : options.keys\n      this.secure = options.secure\n    }\n  }\n  /**\n   * @param {string} name\n   * @param {{ signed: boolean }} [opts]\n   */\n  get(name, opts) {\n    const sigName = `${name}.sig`\n    let header, match, index\n    const signed = opts && opts.signed !== undefined ? opts.signed : !!this.keys\n\n    /** @suppress {checkTypes} */\n    header = this.request.headers['cookie']\n    if (!header) return\n\n    match = header.match(getPattern(name))\n    if (!match) return\n\n    const value = match[1]\n    if (!opts || !signed) return value\n\n    const remote = this.get(sigName)\n    if (!remote) return\n\n    const data = name + '=' + value\n    if (!this.keys) throw new Error('.keys required for signed cookies')\n    index = this.keys.index(data, remote)\n\n    if (index < 0) {\n      this.set(sigName, null, { path: '/', signed: false })\n    } else {\n      index && this.set(sigName, this.keys.sign(data), { signed: false })\n      return value\n    }\n  }\n  /**\n   * @param {string} name The name of the cookie to set.\n   * @param {?string} [value] The value of the cookie to set.\n   * @param {!_goa.CookieSetOptions} [opts] How the cookie will be set.\n   * @param {boolean} [opts.signed=false] Indicating whether the cookie is to be signed. If this is true, another cookie of the same name with the .sig suffix appended will also be sent, with a 27-byte url-safe base64 SHA1 value representing the hash of cookie-name=cookie-value against the first Keygrip key. This signature key is used to detect tampering the next time a cookie is received. Default `false`.\n   */\n  set(name, value, opts = {}) {\n    const { response: res, request: req } = this\n    let headers = /** @type {!Array<string>} */ (res.getHeader('Set-Cookie')) || []\n    if (typeof headers == 'string') headers = [headers]\n\n    /** @suppress {checkTypes} */\n    const proto = req['protocol']\n    /** @suppress {checkTypes} */\n    const encrypted = req.connection['encrypted']\n    let secure = this.secure !== undefined ? !!this.secure : proto == 'https' || encrypted\n\n    const { signed = !!this.keys, ...rest } = opts\n    const cookie = new Cookie(name, value, rest)\n\n    if (!secure && opts.secure) {\n      throw new Error('Cannot send secure cookie over unencrypted connection')\n    }\n\n    cookie.secure = secure\n    if (!('secure' in opts)) cookie.secure = secure\n\n    pushCookie(headers, cookie)\n\n    if (opts && signed) {\n      if (!this.keys) throw new Error('.keys required for signed cookies')\n      cookie.value = this.keys.sign(cookie.toString())\n      cookie.name += '.sig'\n      pushCookie(headers, cookie)\n    }\n\n    /** @suppress {checkTypes} */\n    const set = res['set']\n    const setHeader = set ? OutgoingMessage.prototype.setHeader : res.setHeader\n    setHeader.call(res, 'Set-Cookie', headers)\n    return this\n  }\n}\n\nfunction getPattern(name) {\n  if (cache[name]) return cache[name]\n\n  return cache[name] = new RegExp(\n    '(?:^|;) *' +\n    name.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&') +\n    '=([^;]*)'\n  )\n}\n\n/**\n * @param {!Array<string>} headers\n * @param {!Cookie} cookie\n */\nfunction pushCookie(headers, cookie) {\n  if (cookie.overwrite) {\n    for (var i = headers.length - 1; i >= 0; i--) {\n      if (headers[i].indexOf(cookie.name + '=') === 0) {\n        headers.splice(i, 1)\n      }\n    }\n  }\n\n  headers.push(cookie.toHeader())\n}\n\nexport const connect = (keys) => {\n  return (req, res, next) => {\n    req['cookies'] = res['cookies'] = new Cookies(req, res, { keys })\n    next()\n  }\n}\nexport const express = connect\n\nexport { Keygrip }\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').IncomingMessage} http.IncomingMessage\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').ServerResponse} http.ServerResponse\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CookieAttributes} _goa.CookieAttributes\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').Keygrip} _goa.Keygrip\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CookiesOptions} _goa.CookiesOptions\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CookieSetOptions} _goa.CookieSetOptions\n */","const simpleCharsetRegExp = /^\\s*([^\\s;]+)\\s*(?:;(.*))?$/\n\n/**\n * Parse the Accept-Charset header.\n * @param {string} accept\n * @private\n */\nfunction parseAcceptCharset(accept) {\n  const accepts = accept.split(',')\n\n  const res = accepts.map((a, i) => {\n    const charset = parseCharset(a.trim(), i)\n    if (charset) return charset\n  }).filter(Boolean)\n\n  return res\n}\n\n/**\n * Parse a charset from the Accept-Charset header.\n * @param {string} str\n * @param {number} i\n * @private\n */\nfunction parseCharset(str, i) {\n  const match = simpleCharsetRegExp.exec(str)\n  if (!match) return null\n\n  const charset = match[1]\n  let q = 1\n  if (match[2]) {\n    const params = match[2].split(';')\n    for (let j = 0; j < params.length; j++) {\n      const p = params[j].trim().split('=')\n      if (p[0] == 'q') {\n        q = parseFloat(p[1])\n        break\n      }\n    }\n  }\n\n  return { charset, q, i }\n}\n\n/**\n * Get the priority of a charset.\n * @param {string} charset\n * @param {!Array<{ i: number, q: number, charset: string }>} accepted\n * @param {number} index\n */\nfunction getCharsetPriority(charset, accepted, index) {\n  let priority = { o: -1, q: 0, s: 0 }\n\n  for (let i = 0; i < accepted.length; i++) {\n    const spec = specify(charset, accepted[i], index)\n\n    if (spec && (priority.s - spec.s || priority.q - spec.q || priority.o - spec.o) < 0) {\n      priority = spec\n    }\n  }\n\n  return priority\n}\n\n/**\n * Get the specificity of the charset.\n * @param {string} charset\n * @param {{ i: number, q: number, charset: string }} spec\n * @private\n */\nfunction specify(charset, spec, i) {\n  let s = 0\n  if(spec.charset.toLowerCase() === charset.toLowerCase()){\n    s |= 1\n  } else if (spec.charset != '*' ) return null\n\n  return {\n    i,\n    s,\n    o: spec.i,\n    q: spec.q,\n  }\n}\n\n/**\n * Get the preferred charsets from an Accept-Charset header.\n * @param {string} [accept]\n * @param {!Array<string>} [provided]\n */\nexport default function preferredCharsets(accept, provided) {\n  // RFC 2616 sec 14.2: no header = *\n  const accepts = parseAcceptCharset(accept === undefined ? '*' : accept || '')\n\n  if (!provided) {\n    // sorted list of all charsets\n    return accepts\n      .filter(isQuality)\n      .sort(compareSpecs)\n      .map(getFullCharset)\n  }\n\n  const priorities = provided.map((type, i) => {\n    return getCharsetPriority(type, accepts, i)\n  })\n\n  // sorted list of accepted charsets\n  return priorities.filter(isQuality).sort(compareSpecs).map((priority) => {\n    return provided[priorities.indexOf(priority)]\n  })\n}\n\n/**\n * Compare two specs.\n * @param {{ i: number, q: number, charset: string, o: number, s: number }} a\n * @param {{ i: number, q: number, charset: string, o: number, s: number }} b\n * @private\n */\nfunction compareSpecs(a, b) {\n  return (b.q - a.q) || (b.s - a.s) || (a.o - b.o) || (a.i - b.i) || 0\n}\n\n/**\n * Get full charset string.\n * @param {{ charset: string }} spec\n * @private\n */\nfunction getFullCharset(spec) {\n  return spec.charset\n}\n\n/**\n * Check if a spec has any quality.\n * @param {{ q: number }} spec\n * @private\n */\nfunction isQuality(spec) {\n  return spec.q > 0\n}\n","const simpleEncodingRegExp = /^\\s*([^\\s;]+)\\s*(?:;(.*))?$/\n\n/**\n * Parse the Accept-Encoding header.\n * @private\n */\n\nfunction parseAcceptEncoding(accept) {\n  var accepts = accept.split(',')\n  var hasIdentity = false\n  var minQuality = 1\n\n  for (var i = 0, j = 0; i < accepts.length; i++) {\n    var encoding = parseEncoding(accepts[i].trim(), i)\n\n    if (encoding) {\n      accepts[j++] = encoding\n      hasIdentity = hasIdentity || specify('identity', encoding, undefined)\n      minQuality = Math.min(minQuality, encoding.q || 1)\n    }\n  }\n\n  if (!hasIdentity) {\n    /*\n     * If identity doesn't explicitly appear in the accept-encoding header,\n     * it's added to the list of acceptable encoding with the lowest q\n     */\n    accepts[j++] = {\n      encoding: 'identity',\n      q: minQuality,\n      i: i,\n    }\n  }\n\n  // trim accepts\n  accepts.length = j\n\n  return accepts\n}\n\n/**\n * Parse an encoding from the Accept-Encoding header.\n * @private\n */\n\nfunction parseEncoding(str, i) {\n  var match = simpleEncodingRegExp.exec(str)\n  if (!match) return null\n\n  var encoding = match[1]\n  var q = 1\n  if (match[2]) {\n    var params = match[2].split(';')\n    for (var j = 0; j < params.length; j++) {\n      var p = params[j].trim().split('=')\n      if (p[0] == 'q') {\n        q = parseFloat(p[1])\n        break\n      }\n    }\n  }\n\n  return {\n    encoding: encoding,\n    q: q,\n    i: i,\n  }\n}\n\n/**\n * Get the priority of an encoding.\n * @private\n */\n\nfunction getEncodingPriority(encoding, accepted, index) {\n  var priority = { o: -1, q: 0, s: 0 }\n\n  for (var i = 0; i < accepted.length; i++) {\n    var spec = specify(encoding, accepted[i], index)\n\n    if (spec && (priority.s - spec.s || priority.q - spec.q || priority.o - spec.o) < 0) {\n      priority = spec\n    }\n  }\n\n  return priority\n}\n\n/**\n * Get the specificity of the encoding.\n * @private\n */\n\nfunction specify(encoding, spec, index) {\n  var s = 0\n  if(spec.encoding.toLowerCase() === encoding.toLowerCase()){\n    s |= 1\n  } else if (spec.encoding !== '*' ) {\n    return null\n  }\n\n  return {\n    i: index,\n    o: spec.i,\n    q: spec.q,\n    s: s,\n  }\n}\n\n/**\n * Get the preferred encodings from an Accept-Encoding header.\n * @public\n */\nexport default function preferredEncodings(accept, provided) {\n  var accepts = parseAcceptEncoding(accept || '')\n\n  if (!provided) {\n    // sorted list of all encodings\n    return accepts\n      .filter(isQuality)\n      .sort(compareSpecs)\n      .map(getFullEncoding)\n  }\n\n  var priorities = provided.map(function getPriority(type, index) {\n    return getEncodingPriority(type, accepts, index)\n  })\n\n  // sorted list of accepted encodings\n  return priorities.filter(isQuality).sort(compareSpecs).map(function getEncoding(priority) {\n    return provided[priorities.indexOf(priority)]\n  })\n}\n\n/**\n * Compare two specs.\n * @private\n */\n\nfunction compareSpecs(a, b) {\n  return (b.q - a.q) || (b.s - a.s) || (a.o - b.o) || (a.i - b.i) || 0\n}\n\n/**\n * Get full encoding string.\n * @private\n */\n\nfunction getFullEncoding(spec) {\n  return spec.encoding\n}\n\n/**\n * Check if a spec has any quality.\n * @private\n */\n\nfunction isQuality(spec) {\n  return spec.q > 0\n}","const simpleLanguageRegExp = /^\\s*([^\\s\\-;]+)(?:-([^\\s;]+))?\\s*(?:;(.*))?$/\n\n/**\n * Parse the Accept-Language header.\n * @private\n */\nfunction parseAcceptLanguage(accept) {\n  var accepts = accept.split(',')\n\n  for (var i = 0, j = 0; i < accepts.length; i++) {\n    var language = parseLanguage(accepts[i].trim(), i)\n\n    if (language) {\n      accepts[j++] = language\n    }\n  }\n\n  // trim accepts\n  accepts.length = j\n\n  return accepts\n}\n\n/**\n * Parse a language from the Accept-Language header.\n * @private\n */\nfunction parseLanguage(str, i) {\n  var match = simpleLanguageRegExp.exec(str)\n  if (!match) return null\n\n  var prefix = match[1],\n    suffix = match[2],\n    full = prefix\n\n  if (suffix) full += \"-\" + suffix\n\n  var q = 1\n  if (match[3]) {\n    var params = match[3].split(';')\n    for (var j = 0; j < params.length; j++) {\n      var p = params[j].split('=')\n      if (p[0] == 'q') q = parseFloat(p[1])\n    }\n  }\n\n  return { prefix, suffix, q, i, full }\n}\n\n/**\n * Get the priority of a language.\n * @private\n */\nfunction getLanguagePriority(language, accepted, index) {\n  var priority = { o: -1, q: 0, s: 0 }\n\n  for (var i = 0; i < accepted.length; i++) {\n    var spec = specify(language, accepted[i], index)\n\n    if (spec && (priority.s - spec.s || priority.q - spec.q || priority.o - spec.o) < 0) {\n      priority = spec\n    }\n  }\n\n  return priority\n}\n\n/**\n * Get the specificity of the language.\n * @private\n */\n\nfunction specify(language, spec, index) {\n  var p = parseLanguage(language, undefined)\n  if (!p) return null\n  var s = 0\n  if(spec.full.toLowerCase() === p.full.toLowerCase()){\n    s |= 4\n  } else if (spec.prefix.toLowerCase() === p.full.toLowerCase()) {\n    s |= 2\n  } else if (spec.full.toLowerCase() === p.prefix.toLowerCase()) {\n    s |= 1\n  } else if (spec.full !== '*' ) {\n    return null\n  }\n\n  return {\n    i: index,\n    o: spec.i,\n    q: spec.q,\n    s: s,\n  }\n}\n\n/**\n * Get the preferred languages from an Accept-Language header.\n * @public\n */\nexport default function preferredLanguages(accept, provided) {\n  // RFC 2616 sec 14.4: no header = *\n  var accepts = parseAcceptLanguage(accept === undefined ? '*' : accept || '')\n\n  if (!provided) {\n    // sorted list of all languages\n    return accepts\n      .filter(isQuality)\n      .sort(compareSpecs)\n      .map(getFullLanguage)\n  }\n\n  var priorities = provided.map(function getPriority(type, index) {\n    return getLanguagePriority(type, accepts, index)\n  })\n\n  // sorted list of accepted languages\n  return priorities.filter(isQuality).sort(compareSpecs).map(function getLanguage(priority) {\n    return provided[priorities.indexOf(priority)]\n  })\n}\n\n/**\n * Compare two specs.\n * @private\n */\nfunction compareSpecs(a, b) {\n  return (b.q - a.q) || (b.s - a.s) || (a.o - b.o) || (a.i - b.i) || 0\n}\n\n/**\n * Get full language string.\n * @private\n */\nfunction getFullLanguage(spec) {\n  return spec.full\n}\n\n/**\n * Check if a spec has any quality.\n * @private\n */\nfunction isQuality(spec) {\n  return spec.q > 0\n}","const simpleMediaTypeRegExp = /^\\s*([^s/;]+)\\/([^;\\s]+)\\s*(?:;(.*))?$/\n\n/**\n * Parse the Accept header.\n * @private\n */\n\nfunction parseAccept(accept) {\n  var accepts = splitMediaTypes(accept)\n\n  for (var i = 0, j = 0; i < accepts.length; i++) {\n    var mediaType = parseMediaType(accepts[i].trim(), i)\n\n    if (mediaType) {\n      accepts[j++] = mediaType\n    }\n  }\n\n  // trim accepts\n  accepts.length = j\n\n  return accepts\n}\n\n/**\n * Parse a media type from the Accept header.\n * @private\n */\n\nfunction parseMediaType(str, i) {\n  var match = simpleMediaTypeRegExp.exec(str)\n  if (!match) return null\n\n  var params = Object.create(null)\n  var q = 1\n  var subtype = match[2]\n  var type = match[1]\n\n  if (match[3]) {\n    var kvps = splitParameters(match[3]).map(splitKeyValuePair)\n\n    for (var j = 0; j < kvps.length; j++) {\n      var pair = kvps[j]\n      var key = pair[0].toLowerCase()\n      var val = pair[1]\n\n      // get the value, unwrapping quotes\n      var value = val && val[0] === '\"' && val[val.length - 1] === '\"'\n        ? val.substr(1, val.length - 2)\n        : val\n\n      if (key === 'q') {\n        q = parseFloat(value)\n        break\n      }\n\n      // store parameter\n      params[key] = value\n    }\n  }\n\n  return {\n    type: type,\n    subtype: subtype,\n    params: params,\n    q: q,\n    i: i,\n  }\n}\n\n/**\n * Get the priority of a media type.\n * @private\n */\n\nfunction getMediaTypePriority(type, accepted, index) {\n  var priority = { o: -1, q: 0, s: 0 }\n\n  for (var i = 0; i < accepted.length; i++) {\n    var spec = specify(type, accepted[i], index)\n\n    if (spec && (priority.s - spec.s || priority.q - spec.q || priority.o - spec.o) < 0) {\n      priority = spec\n    }\n  }\n\n  return priority\n}\n\n/**\n * Get the specificity of the media type.\n * @private\n */\n\nfunction specify(type, spec, index) {\n  var p = parseMediaType(type, undefined)\n  var s = 0\n\n  if (!p) {\n    return null\n  }\n\n  if(spec.type.toLowerCase() == p.type.toLowerCase()) {\n    s |= 4\n  } else if(spec.type != '*') {\n    return null\n  }\n\n  if(spec.subtype.toLowerCase() == p.subtype.toLowerCase()) {\n    s |= 2\n  } else if(spec.subtype != '*') {\n    return null\n  }\n\n  var keys = Object.keys(spec.params)\n  if (keys.length > 0) {\n    if (keys.every(function (k) {\n      return spec.params[k] == '*' || (spec.params[k] || '').toLowerCase() == (p.params[k] || '').toLowerCase()\n    })) {\n      s |= 1\n    } else {\n      return null\n    }\n  }\n\n  return {\n    i: index,\n    o: spec.i,\n    q: spec.q,\n    s: s,\n  }\n}\n\nexport default function preferredMediaTypes(accept, provided) {\n  // RFC 2616 sec 14.2: no header = */*\n  var accepts = parseAccept(accept === undefined ? '*/*' : accept || '')\n\n  if (!provided) {\n    // sorted list of all types\n    return accepts\n      .filter(isQuality)\n      .sort(compareSpecs)\n      .map(getFullType)\n  }\n\n  var priorities = provided.map(function getPriority(type, index) {\n    return getMediaTypePriority(type, accepts, index)\n  })\n\n  // sorted list of accepted types\n  return priorities.filter(isQuality).sort(compareSpecs).map(function getType(priority) {\n    return provided[priorities.indexOf(priority)]\n  })\n}\n\n/**\n * Compare two specs.\n * @private\n */\n\nfunction compareSpecs(a, b) {\n  return (b.q - a.q) || (b.s - a.s) || (a.o - b.o) || (a.i - b.i) || 0\n}\n\n/**\n * Get full type string.\n * @private\n */\n\nfunction getFullType(spec) {\n  return spec.type + '/' + spec.subtype\n}\n\n/**\n * Check if a spec has any quality.\n * @private\n */\n\nfunction isQuality(spec) {\n  return spec.q > 0\n}\n\n/**\n * Count the number of quotes in a string.\n * @private\n */\n\nfunction quoteCount(string) {\n  var count = 0\n  var index = 0\n\n  while ((index = string.indexOf('\"', index)) !== -1) {\n    count++\n    index++\n  }\n\n  return count\n}\n\n/**\n * Split a key value pair.\n * @private\n */\n\nfunction splitKeyValuePair(str) {\n  var index = str.indexOf('=')\n  var key\n  var val\n\n  if (index === -1) {\n    key = str\n  } else {\n    key = str.substr(0, index)\n    val = str.substr(index + 1)\n  }\n\n  return [key, val]\n}\n\n/**\n * Split an Accept header into media types.\n * @private\n */\n\nfunction splitMediaTypes(accept) {\n  var accepts = accept.split(',')\n\n  for (var i = 1, j = 0; i < accepts.length; i++) {\n    if (quoteCount(accepts[j]) % 2 == 0) {\n      accepts[++j] = accepts[i]\n    } else {\n      accepts[j] += ',' + accepts[i]\n    }\n  }\n\n  // trim accepts\n  accepts.length = j + 1\n\n  return accepts\n}\n\n/**\n * Split a string of parameters.\n * @private\n */\n\nfunction splitParameters(str) {\n  var parameters = str.split(';')\n\n  for (var i = 1, j = 0; i < parameters.length; i++) {\n    if (quoteCount(parameters[j]) % 2 == 0) {\n      parameters[++j] = parameters[i]\n    } else {\n      parameters[j] += ';' + parameters[i]\n    }\n  }\n\n  // trim parameters\n  parameters.length = j + 1\n\n  for (var i = 0; i < parameters.length; i++) {\n    parameters[i] = parameters[i].trim()\n  }\n\n  return parameters\n}\n","import preferredCharsets from './lib/charset'\nimport preferredEncodings from './lib/encoding'\nimport preferredLanguages from './lib/language'\nimport preferredMediaTypes from './lib/mediaType'\nimport * as http from 'http' // eslint-disable-line\n\n/**\n * @implements {_goa.Negotiator}\n */\nexport default class Negotiator {\n  /** @param {!http.IncomingMessage} request */\n  constructor(request) {\n    this.request = request\n    this.headers = /** @type {!Object} */ (this.request.headers)\n  }\n  /** @param {!Array<string>} [available] */\n  charset(available) {\n    const set = this.charsets(available)\n    return set && set[0]\n  }\n  /** @param {!Array<string>} [available] */\n  charsets(available) {\n    return preferredCharsets(this.headers['accept-charset'], available)\n  }\n  /** @param {!Array<string>} [available] */\n  encoding(available) {\n    var set = this.encodings(available)\n    return set && set[0]\n  }\n  /** @param {!Array<string>} [available] */\n  encodings(available) {\n    return preferredEncodings(this.headers['accept-encoding'], available)\n  }\n  /** @param {!Array<string>} [available] */\n  language(available) {\n    var set = this.languages(available)\n    return set && set[0]\n  }\n  /** @param {!Array<string>} [available] */\n  languages(available) {\n    return preferredLanguages(this.headers['accept-language'], available)\n  }\n  /** @param {!Array<string>} [available] */\n  mediaType(available) {\n    var set = this.mediaTypes(available)\n    return set && set[0]\n  }\n  /** @param {!Array<string>} [available] */\n  mediaTypes(available) {\n    return preferredMediaTypes(this.headers['accept'], available)\n  }\n}\n\n/**\n * @license MIT\n * Copyright(c) 2012 Federico Romero\n * Copyright(c) 2012-2014 Isaac Z. Schlueter\n * Copyright(c) 2015 Douglas Christopher Wilson\n * https://npmjs.org/negotiator\n */\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */","import Negotiator from '@goa/negotiator'\nimport { lookup } from '@goa/mime-types'\n\n/**\n * @implements {_goa.Accepts}\n */\nexport default class Accepts {\n  /**\n   * Create a new Accepts object for the given req.\n   * @param {!http.IncomingMessage} req\n   */\n  constructor(req) {\n    this.headers = /** @type {!Object} */ (req.headers)\n    this.negotiator = new Negotiator(req)\n  }\n  /**\n   * Check if the given `type(s)` is acceptable, returning the best match when true, otherwise `false`, in which case you should respond with 406 \"Not Acceptable\".\n   *\n   * The `type` value may be a single mime type string such as \"application/json\", the extension name such as \"json\" or an array `[\"json\", \"html\", \"text/plain\"]`. When a list or array is given the _best_ match, if any is returned. When no types are given as arguments, returns all types accepted by the client in the preference order.\n   *\n   * @param {string|!Array<string>} [types] A single or multiple types, either as an array or variable arguments.\n   * @param {...string} args\n   */\n  types(types, ...args) {\n    // support flattened arguments\n    if (types && !Array.isArray(types)) {\n      types = [types, ...args]\n    }\n\n    // no types, return all requested types\n    if (!types || types.length == 0) {\n      return this.negotiator.mediaTypes()\n    }\n\n    // no accept header, return first given type\n    if (!this.headers['accept']) {\n      return types[0]\n    }\n\n    const mimes = types.map(extToMime)\n    const accepts = this.negotiator.mediaTypes(mimes.filter(validMime))\n    const [first] = accepts\n\n    return first\n      ? types[mimes.indexOf(first)]\n      : false\n  }\n  get type() {\n    return this.types\n  }\n  /**\n   * Return accepted encodings or best fit based on `encodings`.\n   *\n   * Given `Accept-Encoding: gzip, deflate`\n   * an array sorted by quality is returned:\n   *\n   *     ['gzip', 'deflate']\n   *\n   * @param {string|!Array<string>} [encodings]\n   * @param {...string} args\n   */\n  encodings(encodings, ...args) {\n    // support flattened arguments\n    if (encodings && !Array.isArray(encodings)) {\n      encodings = [encodings, ...args]\n    }\n\n    // no encodings, return all requested encodings\n    if (!encodings || encodings.length == 0) {\n      return this.negotiator.encodings()\n    }\n\n    return this.negotiator.encodings( /** @type {!Array<string>} */\n      (encodings))[0] || false\n  }\n  get encoding() {\n    return this.encodings\n  }\n  /**\n   * Return accepted charsets or best fit based on `charsets`.\n   *\n   * Given `Accept-Charset: utf-8, iso-8859-1;q=0.2, utf-7;q=0.5`\n   * an array sorted by quality is returned:\n   *\n   *     ['utf-8', 'utf-7', 'iso-8859-1']\n   *\n   * @param {string|!Array<string>} [charsets]\n   * @param {...string} args\n   */\n  charsets(charsets, ...args) {\n    // support flattened arguments\n    if (charsets && !Array.isArray(charsets)) {\n      charsets = [charsets, ...args]\n    }\n\n    // no charsets, return all requested charsets\n    if (!charsets || charsets.length == 0) {\n      return this.negotiator.charsets()\n    }\n\n    return this.negotiator.charsets( /** @type {!Array<string>} */\n      (charsets))[0] || false\n  }\n  get charset() {\n    return this.charsets\n  }\n  /**\n   * Return accepted languages or best fit based on `langs`.\n   *\n   * Given `Accept-Language: en;q=0.8, es, pt`\n   * an array sorted by quality is returned:\n   *\n   *     ['es', 'pt', 'en']\n   *\n   * @param {string|!Array<string>} [languages]\n   * @param {...string} args\n   */\n  languages(languages, ...args) {\n    // support flattened arguments\n    if (languages && !Array.isArray(languages)) {\n      languages = [languages, ...args]\n    }\n\n    // no languages, return all requested languages\n    if (!languages || languages.length == 0) {\n      return this.negotiator.languages()\n    }\n\n    return this.negotiator.languages(\n      /** @type {!Array<string>} */ (languages))[0] || false\n  }\n  get lang() {\n    return this.languages\n  }\n  get langs() {\n    return this.languages\n  }\n  get language() {\n    return this.languages\n  }\n}\n\n/**\n * Convert extnames to mime.\n * @param {string} type\n * @private\n */\nfunction extToMime(type) {\n  return type.indexOf('/') == -1\n    ? lookup(type)\n    : type\n}\n\n/**\n * Check if mime is valid.\n * @param {string} type\n * @private\n */\nfunction validMime(type) {\n  return typeof type == 'string'\n}\n\n/**\n * @license MIT\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2015 Douglas Christopher Wilson\n * https://npmjs.org/accepts\n */\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */","/**\n * Creates a delegator instance used to configure using the `prop` on the given\n`proto` object (which is usually a prototype).\n */\nexport default class Delegator {\n  /**\n   * Initialize a delegator.\n   * @param {!Object} proto\n   * @param {string} target\n   */\n  constructor(proto, target) {\n    this.proto = proto\n    this.target = target\n    /** @type {!Array<string>} */\n    this.methods = []\n    /** @type {!Array<string>} */\n    this.getters = []\n    /** @type {!Array<string>} */\n    this.setters = []\n    /** @type {!Array<string>} */\n    this.fluents = []\n  }\n  /**\n   * Delegate method `name`.\n   * @param {string} name\n   * @return {Delegator} self\n   */\n  method(name) {\n    const proto = this.proto\n    const target = this.target\n    this.methods.push(name)\n\n    proto[name] = function() {\n      return this[target][name].apply(this[target], arguments)\n    }\n\n    return this\n  }\n  /**\n   * Delegator accessor `name`.\n   * @param {string} name\n   * @return {Delegator} self\n   */\n  access(name) {\n    return this.getter(name).setter(name)\n  }\n  /**\n   * Delegator getter `name`.\n   * @param {string} name\n   * @return {Delegator} self\n   */\n  getter(name) {\n    const proto = this.proto\n    const target = this.target\n    this.getters.push(name)\n\n    proto.__defineGetter__(name, function() {\n      return this[target][name]\n    })\n\n    return this\n  }\n  /**\n   * Delegator setter `name`.\n   * @param {string} name\n   * @return {Delegator} self\n   */\n  setter(name) {\n    var proto = this.proto\n    var target = this.target\n    this.setters.push(name)\n\n    proto.__defineSetter__(name, function(val) {\n      return this[target][name] = val\n    })\n\n    return this\n  }\n  /**\n   * Delegator fluent accessor.\n   * @param {string} name\n   * @return {Delegator} self\n   */\n  fluent(name) {\n    var proto = this.proto\n    var target = this.target\n    this.fluents.push(name)\n\n    proto[name] = function(val ){\n      if (val !== undefined) {\n        this[target][name] = val\n        return this\n      } else {\n        return this[target][name]\n      }\n    }\n\n    return this\n  }\n}\n\n/**\n * @license MIT Copyright (c) 2015 TJ Holowaychuk <tj@vision-media.ca>\n * https://npmjs.org/delegates\n */","import createError from '@goa/http-errors'\n\n/**\n * @suppress {checkTypes}\n */\nexport default function assert(value, status, msg, opts) {\n  if (value) return\n  throw createError(status, msg, opts)\n}\n\n/**\n * @license MIT jshttp/http-assert\n */","export default url\nexport const {\n  URL,\n  URLSearchParams,\n  Url,\n  domainToASCII,\n  domainToUnicode,\n  format,\n  parse,\n  resolve,\n} = url","export default net\nexport const {\n  Server,\n  Socket,\n  Stream,\n  connect,\n  createConnection,\n  createServer,\n  isIP,\n  isIPv4,\n  isIPv6,\n} = net","export default querystring\nexport const {\n  decode,\n  encode,\n  escape,\n  parse,\n  stringify,\n  unescape,\n} = querystring","/*!\n * parseurl\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2014-2017 Douglas Christopher Wilson\n * MIT Licensed\n */\nimport { parse, Url } from 'url'\n\n/**\n * Parse the `req` url with memoization.\n *\n * @param {http.IncomingMessage} req\n */\nexport default function parseurl (req) {\n  var url = req.url\n\n  if (url === undefined) {\n    // URL is undefined\n    return undefined\n  }\n\n  var parsed = req._parsedUrl\n\n  if (fresh(url, parsed)) {\n    // Return cached URL parse\n    return parsed\n  }\n\n  // Parse the URL\n  parsed = fastparse(url)\n  parsed._raw = url\n\n  return (req._parsedUrl = parsed)\n}\n\n/**\n * Parse the `req` original url with fallback and memoization.\n *\n * @param {http.IncomingMessage} req\n */\n\nexport function original (req) {\n  const url = req.originalUrl\n\n  if (typeof url !== 'string') {\n    // Fallback\n    return parseurl(req)\n  }\n\n  var parsed = req._parsedOriginalUrl\n\n  if (fresh(url, parsed)) {\n    // Return cached URL parse\n    return parsed\n  }\n\n  // Parse the URL\n  parsed = fastparse(url)\n  parsed._raw = url\n\n  return (req._parsedOriginalUrl = parsed)\n}\n\n/**\n * Parse the `str` url with fast-path short-cut.\n *\n * @param {string} str\n * @return {Object}\n * @private\n */\n\nfunction fastparse (str) {\n  if (typeof str !== 'string' || str.charCodeAt(0) !== 0x2f /* / */) {\n    return parse(str)\n  }\n\n  var pathname = str\n  var query = null\n  var search = null\n\n  // This takes the regexp from https://github.com/joyent/node/pull/7878\n  // Which is /^(\\/[^?#\\s]*)(\\?[^#\\s]*)?$/\n  // And unrolls it into a for loop\n  for (var i = 1; i < str.length; i++) {\n    switch (str.charCodeAt(i)) {\n    case 0x3f: /* ?  */\n      if (search === null) {\n        pathname = str.substring(0, i)\n        query = str.substring(i + 1)\n        search = str.substring(i)\n      }\n      break\n    case 0x09: /* \\t */\n    case 0x0a: /* \\n */\n    case 0x0c: /* \\f */\n    case 0x0d: /* \\r */\n    case 0x20: /*    */\n    case 0x23: /* #  */\n    case 0xa0:\n    case 0xfeff:\n      return parse(str)\n    }\n  }\n\n  var url = Url !== undefined\n    ? new Url()\n    : {}\n\n  url['path'] = str\n  url['href'] = str\n  url['pathname'] = pathname\n\n  if (search !== null) {\n    url['query'] = query\n    url['search'] = search\n  }\n\n  return url\n}\n\n/**\n * Determine if parsed is still fresh for url.\n *\n * @param {string} url\n * @param {Object} parsedUrl\n * @private\n */\nfunction fresh (url, parsedUrl) {\n  return typeof parsedUrl === 'object' &&\n    parsedUrl !== null &&\n    (Url === undefined || parsedUrl instanceof Url) &&\n    parsedUrl['_raw'] === url\n}\n\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */","/*!\n * fresh\n * Copyright(c) 2012 TJ Holowaychuk\n * Copyright(c) 2016-2017 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n/**\n * RegExp to check for no-cache token in Cache-Control.\n * @private\n */\n\nvar CACHE_CONTROL_NO_CACHE_REGEXP = /(?:^|,)\\s*?no-cache\\s*?(?:,|$)/\n\n/**\n * Check freshness of the response using request and response headers.\n *\n * @param {Object} reqHeaders\n * @param {Object} resHeaders\n * @public\n */\n\nexport default function fresh (reqHeaders, resHeaders) {\n  // fields\n  var modifiedSince = reqHeaders['if-modified-since']\n  var noneMatch = reqHeaders['if-none-match']\n\n  // unconditional request\n  if (!modifiedSince && !noneMatch) {\n    return false\n  }\n\n  // Always return stale when Cache-Control: no-cache\n  // to support end-to-end reload requests\n  // https://tools.ietf.org/html/rfc2616#section-14.9.4\n  var cacheControl = reqHeaders['cache-control']\n  if (cacheControl && CACHE_CONTROL_NO_CACHE_REGEXP.test(cacheControl)) {\n    return false\n  }\n\n  // if-none-match\n  if (noneMatch && noneMatch !== '*') {\n    var etag = resHeaders['etag']\n\n    if (!etag) {\n      return false\n    }\n\n    var etagStale = true\n    var matches = parseTokenList(noneMatch)\n    for (var i = 0; i < matches.length; i++) {\n      var match = matches[i]\n      if (match === etag || match === 'W/' + etag || 'W/' + match === etag) {\n        etagStale = false\n        break\n      }\n    }\n\n    if (etagStale) {\n      return false\n    }\n  }\n\n  // if-modified-since\n  if (modifiedSince) {\n    var lastModified = resHeaders['last-modified']\n    var modifiedStale = !lastModified || !(parseHttpDate(lastModified) <= parseHttpDate(modifiedSince))\n\n    if (modifiedStale) {\n      return false\n    }\n  }\n\n  return true\n}\n\n/**\n * Parse an HTTP Date into a number.\n *\n * @param {string} date\n * @private\n */\n\nfunction parseHttpDate (date) {\n  var timestamp = date && Date.parse(date)\n\n  // istanbul ignore next: guard against date.js Date.parse patching\n  return typeof timestamp === 'number'\n    ? timestamp\n    : NaN\n}\n\n/**\n * Parse a HTTP token list.\n *\n * @param {string} str\n * @private\n */\n\nfunction parseTokenList (str) {\n  var end = 0\n  var list = []\n  var start = 0\n\n  // gather tokens\n  for (var i = 0, len = str.length; i < len; i++) {\n    switch (str.charCodeAt(i)) {\n      case 0x20: /*   */\n        if (start === end) {\n          start = end = i + 1\n        }\n        break\n      case 0x2c: /* , */\n        list.push(str.substring(start, end))\n        start = end = i + 1\n        break\n      default:\n        end = i + 1\n        break\n    }\n  }\n\n  // final token\n  list.push(str.substring(start, end))\n\n  return list\n}\n","import { URL, format as stringify } from 'url'\nimport { isIP } from 'net'\nimport Accepts from '@goa/accepts'\nimport { parse as qsParse, stringify as qsStringify } from 'querystring'\nimport typeis from '@goa/type-is'\nimport { parse as parseContentType } from '@goa/content-type'\nimport parse from '../modules/parseurl'\nimport fresh from '../modules/fresh'\n\nimport { inspect } from 'util'\n\nimport Context from './context' // eslint-disable-line\nimport Response from './response' // eslint-disable-line\n\nconst IP = Symbol('context#ip')\n\n/**\n * The request implementation.\n * @implements {_goa.Request}\n */\nexport default class Request {\n  constructor() {\n    /**\n     * @suppress {checkTypes}\n     * @type {?_goa.Application}\n     */\n    this.app = null\n    /**\n     * @suppress {checkTypes}\n     * @type {?Context}\n     */\n    this.ctx = null\n    /**\n     * @suppress {checkTypes}\n     * @type {?Response}\n     */\n    this.response = null\n    /**\n     * @suppress {checkTypes}\n     * @type {http.IncomingMessage}\n     */\n    this.req = null\n    /**\n     * @suppress {checkTypes}\n     * @type {http.ServerResponse}\n     */\n    this.res = null\n    /** @type {string} */\n    this.originalUrl = ''\n    /** @type {Object} */\n    this._querycache = {}\n    /** @type {URL|Object} */\n    this.memoizedURL = null\n    /** @type {?string} */\n    this.IP = null\n    /** @type {_goa.Accepts} */\n    this._accept = null\n  }\n  /**\n   * Return request header.\n   */\n  get header() {\n    return this.req.headers\n  }\n\n  /**\n   * Set request header.\n   */\n  set header(val) {\n    this.req.headers = val\n  }\n\n  /**\n   * Return request header, alias as request.header\n   */\n  get headers() {\n    return this.req.headers\n  }\n\n  /**\n   * Set request header, alias as request.header\n   */\n  set headers(val) {\n    this.req.headers = val\n  }\n\n  /**\n   * Get request URL.\n   */\n  get url() {\n    return this.req.url\n  }\n\n  /**\n   * Set request URL.\n   */\n  set url(val) {\n    this.req.url = val\n  }\n\n  /**\n   * Get origin of URL.\n   * @return {string}\n   */\n  get origin() {\n    return `${this.protocol}://${this.host}`\n  }\n\n  /**\n   * Get full request URL.\n   */\n  get href() {\n    // support: `GET http://example.com/foo`\n    if (/^https?:\\/\\//i.test(this.originalUrl)) return this.originalUrl\n    return this.origin + this.originalUrl\n  }\n\n  /**\n   * Get request method.\n   */\n  get method() {\n    return this.req.method\n  }\n\n  /**\n   * Set request method.\n   */\n  set method(val) {\n    this.req.method = val\n  }\n\n  /**\n   * Get request pathname.\n   */\n  get path() {\n    return parse(/** @type {!http.IncomingMessage} */ (this.req)).pathname\n  }\n\n  /**\n   * Set pathname, retaining the query-string when present.\n   */\n  set path(path) {\n    const url = parse(/** @type {!http.IncomingMessage} */ (this.req))\n    if (url.pathname === path) return\n\n    url.pathname = path\n    url.path = null\n\n    this.url = stringify(url)\n  }\n\n  /**\n   * Get parsed query-string.\n   * @return {Object}\n   */\n  get query() {\n    const str = this.querystring\n    const c = this._querycache = this._querycache || {}\n    return c[str] || (c[str] = qsParse(str))\n  }\n\n  /**\n   * Set query-string as an object.\n   */\n  set query(obj) {\n    this.querystring = qsStringify(obj)\n  }\n\n  /**\n   * Get query string.\n   */\n  get querystring() {\n    if (!this.req) return ''\n    return parse(/** @type {!http.IncomingMessage} */ (this.req)).query || ''\n  }\n\n  /**\n   * Set querystring.\n   */\n  set querystring(str) {\n    const url = parse(/** @type {!http.IncomingMessage} */ (this.req))\n    if (url.search === `?${str}`) return\n\n    url.search = str\n    url.path = null\n\n    this.url = stringify(url)\n  }\n\n  /**\n   * Get the search string. Same as the querystring\n   * except it includes the leading ?.\n   */\n  get search() {\n    if (!this.querystring) return ''\n    return `?${this.querystring}`\n  }\n\n  /**\n   * Set the search string. Same as\n   * request.querystring= but included for ubiquity.\n   */\n  set search(str) {\n    this.querystring = str\n  }\n\n  /**\n   * Parse the \"Host\" header field host\n   * and support X-Forwarded-Host when a\n   * proxy is enabled. Returns hostname:port\n   */\n  get host() {\n    const { proxy } = this.app\n    let host = proxy && this.get('X-Forwarded-Host')\n    if (!host) {\n      if (this.req.httpVersionMajor >= 2) host = this.get(':authority')\n      if (!host) host = this.get('Host')\n    }\n    if (!host) return ''\n    return host.split(/\\s*,\\s*/, 1)[0]\n  }\n\n  /**\n   * Parse the \"Host\" header field hostname\n   * and support X-Forwarded-Host when a\n   * proxy is enabled.\n   */\n  get hostname() {\n    const host = this.host\n    if (!host) return ''\n    if ('[' == host[0]) return this.URL.hostname || '' // IPv6\n    return host.split(':', 1)[0]\n  }\n\n  /**\n   * Get WHATWG parsed URL.\n   * Lazily memoized.\n   */\n  get URL() {\n    if (!this.memoizedURL) {\n      const originalUrl = this.originalUrl || '' // avoid undefined in template string\n      try {\n        this.memoizedURL = new URL(`${this.origin}${originalUrl}`)\n      } catch (err) {\n        this.memoizedURL = Object.create(null)\n      }\n    }\n    return this.memoizedURL\n  }\n\n  /**\n   * Check if the request is fresh, aka\n   * Last-Modified and/or the ETag\n   * still match.\n   */\n  get fresh() {\n    const method = this.method\n    const s = this.ctx.status // todo\n\n    // GET or HEAD for weak freshness validation only\n    if ('GET' != method && 'HEAD' != method) return false\n\n    // 2xx or 304 as per rfc2616 14.26\n    if ((s >= 200 && s < 300) || 304 == s) {\n      return fresh(this.header, this.response.header)\n    }\n\n    return false\n  }\n\n  /**\n   * Check if the request is stale, aka\n   * \"Last-Modified\" and / or the \"ETag\" for the\n   * resource has changed.\n   */\n  get stale() {\n    return !this.fresh\n  }\n\n  /**\n   * Check if the request is idempotent.\n   */\n  get idempotent() {\n    const methods = ['GET', 'HEAD', 'PUT', 'DELETE', 'OPTIONS', 'TRACE']\n    return methods.includes(this.method)\n  }\n\n  /**\n   * Return the request socket.\n   */\n  get socket() {\n    return this.req.socket\n  }\n\n  /**\n   * Get the charset when present or undefined.\n   */\n  get charset() {\n    try {\n      const { parameters } = parseContentType(/** @type {!http.IncomingMessage} */ (this.req))\n      return parameters.charset || ''\n    } catch (e) {\n      return ''\n    }\n  }\n\n  /**\n   * Return parsed Content-Length when present.\n   */\n  get length() {\n    const len = this.get('Content-Length')\n    if (len == '') return null\n    return ~~len\n  }\n\n  /**\n   * Return the protocol string \"http\" or \"https\"\n   * when requested with TLS. When the proxy setting\n   * is enabled the \"X-Forwarded-Proto\" header\n   * field will be trusted. If you're running behind\n   * a reverse proxy that supplies https for you this\n   * may be enabled.\n   */\n  get protocol() {\n    /** missing encrypted in externs\n     * @suppress {checkTypes} */\n    const encrypted = this.socket['encrypted']\n    if (encrypted) return 'https'\n    if (!this.app.proxy) return 'http'\n    const proto = this.get('X-Forwarded-Proto')\n    return proto ? proto.split(/\\s*,\\s*/, 1)[0] : 'http'\n  }\n\n  /**\n   * Short-hand for:\n   *    this.protocol == 'https'\n   */\n  get secure() {\n    return 'https' == this.protocol\n  }\n\n  /**\n   * When `app.proxy` is `true`, parse\n   * the \"X-Forwarded-For\" ip address list.\n   * For example if the value were \"client, proxy1, proxy2\"\n   * you would receive the array `[\"client\", \"proxy1\", \"proxy2\"]`\n   * where \"proxy2\" is the furthest down-stream.\n   */\n  get ips() {\n    const { proxy } = this.app\n    const val = this.get('X-Forwarded-For')\n    return proxy && val\n      ? val.split(/\\s*,\\s*/)\n      : []\n  }\n\n  /**\n   * Return request's remote address\n   * When `app.proxy` is `true`, parse\n   * the \"X-Forwarded-For\" ip address list and return the first one\n   */\n  get ip() {\n    if (!this[IP]) {\n      this[IP] = this.ips[0] || this.socket.remoteAddress || ''\n    }\n    return this[IP]\n  }\n\n  set ip(_ip) {\n    this[IP] = _ip\n  }\n\n  /**\n   * Return subdomains as an array.\n   * Subdomains are the dot-separated parts of the host before the main domain\n   * of the app. By default, the domain of the app is assumed to be the last two\n   * parts of the host. This can be changed by setting `app.subdomainOffset`.\n   * For example, if the domain is \"tobi.ferrets.example.com\":\n   * If `app.subdomainOffset` is not set, this.subdomains is\n   * `[\"ferrets\", \"tobi\"]`.\n   * If `app.subdomainOffset` is 3, this.subdomains is `[\"tobi\"]`.\n   */\n  get subdomains() {\n    const offset = this.app.subdomainOffset\n    const hostname = this.hostname\n    if (isIP(hostname)) return []\n    return hostname\n      .split('.')\n      .reverse()\n      .slice(offset)\n  }\n\n  /**\n   * Get accept object. Lazily memoized.\n   * @private\n   */\n  get accept() {\n    return this._accept || (this._accept = new Accepts(/** @type {!http.IncomingMessage} */ (this.req)))\n  }\n\n  /**\n   * Set accept object.\n   * @private\n   */\n  set accept(obj) {\n    this._accept = obj\n  }\n\n  /**\n   * Check if the given `type(s)` is acceptable, returning\n   * the best match when true, otherwise `false`, in which\n   * case you should respond with 406 \"Not Acceptable\".\n   * The `type` value may be a single mime type string\n   * such as \"application/json\", the extension name\n   * such as \"json\" or an array `[\"json\", \"html\", \"text/plain\"]`. When a list\n   * or array is given the _best_ match, if any is returned.\n   * Examples:\n   *\n   *     // Accept: text/html\n   *     this.accepts('html');\n   *     // => \"html\"\n   *     // Accept: text/*, application/json\n   *     this.accepts('html');\n   *     // => \"html\"\n   *     this.accepts('text/html');\n   *     // => \"text/html\"\n   *     this.accepts('json', 'text');\n   *     // => \"json\"\n   *     this.accepts('application/json');\n   *     // => \"application/json\"\n   *     // Accept: text/*, application/json\n   *     this.accepts('image/png');\n   *     this.accepts('png');\n   *     // => false\n   *     // Accept: text/*;q=.5, application/json\n   *     this.accepts(['html', 'json']);\n   *     this.accepts('html', 'json');\n   *     // => \"json\"\n   * @param {!Array<string>|string} [type]\n   * @param {...string} args\n   */\n  accepts(type, ...args) {\n    return this.accept.types(type, ...args)\n  }\n\n  /**\n   * Return accepted encodings or best fit based on `encodings`.\n   * Given `Accept-Encoding: gzip, deflate`\n   * an array sorted by quality is returned:\n   *\n   *     ['gzip', 'deflate']\n   * @param {!Array<string>|string} [encoding]\n   * @param {...string} args\n   */\n  acceptsEncodings(encoding, ...args) {\n    return this.accept.encodings(encoding, ...args)\n  }\n\n  /**\n   * Return accepted charsets or best fit based on `charsets`.\n   * Given `Accept-Charset: utf-8, iso-8859-1;q=0.2, utf-7;q=0.5`\n   * an array sorted by quality is returned:\n   *\n   *     ['utf-8', 'utf-7', 'iso-8859-1']\n   * @param {!Array<string>|string} [charset]\n   * @param {...string} args\n   */\n  acceptsCharsets(charset, ...args) {\n    return this.accept.charsets(charset, ...args)\n  }\n\n  /**\n   * Return accepted languages or best fit based on `langs`.\n   * Given `Accept-Language: en;q=0.8, es, pt`\n   * an array sorted by quality is returned:\n   *\n   *     ['es', 'pt', 'en']\n   * @param {!Array<string>|string} [lang]\n   * @param {...string} args\n   */\n  acceptsLanguages(lang, ...args) {\n    return this.accept.languages(lang, ...args)\n  }\n\n  /**\n   * Check if the incoming request contains the \"Content-Type\"\n   * header field, and it contains any of the give mime `type`s.\n   * If there is no request body, `null` is returned.\n   * If there is no content type, `false` is returned.\n   * Otherwise, it returns the first `type` that matches.\n   * Examples:\n   *\n   *     // With Content-Type: text/html; charset=utf-8\n   *     this.is('html'); // => 'html'\n   *     this.is('text/html'); // => 'text/html'\n   *     this.is('text/*', 'application/json'); // => 'text/html'\n   *     // When Content-Type is application/json\n   *     this.is('json', 'urlencoded'); // => 'json'\n   *     this.is('application/json'); // => 'application/json'\n   *     this.is('html', 'application/*'); // => 'application/json'\n   *     this.is('html'); // => false\n   * @param {string|!Array<string>} types\n   * @param {...string} args\n   */\n  is(types, ...args) {\n    if (!types) return typeis(/** @type {!http.IncomingMessage} */ (this.req))\n    if (!Array.isArray(types)) types = [types, ...args]\n    return typeis(/** @type {!http.IncomingMessage} */ (this.req), types)\n  }\n\n  /**\n   * Return the request mime type void of\n   * parameters such as \"charset\".\n   */\n  get type() {\n    const type = this.get('Content-Type')\n    if (!type) return ''\n    return type.split(';')[0]\n  }\n\n  /**\n   * Return request header.\n   * The `Referrer` header field is special-cased,\n   * both `Referrer` and `Referer` are interchangeable.\n   * Examples:\n   *     this.get('Content-Type');\n   *     // => \"text/plain\"\n   *     this.get('content-type');\n   *     // => \"text/plain\"\n   *     this.get('Something');\n   *     // => ''\n   * @param {string} field\n   * @returns {string}\n   */\n  get(field) {\n    const req = this.req\n    switch (field = field.toLowerCase()) {\n    case 'referer':\n    case 'referrer':\n      return req.headers.referrer || req.headers.referer || ''\n    default: {\n      /** @suppress {checkTypes} */\n      const h = req.headers[field]\n      return h || ''\n    }\n    }\n  }\n\n  /**\n   * Inspect implementation.\n   */\n  inspect() {\n    if (!this.req) return\n    return this.toJSON()\n  }\n\n  /**\n   * Return JSON representation.\n   * @return {!Object}\n   */\n  toJSON() {\n    return {\n      'method': this.method,\n      'url': this.url,\n      'header': this.header,\n    }\n  }\n  /**\n   * @suppress {checkTypes}\n   */\n  [inspect.custom]() {\n    return this.inspect()\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').Application} _goa.Application\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').ServerResponse} http.ServerResponse\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@goa/accepts/types').Accepts} _goa.Accepts\n */\n","import { format } from 'util'\nimport Cookies from '@goa/cookies'\nimport Accepts from '@goa/accepts' // eslint-disable-line\n\nimport createError from '@goa/http-errors'\nimport Delegate from '../modules/delegates'\nimport httpAssert from '../modules/http-assert'\nimport statuses from '@goa/statuses'\nimport { inspect } from 'util'\n\nimport Request from './request' // eslint-disable-line\nimport Response from './response' // eslint-disable-line\n\nconst COOKIES = Symbol('context#cookies')\n\n/**\n * Context prototype.\n * @implements {_goa.Context}\n */\nexport default class Context {\n  constructor() {\n    // suppress types here so that can access\n    // the properties without casting later\n    /**\n     * @suppress {checkTypes}\n     * @type {?_goa.Application}\n     */\n    this.app = null\n    /**\n     * @suppress {checkTypes}\n     * @type {Request}\n     */\n    this.request = null\n    /**\n     * @suppress {checkTypes}\n     * @type {Response}\n     */\n    this.response = null\n    /**\n     * @suppress {checkTypes}\n     * @type {?http.IncomingMessage}\n     */\n    this.req = null\n    /**\n     * @suppress {checkTypes}\n     * @type {?http.ServerResponse}\n     */\n    this.res = null\n\n    /**\n     * @suppress {checkTypes}\n     * @type {?string}\n     */\n    this.originalUrl = null\n    /** @type {Object} */ this.state = null\n    /** @type {_goa.Cookies} */ this[COOKIES] = null\n\n    /**\n     * Set to false to bypass Koa's response.\n     * @type {boolean}\n     */\n    this.respond = true\n\n    // REQUEST delegates\n    // method\n    /** @type {?} **/\n    this.acceptsLanguages = undefined\n    /** @type {?} **/\n    this.acceptsEncodings = undefined\n    /** @type {?} **/\n    this.acceptsCharsets = undefined\n    /** @type {?} **/\n    this.accepts = undefined\n    /** @type {?} **/\n    this.get = undefined\n    /** @type {?} **/\n    this.is = undefined\n\n    // access\n    /** @type {?} **/\n    this.querystring = undefined\n    /** @type {?} **/\n    this.idempotent = undefined\n    /** @type {?} **/\n    this.socket = undefined\n    /** @type {?} **/\n    this.search = undefined\n    /** @type {?} **/\n    this.method = undefined\n    /** @type {?} **/\n    this.query = undefined\n    /** @type {?} **/\n    this.path = undefined\n    /** @type {?} **/\n    this.url = undefined\n    /** @type {_goa.Accepts} **/\n    this.accept = null\n\n    // getters\n    /** @type {?} **/\n    this.origin = undefined\n    /** @type {?} **/\n    this.href = undefined\n    /** @type {?} **/\n    this.subdomains = undefined\n    /** @type {?} **/\n    this.protocol = undefined\n    /** @type {?} **/\n    this.host = undefined\n    /** @type {?} **/\n    this.hostname = undefined\n    /** @type {?} **/\n    this.URL = undefined\n    /** @type {?} **/\n    this.header = undefined\n    /** @type {?} **/\n    this.headers = undefined\n    /** @type {?} **/\n    this.secure = undefined\n    /** @type {?} **/\n    this.stale = undefined\n    /** @type {?} **/\n    this.fresh = undefined\n    /** @type {?} **/\n    this.ips = undefined\n    /** @type {?} **/\n    this.ip = undefined\n\n    // RESPONSE delegates\n    // method\n    /** @type {?} **/ this.attachment = undefined\n    /** @type {?} **/ this.redirect = undefined\n    /** @type {?} **/ this.remove = undefined\n    /** @type {?} **/ this.vary = undefined\n    /** @type {?} **/ this.set = undefined\n    /** @type {?} **/ this.append = undefined\n    /** @type {?} **/ this.flushHeaders = undefined\n    // access\n    /** @type {?} **/ this.status = undefined\n    /** @type {?} **/ this.message = undefined\n    /** @type {?} **/ this.body = undefined\n    /** @type {?} **/ this.length = undefined\n    /** @type {?} **/ this.type = undefined\n    /** @type {?} **/ this.lastModified = undefined\n    /** @type {?} **/ this.etag = undefined\n    // getter\n    /** @type {boolean} **/ this.headerSent = false\n    /** @type {boolean} **/ this.writable = false\n  }\n  /**\n   * util.inspect() implementation, which\n   * just returns the JSON output.\n   */\n  inspect() {\n    return this.toJSON()\n  }\n\n  /**\n   * Return JSON representation.\n   *\n   * Here we explicitly invoke .toJSON() on each\n   * object, as iteration will otherwise fail due\n   * to the getters and cause utilities such as\n   * clone() to fail.\n   * @return {!Object}\n   */\n  toJSON() {\n    return {\n      'request': this.request.toJSON(),\n      'response': this.response.toJSON(),\n      'app': this.app.toJSON(),\n      'originalUrl': this.originalUrl,\n      'req': '<original node req>',\n      'res': '<original node res>',\n      'socket': '<original node socket>',\n    }\n  }\n\n  /**\n   * Similar to .throw(), adds assertion.\n   *\n   *    this.assert(this.user, 401, 'Please login!');\n   *\n   * See: https://github.com/jshttp/http-assert\n   */\n  get assert() {\n    return httpAssert\n  }\n\n  /**\n   * Throw an error with `status` (default 500) and\n   * `msg`. Note that these are user-level\n   * errors, and the message may be exposed to the client.\n   *\n   * See: https://github.com/idiocc/http-errors\n   *\n   * Note: `status` should only be passed as the first parameter.\n   *\n   * @param {...(string|number|!Error)} [args]\n   */\n  throw(...args) {\n    throw createError(...args)\n  }\n\n  /**\n   * Default error handling.\n   *\n   * @param {Error} err\n   * @api private\n   */\n  onerror(err) {\n    // don't do anything if there is no error.\n    // this allows you to pass `this.onerror`\n    // to node-style callbacks.\n    if (null == err) return\n\n    if (!(err instanceof Error)) err = new Error(format('non-error thrown: %j', err))\n\n    let headerSent = false\n    if (this.headerSent || !this.writable) {\n      headerSent = err['headerSent'] = true\n    }\n\n    // delegate\n    this.app.emit('error', err, this)\n\n    // nothing we can do here other\n    // than delegate to the app-level\n    // handler and log.\n    if (headerSent) {\n      return\n    }\n\n    const { res } = this\n\n    // first unset all headers\n    res.getHeaderNames().forEach(name => res.removeHeader(name))\n\n    // then set those specified\n    this.set(err.headers)\n\n    // force text/plain\n    this.type = 'text'\n\n    // ENOENT support\n    if ('ENOENT' == err.code) err.status = 404\n\n    // default to 500\n    if ('number' != typeof err.status || !statuses[err.status]) err.status = 500\n\n    // respond\n    const code = statuses[err.status]\n    const msg = err.expose ? err.message : code\n    this.status = err.status\n    this.length = Buffer.byteLength(msg)\n    res.end(msg)\n  }\n\n  get cookies() {\n    if (!this[COOKIES]) {\n      this[COOKIES] = new Cookies(\n        /** @type {!http.IncomingMessage} */ (this.req),\n        /** @type {!http.ServerResponse} */ (this.res), {\n          keys: this.app.keys, // change @goaCookies\n          secure: this.request.secure,\n        })\n    }\n    return this[COOKIES]\n  }\n\n  set cookies(_cookies) {\n    this[COOKIES] = _cookies\n  }\n  /**\n   * @suppress {checkTypes}\n   */\n  [inspect.custom]() {\n    return this.inspect()\n  }\n}\n\n/**\n * Custom inspection implementation for newer Node.js versions.\n *\n * @return {Object}\n */\n// /* istanbul ignore else */\n// if (util.inspect.custom) {\n//   module.exports[util.inspect.custom] = module.exports.inspect\n// }\n\n/**\n * Response delegation.\n */\nnew Delegate(Context.prototype, 'response')\n  .method('attachment')\n  .method('redirect')\n  .method('remove')\n  .method('vary')\n  .method('set')\n  .method('append')\n  .method('flushHeaders')\n  .access('status')\n  .access('message')\n  .access('body')\n  .access('length')\n  .access('type')\n  .access('lastModified')\n  .access('etag')\n  .getter('headerSent')\n  .getter('writable')\n\n/**\n * Request delegation.\n */\nnew Delegate(Context.prototype, 'request')\n  .method('acceptsLanguages')\n  .method('acceptsEncodings')\n  .method('acceptsCharsets')\n  .method('accepts')\n  .method('get')\n  .method('is')\n  .access('querystring')\n  .access('idempotent')\n  .access('socket')\n  .access('search')\n  .access('method')\n  .access('query')\n  .access('path')\n  .access('url')\n  .access('accept')\n  .getter('origin')\n  .getter('href')\n  .getter('subdomains')\n  .getter('protocol')\n  .getter('host')\n  .getter('hostname')\n  .getter('URL')\n  .getter('header')\n  .getter('headers')\n  .getter('secure')\n  .getter('stale')\n  .getter('fresh')\n  .getter('ips')\n  .getter('ip')\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').Application} _goa.Application\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').ServerResponse} http.ServerResponse\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@goa/accepts/types').Accepts} _goa.Accepts\n */","import assert from 'assert'\nimport { extname } from 'path'\nimport statuses, { empty, redirect } from '@goa/statuses'\nimport onFinish from '../modules/on-finished'\nimport destroy from '../modules/destroy'\nimport vary from '@goa/vary'\nimport { inspect } from 'util'\nimport { is } from '@goa/type-is'\nimport contentDisposition from '../modules/content-disposition'\nimport ensureErrorHandler from '../modules/error-inject'\nimport getType from '../modules/cache-content-type'\nimport isJSON from '../modules/koa-is-json'\nimport escape from '../modules/escape-html'\n\nimport Context from './context' // eslint-disable-line\nimport Request from './request' // eslint-disable-line\n\n/**\n * The response implementation.\n * @implements {_goa.Response}\n */\nexport default class Response {\n  constructor() {\n    /**\n     * @suppress {checkTypes}\n     * @type {_goa.Application}\n     */\n    this.app = null\n    /**\n     * @suppress {checkTypes}\n     * @type {Context}\n     */\n    this.ctx = null\n    /**\n     * @suppress {checkTypes}\n     * @type {Request}\n     */\n    this.request = null\n    /**\n     * @suppress {checkTypes}\n     * @type {http.IncomingMessage}\n     */\n    this.req = null\n    /**\n     * @suppress {checkTypes}\n     * @type {http.ServerResponse}\n     */\n    this.res = null\n    /** @type {?boolean} */\n    this._explicitStatus = null\n    /** @type {?} */\n    this._body = undefined\n  }\n  /**\n   * Return the request socket.\n   */\n  get socket() {\n    return /** @type {net.Socket} */ (this.res.socket)\n  }\n\n  /**\n   * Return response header.\n   */\n  get header() {\n    return this.res.getHeaders()\n  }\n\n  /**\n   * Return response header, alias as response.header\n   */\n  get headers() {\n    return this.header\n  }\n\n  /**\n   * Get response status code.\n   */\n  get status() {\n    return this.res.statusCode\n  }\n\n  /**\n   * Set response status code.\n   */\n  set status(code) {\n    if (this.headerSent) return\n\n    assert(Number.isInteger(code), 'status code must be a number')\n    assert(code >= 100 && code <= 999, `invalid status code: ${code}`)\n    this._explicitStatus = true\n    this.res.statusCode = code\n    if (this.req.httpVersionMajor < 2) this.res.statusMessage = statuses[code]\n    if (this.body && empty[code]) this.body = null\n  }\n\n  /**\n   * Get response status message.\n   */\n  get message() {\n    return this.res.statusMessage || statuses[this.status]\n  }\n\n  /**\n   * Set response status message.\n   * @param {string} msg\n   */\n  set message(msg) {\n    this.res.statusMessage = msg\n  }\n\n  /**\n   * Get response body.\n   * @returns {string|!Buffer|Object|!stream.Stream}\n   */\n  get body() {\n    return this._body\n  }\n\n  /**\n   * Set response body.\n   * @param {string|!Buffer|Object|!stream.Stream} val\n   */\n  set body(val) {\n    const original = this._body\n    this._body = val\n\n    // no content\n    if (null == val) {\n      if (!empty[this.status]) this.status = 204\n      this.remove('Content-Type')\n      this.remove('Content-Length')\n      this.remove('Transfer-Encoding')\n      return\n    }\n\n    // set the status\n    if (!this._explicitStatus) this.status = 200\n\n    // set the content-type only if not yet set\n    const setType = !this.header['content-type']\n\n    // string\n    if ('string' == typeof val) {\n      if (setType) this.type = /^\\s*</.test(val) ? 'html' : 'text'\n      this.length = Buffer.byteLength(val)\n      return\n    }\n\n    // buffer\n    if (Buffer.isBuffer(val)) {\n      if (setType) this.type = 'bin'\n      this.length = val.length\n      return\n    }\n\n    // stream\n    if ('function' == typeof val.pipe) {\n      onFinish(/** @type {!http.ServerResponse} */ (this.res), destroy.bind(null, /** @type {!stream.Stream} */ (val)))\n      ensureErrorHandler(val, err => this.ctx.onerror(err))\n\n      // overwriting\n      if (null != original && original != val) this.remove('Content-Length')\n\n      if (setType) this.type = 'bin'\n      return\n    }\n\n    // json\n    this.remove('Content-Length')\n    this.type = 'json'\n  }\n\n  /**\n   * Set Content-Length field to `n`.\n   */\n  set length(n) {\n    this.set('Content-Length', /** @type {number} */ (n))\n  }\n\n  /**\n   * Return parsed response Content-Length when present.\n   */\n  get length() {\n    const len = this.header['content-length']\n    const body = this.body\n\n    if (null == len) {\n      if (!body) return null\n      if ('string' == typeof body) return Buffer.byteLength(body)\n      if (Buffer.isBuffer(body)) return body.length\n      if (isJSON(body)) return Buffer.byteLength(JSON.stringify(body))\n      return null\n    }\n\n    return Math.trunc(parseInt(len, 10)) || 0\n  }\n\n  /**\n   * Check if a header has been written to the socket.\n   */\n  get headerSent() {\n    return this.res.headersSent\n  }\n\n  /**\n   * Vary on `field`.\n   */\n  vary(field) {\n    if (this.headerSent) return\n\n    vary(this.res, field)\n  }\n\n  /**\n   * Perform a 302 redirect to `url`.\n   * The string \"back\" is special-cased\n   * to provide Referrer support, when Referrer\n   * is not present `alt` or \"/\" is used.\n   * Examples:\n   *    this.redirect('back');\n   *    this.redirect('back', '/index.html');\n   *    this.redirect('/login');\n   *    this.redirect('http://google.com');\n   * @param {string} url\n   * @param {string} [alt]\n   */\n  redirect(url, alt) {\n    // location\n    if ('back' == url) url = this.ctx.get('Referrer') || alt || '/' // todo\n    this.set('Location', url)\n\n    // status\n    if (!redirect[this.status]) this.status = 302\n\n    // html\n    if (this.ctx.accepts('html')) { // todo\n      url = escape(url)\n      this.type = 'text/html; charset=utf-8'\n      this.body = `Redirecting to <a href=\"${url}\">${url}</a>.`\n      return\n    }\n\n    // text\n    this.type = 'text/plain; charset=utf-8'\n    this.body = `Redirecting to ${url}.`\n  }\n\n  /**\n   * Set Content-Disposition header to \"attachment\" with optional `filename`.\n   * @param {string} [filename]\n   * @param {!_goa.ContentDisposition} [options]\n   */\n  attachment(filename, options) {\n    if (filename) this.type = extname(filename)\n    this.set('Content-Disposition', contentDisposition(filename, options))\n  }\n\n  /**\n   * Set Content-Type response header with `type` through `mime.lookup()`\n   * when it does not contain a charset.\n   * Examples:\n   *     this.type = '.html';\n   *     this.type = 'html';\n   *     this.type = 'json';\n   *     this.type = 'application/json';\n   *     this.type = 'png';\n   * @param {string} type\n   */\n  set type(type) {\n    type = getType(type)\n    if (type) {\n      this.set('Content-Type', type)\n    } else {\n      this.remove('Content-Type')\n    }\n  }\n\n  /**\n   * Set the Last-Modified date using a string or a Date.\n   *     this.response.lastModified = new Date();\n   *     this.response.lastModified = '2013-09-13';\n   * @param {string|Date} val\n   */\n  set lastModified(val) {\n    if ('string' == typeof val) val = new Date(val)\n    this.set('Last-Modified', val.toUTCString())\n  }\n\n  /**\n   * Get the Last-Modified date in Date form, if it exists.\n   */\n  get lastModified() {\n    const date = this.get('last-modified')\n    if (date) return new Date(date)\n    return null\n  }\n\n  /**\n   * Set the ETag of a response.\n   * This will normalize the quotes if necessary.\n   *     this.response.etag = 'md5hashsum';\n   *     this.response.etag = '\"md5hashsum\"';\n   *     this.response.etag = 'W/\"123456789\"';\n   * @param {string} val\n   */\n  set etag(val) {\n    if (!/^(W\\/)?\"/.test(val)) val = `\"${val}\"`\n    this.set('ETag', val)\n  }\n\n  /**\n   * Get the ETag of a response.\n   */\n  get etag() {\n    return this.get('ETag')\n  }\n\n  /**\n   * Return the response mime type void of\n   * parameters such as \"charset\".\n   */\n  get type() {\n    const type = this.get('Content-Type')\n    if (!type) return ''\n    return type.split(';', 1)[0]\n  }\n\n  /**\n   * Check whether the response is one of the listed types.\n   * Pretty much the same as `this.request.is()`.\n   * @param {string|!Array<string>} types\n   * @param {...string} args\n   * @return {string|boolean}\n   */\n  is(types, ...args) {\n    const type = this.type\n    if (!types) return type || false\n    if (!Array.isArray(types)) types = [types, ...args]\n    return is(type, types)\n  }\n\n  /**\n   * Return response header.\n   * Examples:\n   *     this.get('Content-Type');\n   *     // => \"text/plain\"\n   *     this.get('content-type');\n   *     // => \"text/plain\"\n   * @param {string} field\n   */\n  get(field) {\n    return this.header[field.toLowerCase()] || ''\n  }\n\n  /**\n   * Set header `field` to `val`, or pass\n   * an object of header fields.\n   * Examples:\n   *    this.set('Foo', ['bar', 'baz']);\n   *    this.set('Accept', 'application/json');\n   *    this.set({ Accept: 'text/plain', 'X-API-Key': 'tobi' });\n   * @param {string|!Object} field\n   * @param {string|!Array|number} [val]\n   */\n  set(field, val) {\n    if (this.headerSent) return\n\n    if (2 == arguments.length) {\n      const f = /** @type {string} */ (field)\n      if (Array.isArray(val)) val = val.map(v => typeof v == 'string' ? v : String(v))\n      else if (typeof val != 'string') val = String(val)\n      this.res.setHeader(f, val)\n    } else {\n      for (const key in field) {\n        this.set(key, field[key])\n      }\n    }\n  }\n\n  /**\n   * Append additional header `field` with value `val`.\n   * Examples:\n```\nthis.append('Link', ['<http://localhost/>', '<http://localhost:3000/>']);\nthis.append('Set-Cookie', 'foo=bar; Path=/; HttpOnly');\nthis.append('Warning', '199 Miscellaneous warning');\n```\n   * @param {string} field\n   * @param {!string|!Array<string>} val\n   */\n  append(field, val) {\n    const prev = this.get(field)\n\n    if (prev) {\n      val = Array.isArray(prev)\n        ? prev.concat(val)\n        : [prev].concat(val)\n    }\n\n    return this.set(field, val)\n  }\n\n  /**\n   * Remove header `field`.\n   * @param {string} field\n   */\n  remove(field) {\n    if (this.headerSent) return\n\n    this.res.removeHeader(field)\n  }\n\n  /**\n   * Checks if the request is writable.\n   * Tests for the existence of the socket\n   * as node sometimes does not set it.\n   * @private\n   */\n  get writable() {\n    // can't write any more after response finished\n    if (this.res.finished) return false\n\n    const socket = /** @type {!net.Socket} */ (this.res.socket)\n    // There are already pending outgoing res, but still writable\n    // https://github.com/nodejs/node/blob/v4.4.7/lib/_http_server.js#L486\n    if (!socket) return true\n    return socket.writable\n  }\n\n  /**\n   * Inspect implementation.\n   */\n  inspect() {\n    if (!this.res) return\n    const o = this.toJSON()\n    o.body = this.body\n    return o\n  }\n\n  /**\n   * Return JSON representation.\n   * @return {!Object}\n   */\n  toJSON() {\n    return {\n      'status': this.status,\n      'message': this.message,\n      'header': this.header,\n    }\n  }\n\n  /**\n   * Flush any set headers, and begin the body\n   */\n  flushHeaders() {\n    this.res.flushHeaders()\n  }\n  /**\n   * @suppress {checkTypes}\n   */\n  [inspect.custom]() {\n    return this.inspect()\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').Application} _goa.Application\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').ServerResponse} http.ServerResponse\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('net').Socket} net.Socket\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('stream').Stream} stream.Stream\n */","import Debug from '@idio/debug'\nimport isGeneratorFunction from '@goa/is-generator-function'\nimport { createServer } from 'http'\nimport Stream from 'stream'\nimport EventEmitter from 'events'\nimport { format } from 'util'\nimport Response from './response'\nimport Request from './request'\nimport Context from './context'\nimport { inspect } from 'util'\nimport { empty } from '@goa/statuses'\nimport isJSON from '../modules/koa-is-json'\nimport onFinished from '../modules/on-finished'\nimport compose from '@goa/compose'\n\nconst debug = Debug('@goa/koa:application')\n\n/**\n * @implements {_goa.Application}\n */\nexport default class Application extends EventEmitter {\n  /**\n   * Initialize a new `Application`.\n   * @param {!_goa.ApplicationOptions} options\n   */\n  constructor(options = {}) {\n    const {\n      proxy = false,\n      subdomainOffset = 2,\n      env = process.env.NODE_ENV || 'development',\n      keys,\n      Context: C = Context,\n    } = options\n    super()\n\n    this.proxy = proxy\n    this.silent = false\n    this.middleware = []\n    this.subdomainOffset = subdomainOffset,\n    this.env = env\n    this.context = /** @type {!Context} */ (Object.create(C.prototype))\n    this.request = /** @type {!Request} */ (Object.create(Request.prototype))\n    this.response = /** @type {!Response} */ (Object.create(Response.prototype))\n\n    this.keys = keys\n    // if (util.inspect.custom) {\n    //   this[util.inspect.custom] = this.inspect\n    // }\n  }\n  /**\n   * @suppress {checkTypes}\n   */\n  [inspect.custom]() {\n    return this.inspect()\n  }\n\n  /**\n   * Shorthand for:\n   *\n   *    http.createServer(app.callback()).listen(...)\n   *\n   */\n  listen(...args) {\n    debug('listen')\n    const server = createServer(this.callback())\n    return server.listen(...args)\n  }\n\n  /**\n   * Return JSON representation.\n   * We only bother showing settings.\n   * @return {!Object}\n   */\n  toJSON() {\n    return {\n      'subdomainOffset': this.subdomainOffset,\n      'proxy': this.proxy,\n      'env': this.env,\n    }\n  }\n\n  /**\n   * Inspect implementation.\n   */\n  inspect() {\n    return this.toJSON()\n  }\n\n  /**\n   * Use the given middleware `fn`.\n   *\n   * Old-style middleware will be converted.\n   *\n   * @param {!_goa.Middleware} fn\n   */\n  use(fn) {\n    if (typeof fn != 'function')\n      throw new TypeError('middleware must be a function!')\n    if (isGeneratorFunction(fn)) {\n      throw new Error(\n        'Generator functions are not supported by @goa/koa. Use koa-convert on them first.')\n    }\n    debug('use %s', fn._name || fn.name || '-')\n    this.middleware.push(fn)\n    return this\n  }\n\n  /**\n   * Return a request handler callback for node's native http server.\n   */\n  callback() {\n    const fn = compose(this.middleware)\n\n    if (!this.listenerCount('error')) this.on('error', this.onerror)\n\n    /** @type {function(!http.IncomingMessage, !http.ServerResponse): !Promise} */\n    const handleRequest = (req, res) => {\n      const ctx = this.createContext(req, res)\n      return this.handleRequest(ctx, fn)\n    }\n\n    return handleRequest\n  }\n\n  /**\n   * Handle request in callback.\n   * @param {!_goa.Context} ctx\n   * @param {!_goa.Middleware} middleware Composed middleware.\n   * @private\n   */\n  async handleRequest(ctx, middleware) {\n    const res = ctx.res\n    res.statusCode = 404\n    const onerror = err => ctx.onerror(err)\n    onFinished(res, onerror)\n    try {\n      await middleware(ctx)\n      return respond(ctx)\n    } catch (err) {\n      onerror(err)\n    }\n    // const onerror = err => ctx.onerror(err)\n    // const handleResponse = () => respond(ctx)\n    // onFinished(res, onerror)\n    // return fnMiddleware(ctx).then(handleResponse).catch(onerror)\n  }\n\n  /**\n   * Initialize a new context.\n   * @param {!http.IncomingMessage} req\n   * @param {!http.ServerResponse} res\n   * @private\n   */\n  createContext(req, res) {\n    const context = /** @type {!Context} */\n      (Object.create(this.context))\n    const request = context.request = /** @type {!Request} */\n      (Object.create(this.request))\n    const response = context.response = /** @type {!Response} */\n      (Object.create(this.response))\n    context.app = request.app = response.app = this\n    context.req = request.req = response.req = req\n    context.res = request.res = response.res = res\n    request.ctx = response.ctx = context\n    request.response = response\n    response.request = request\n    context.originalUrl = request.originalUrl = req.url\n    context.state = {}\n    return context\n  }\n\n  /**\n   * Default error handler.\n   * @param {!Error} err\n   * @private\n   */\n  onerror(err) {\n    if (!(err instanceof Error))\n      throw new TypeError(format('non-error thrown: %j', err))\n\n    if (404 == err.status || err.expose) return\n    if (this.silent) return\n\n    const msg = err.stack || err.toString()\n    console.error()\n    console.error(msg.replace(/^/gm, '  '))\n    console.error()\n  }\n}\n\n/**\n * Response helper.\n * @param {!_goa.Context} ctx\n */\nfunction respond(ctx) {\n  // allow bypassing koa\n  if (false == ctx.respond) return\n\n  if (!ctx.writable) return\n\n  const { res, status: code } = ctx\n  let body = ctx.body\n\n  // ignore body\n  if (empty[code]) {\n    // strip headers\n    ctx.body = null\n    return res.end()\n  }\n\n  if ('HEAD' == ctx.method) {\n    if (!res.headersSent && isJSON(body)) {\n      ctx.length = Buffer.byteLength(JSON.stringify(body))\n    }\n    return res.end()\n  }\n\n  // status body\n  if (null == body) {\n    if (ctx.req.httpVersionMajor >= 2) {\n      body = String(code)\n    } else {\n      body = ctx.message || String(code)\n    }\n    if (!res.headersSent) {\n      ctx.type = 'text'\n      ctx.length = Buffer.byteLength(body)\n    }\n    return res.end(body)\n  }\n\n  // responses\n  if (Buffer.isBuffer(body)) return res.end(body)\n  if ('string' == typeof body) return res.end(body)\n  if (body instanceof Stream) return body.pipe(res)\n\n  // body: json\n  body = JSON.stringify(body)\n  if (!res.headersSent) {\n    ctx.length = Buffer.byteLength(body)\n  }\n  res.end(body)\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').Server} http.Server\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').IncomingMessage} http.IncomingMessage\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').ServerResponse} http.ServerResponse\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').Middleware} _goa.Middleware\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').Context} _goa.Context\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').ApplicationOptions} _goa.ApplicationOptions\n */","/**\n * Tokenize input string.\n */\nfunction lexer(str) {\n  const tokens = []\n  let i = 0\n\n  while (i < str.length) {\n    const char = str[i]\n\n    if (char === '*' || char === '+' || char === '?') {\n      tokens.push({ type: 'MODIFIER', index: i, value: str[i++] })\n      continue\n    }\n\n    if (char === '\\\\') {\n      tokens.push({ type: 'ESCAPED_CHAR', index: i++, value: str[i++] })\n      continue\n    }\n\n    if (char === '{') {\n      tokens.push({ type: 'OPEN', index: i, value: str[i++] })\n      continue\n    }\n\n    if (char === '}') {\n      tokens.push({ type: 'CLOSE', index: i, value: str[i++] })\n      continue\n    }\n\n    if (char === ':') {\n      let name = ''\n      let j = i + 1\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j)\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++]\n          continue\n        }\n\n        break\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`)\n\n      tokens.push({ type: 'NAME', index: i, value: name })\n      i = j\n      continue\n    }\n\n    if (char === '(') {\n      let count = 1\n      let pattern = ''\n      let j = i + 1\n\n      if (str[j] === '?') {\n        throw new TypeError(`Pattern cannot start with '?' at ${j}`)\n      }\n\n      while (j < str.length) {\n        if (str[j] === '\\\\') {\n          pattern += str[j++] + str[j++]\n          continue\n        }\n\n        if (str[j] === ')') {\n          count--\n          if (count === 0) {\n            j++\n            break\n          }\n        } else if (str[j] === '(') {\n          count++\n          if (str[j + 1] !== '?') {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`)\n          }\n        }\n\n        pattern += str[j++]\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`)\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`)\n\n      tokens.push({ type: 'PATTERN', index: i, value: pattern })\n      i = j\n      continue\n    }\n\n    tokens.push({ type: 'CHAR', index: i, value: str[i++] })\n  }\n\n  tokens.push({ type: 'END', index: i, value: '' })\n\n  return tokens\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str, options = {}) {\n  const tokens = lexer(str)\n  const { prefixes = './' } = options\n  const defaultPattern = `[^${escapeString(options.delimiter || '/#?')}]+?`\n  const result = []\n  let key = 0\n  let i = 0\n  let path = ''\n\n  const tryConsume = (type) => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value\n  }\n\n  const mustConsume = (type) => {\n    const value = tryConsume(type)\n    if (value !== undefined) return value\n    const { type: nextType, index } = tokens[i]\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`)\n  }\n\n  const consumeText = () => {\n    let result = ''\n    let value\n    // tslint:disable-next-line\n    while ((value = tryConsume('CHAR') || tryConsume('ESCAPED_CHAR'))) {\n      result += value\n    }\n    return result\n  }\n\n  while (i < tokens.length) {\n    const char = tryConsume('CHAR')\n    const name = tryConsume('NAME')\n    const pattern = tryConsume('PATTERN')\n\n    if (name || pattern) {\n      let prefix = char || ''\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix\n        prefix = ''\n      }\n\n      if (path) {\n        result.push(path)\n        path = ''\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: '',\n        pattern: pattern || defaultPattern,\n        modifier: tryConsume('MODIFIER') || '',\n      })\n      continue\n    }\n\n    const value = char || tryConsume('ESCAPED_CHAR')\n    if (value) {\n      path += value\n      continue\n    }\n\n    if (path) {\n      result.push(path)\n      path = ''\n    }\n\n    const open = tryConsume('OPEN')\n    if (open) {\n      const prefix = consumeText()\n      const name = tryConsume('NAME') || ''\n      const pattern = tryConsume('PATTERN') || ''\n      const suffix = consumeText()\n\n      mustConsume('CLOSE')\n\n      result.push({\n        name: name || (pattern ? key++ : ''),\n        pattern: name && !pattern ? defaultPattern : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume('MODIFIER') || '',\n      })\n      continue\n    }\n\n    mustConsume('END')\n  }\n\n  return result\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile(str, options) {\n  return tokensToFunction(parse(str, options), options)\n}\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction(\n  tokens,\n  options = {}\n) {\n  const reFlags = flags(options)\n  const { encode = (x) => x, validate = true } = options\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map(token => {\n    if (typeof token === 'object') {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags)\n    }\n  })\n\n  return (data) => {\n    let path = ''\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i]\n\n      if (typeof token === 'string') {\n        path += token\n        continue\n      }\n\n      const value = data ? data[token.name] : undefined\n      const optional = token.modifier === '?' || token.modifier === '*'\n      const repeat = token.modifier === '*' || token.modifier === '+'\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected '${token.name}' to not repeat, but got an array`\n          )\n        }\n\n        if (value.length === 0) {\n          if (optional) continue\n\n          throw new TypeError(`Expected '${token.name}' to not be empty`)\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token)\n\n          if (validate && !matches[i].test(segment)) {\n            throw new TypeError(\n              `Expected all '${token.name}' to match '${token.pattern}', but got '${segment}'`\n            )\n          }\n\n          path += token.prefix + segment + token.suffix\n        }\n\n        continue\n      }\n\n      if (typeof value === 'string' || typeof value === 'number') {\n        const segment = encode(String(value), token)\n\n        if (validate && !matches[i].test(segment)) {\n          throw new TypeError(\n            `Expected '${token.name}' to match '${token.pattern}', but got '${segment}'`\n          )\n        }\n\n        path += token.prefix + segment + token.suffix\n        continue\n      }\n\n      if (optional) continue\n\n      const typeOfMessage = repeat ? 'an array' : 'a string'\n      throw new TypeError(`Expected '${token.name}' to be ${typeOfMessage}`)\n    }\n\n    return path\n  }\n}\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match(\n  str,\n  options,\n) {\n  const keys = []\n  const re = pathToRegexp(str, keys, options)\n  return regexpToFunction(re, keys, options)\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction(\n  re,\n  keys,\n  options = {},\n) {\n  const { decode = (x) => x } = options\n\n  return function(pathname) {\n    const m = re.exec(pathname)\n    if (!m) return false\n\n    const { 0: path, index } = m\n    const params = Object.create(null)\n\n    for (let i = 1; i < m.length; i++) {\n      // tslint:disable-next-line\n      if (m[i] === undefined) continue\n\n      const key = keys[i - 1]\n\n      if (key.modifier === '*' || key.modifier === '+') {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map(value => {\n          return decode(value, key)\n        })\n      } else {\n        params[key.name] = decode(m[i], key)\n      }\n    }\n\n    return { path, index, params }\n  }\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, '\\\\$1')\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options = {}) {\n  return options.sensitive ? '' : 'i'\n}\n\n/**\n * Pull out keys from a regexp.\n * @param {!RegExp} path\n * @param {!Array<!Object>} keys\n */\nfunction regexpToRegexp(path, keys) {\n  if (!keys) return path\n\n  // Use a negative lookahead to match only capturing groups.\n  const groups = path.source.match(/\\((?!\\?)/g)\n\n  if (groups) {\n    for (let i = 0; i < groups.length; i++) {\n      keys.push({\n        name: i,\n        prefix: '',\n        suffix: '',\n        modifier: '',\n        pattern: '',\n      })\n    }\n  }\n\n  return path\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths,\n  keys,\n  options,\n) {\n  const parts = paths.map(path => pathToRegexp(path, keys, options).source)\n  return new RegExp(`(?:${parts.join('|')})`, flags(options))\n}\n\n/**\n * Create a path regexp from string input.\n * @param {string} path\n */\nfunction stringToRegexp(\n  path,\n  keys,\n  options,\n) {\n  return tokensToRegexp(parse(path, options), keys, options)\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens,\n  keys,\n  options = {}\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x) => x,\n  } = options\n  const endsWith = `[${escapeString(options.endsWith || '')}]|$`\n  const delimiter = `[${escapeString(options.delimiter || '/#?')}]`\n  let route = start ? '^' : ''\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token == 'string') {\n      route += escapeString(encode(token))\n    } else {\n      const prefix = escapeString(encode(token.prefix))\n      const suffix = escapeString(encode(token.suffix))\n\n      if (token.pattern) {\n        if (keys) keys.push(token)\n\n        if (prefix || suffix) {\n          if (token.modifier == '+' || token.modifier == '*') {\n            const mod = token.modifier == '*' ? '?' : ''\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`\n          }\n        } else {\n          route += `(${token.pattern})${token.modifier}`\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiter}?`\n\n    route += !options.endsWith ? '$' : `(?=${endsWith})`\n  } else {\n    const endToken = tokens[tokens.length - 1]\n    const isEndDelimited =\n      typeof endToken === 'string'\n        ? delimiter.indexOf(endToken[endToken.length - 1]) > -1\n        : // tslint:disable-next-line\n        endToken === undefined\n\n    if (!strict) {\n      route += `(?:${delimiter}(?=${endsWith}))?`\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiter}|${endsWith})`\n    }\n  }\n\n  return new RegExp(route, flags(options))\n}\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport default function pathToRegexp(\n  path,\n  keys,\n  options,\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys)\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options)\n  return stringToRegexp(path, keys, options)\n}\n\n/*!\n * path-to-regexp\n * The MIT License (MIT)\n * Copyright (c) 2014 Blake Embrey (hello@blakeembrey.com)\n */","import Debug from '@idio/debug'\nimport pathToRegExp, { compile, parse } from './path-to-regexp'\nimport { stringify } from 'querystring'\n\nconst debug = Debug('koa-router')\n\n/**\n * @implements {_goa.Layer}\n */\nexport default class Layer {\n  /**\n   * Initialize a new routing Layer with given `method`, `path`, and `middleware`.\n   *\n   * @param {string|!RegExp} path Path string or regular expression.\n   * @param {!Array<string>} methods Array of HTTP verbs.\n   * @param {!_goa.Middleware|!Array<!_goa.Middleware>} middleware Layer callback/middleware or series of.\n   * @param {!_goa.LayerConfig} [opts] The options.\n   */\n  constructor(path, methods, middleware, opts = {}) {\n    const { name = null } = opts\n    this.opts = opts\n    /**\n     * @type {string|null}\n     */\n    this.name = name\n    /**\n     * @type {!Array<string>}\n     */\n    this.methods = []\n    this.paramNames = []\n    this.stack = Array.isArray(middleware) ? middleware : [middleware]\n\n    methods.forEach((method) => {\n      const l = this.methods.push(method.toUpperCase())\n      if (this.methods[l-1] == 'GET') {\n        this.methods.unshift('HEAD')\n      }\n    })\n\n    // ensure middleware is a function\n    this.stack.forEach((fn) => {\n      const type = typeof fn\n      if (type != 'function') {\n        throw new Error(\n          methods.toString() + \" `\" + (name || path) +\"`: `middleware` \"\n          + \"must be a function, not `\" + type + \"`\"\n        )\n      }\n    })\n\n    this.path = path\n    this.regexp = pathToRegExp(\n      typeof path == 'string' ? path.replace(/\\/$/, '') : path,\n      this.paramNames, this.opts)\n\n    debug('defined route %s %s', this.methods, this.opts.prefix + this.path)\n  }\n  /**\n   * Returns whether request `path` matches route.\n   * @param {string} path\n   */\n  match(path) {\n    return this.regexp.test(path)\n  }\n\n  /**\n   * Returns map of URL parameters for given `path` and `paramNames`.\n   * @param {string} path\n   * @param {!Array<string>} captures\n   * @param {!Object} [params]\n   */\n  params(path, captures, params = {}) {\n    for (let len = captures.length, i=0; i<len; i++) {\n      if (this.paramNames[i]) {\n        const c = captures[i]\n        params[this.paramNames[i].name] = c ? safeDecodeURIComponent(c) : c\n      }\n    }\n\n    return params\n  }\n  /**\n   * Returns array of regexp url path captures.\n   * @param {string} path\n   */\n  captures(path) {\n    if (this.opts.ignoreCaptures) return []\n    return path.match(this.regexp).slice(1)\n  }\n  /**\n   * Generate URL for route using given `params`.\n   *\n   * @example\n   *\n   * ```javascript\n   * var route = new Layer(['GET'], '/users/:id', fn);\n   *\n   * route.url({ id: 123 }); // => \"/users/123\"\n   * ```\n   *\n   * @param {!Object|string} params url parameters\n   * @param {!Object|string} options\n   */\n  url(params, options) {\n    let args = params\n    const url = this.path.replace(/\\(\\.\\*\\)/g, '')\n    const toPath = compile(url, {\n      encode: encodeURIComponent,\n    })\n    let replaced\n\n    if (typeof params != 'object') {\n      args = [...arguments]\n      if (typeof args[args.length - 1] == 'object') {\n        options = args[args.length - 1]\n        args = args.slice(0, args.length - 1)\n      }\n    }\n\n    const tokens = parse(url)\n    let replace = {}\n\n    if (Array.isArray(args)) {\n      for (let len = tokens.length, i=0, j=0; i<len; i++) {\n        if (tokens[i].name) replace[tokens[i].name] = args[j++]\n      }\n    } else if (tokens.some(token => token.name)) {\n      replace = params\n    } else {\n      options = params\n    }\n\n    replaced = toPath(replace)\n    if (options && options['query']) {\n      const query = options['query']\n      const q = typeof query == 'string' ? query : stringify(query)\n      return `${replaced}?${q}`\n    }\n\n    return replaced\n  }\n  /**\n   * Run validations on route named parameters.\n   *\n   * @example\n   *\n   * ```javascript\n   * router\n   *   .param('user', function (id, ctx, next) {\n   *     ctx.user = users[id];\n   *     if (!user) return ctx.status = 404;\n   *     next();\n   *   })\n   *   .get('/users/:user', function (ctx, next) {\n   *     ctx.body = ctx.user;\n   *   });\n   * ```\n   *\n   * @param {string} param\n   * @param {!Function} middleware\n   */\n  param(param, middleware) {\n    function mw (ctx, next) {\n      return middleware.call(this, ctx.params[param], ctx, next)\n    }\n    mw.param = param\n\n    const names = this.paramNames.map(({ name }) => name)\n\n    const x = names.indexOf(param)\n    if (x > -1) {\n      // iterate through the stack, to figure out where to place the handler fn\n      this.stack.some((fn, i) => {\n        // param handlers are always first, so when we find an fn w/o a param property, stop here\n        // if the param handler at this part of the stack comes after the one we are adding, stop here\n        if (!fn.param || names.indexOf(fn.param) > x) {\n          // inject this param handler right before the current item\n          this.stack.splice(i, 0, mw)\n          return true // then break the loop\n        }\n      })\n    }\n\n    return this\n  }\n\n  /**\n   * Prefix route path.\n   * @param {string} prefix\n   */\n  setPrefix(prefix) {\n    if (this.path) {\n      this.path = prefix + this.path\n      this.paramNames = []\n      const path = this.path\n      this.regexp = pathToRegExp(typeof path == 'string' ? path.replace(/\\/$/, '') : path,\n        this.paramNames, this.opts)\n    }\n\n    return this\n  }\n}\n\n\n/**\n * Safe decodeURIComponent, won't throw any error.\n * If `decodeURIComponent` error happen, just return the original value.\n *\n * @param {string} text\n */\nfunction safeDecodeURIComponent(text) {\n  try {\n    return decodeURIComponent(text)\n  } catch (e) {\n    return text\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../').LayerConfig} _goa.LayerConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/goa').Middleware} _goa.Middleware\n */","/*!\n * RESTful resource routing middleware for koa.\n *\n * @author Alex Mingoia <talk@alexmingoia.com>\n * @link https://github.com/alexmingoia/koa-router\n */\n\nimport Debug from '@idio/debug'\nimport compose from '@goa/compose'\nimport HttpError from '@goa/http-errors'\nimport { METHODS } from 'http'\nimport Layer from './layer'\n\nconst debug = Debug('@goa/router')\n\n/**\n * @implements {_goa.Router}\n */\nexport default class Router {\n  /**\n   * Create a new router.\n   * @param {!_goa.RouterConfig} [opts]\n   */\n  constructor(opts = {}) {\n    const { methods = [\n      'HEAD',\n      'OPTIONS',\n      'GET',\n      'PUT',\n      'PATCH',\n      'POST',\n      'DELETE',\n    ] } = opts\n    this.opts = opts\n    /** @type {!Array<string>} */\n    this.methods = methods\n\n    this.params = {}\n    /**\n     * @type {!Array<!Layer>}\n     */\n    this.stack = []\n  }\n  /**\n   * Returns the middleware with allowed methods.\n   * @param {_goa.AllowedMethodsOptions} options\n   */\n  allowedMethods(options = {}) {\n    const { throw: t = false, notImplemented, methodNotAllowed } = options\n\n    /** @type {!_goa.Middleware} */\n    const mw = async (ctx, next) => {\n      await next()\n      const allowed = {}\n      const { status = 404 } = ctx\n\n      if (status == 404) {\n        ctx.matched.forEach((route) => {\n          route.methods.forEach((method) => {\n            allowed[method] = method\n          })\n        })\n\n        const allowedArr = Object.keys(allowed)\n\n        if (!this.methods.includes(ctx.method)) {\n          if (t) {\n            let notImplementedThrowable\n            if (typeof notImplemented == 'function') {\n              notImplementedThrowable = notImplemented() // set whatever the user returns from their function\n            } else {\n              notImplementedThrowable = new HttpError['NotImplemented']()\n            }\n            throw notImplementedThrowable\n          } else {\n            ctx.status = 501\n            ctx.set('Allow', allowedArr.join(', '))\n          }\n        } else if (allowedArr.length) {\n          if (ctx.method == 'OPTIONS') {\n            ctx.status = 200\n            ctx.body = ''\n            ctx.set('Allow', allowedArr.join(', '))\n          } else if (!allowed[ctx.method]) {\n            if (t) {\n              let notAllowedThrowable\n              if (typeof methodNotAllowed == 'function') {\n                notAllowedThrowable = methodNotAllowed() // set whatever the user returns from their function\n              } else {\n                notAllowedThrowable = new HttpError['MethodNotAllowed']()\n              }\n              throw notAllowedThrowable\n            } else {\n              ctx.status = 405\n              ctx.set('Allow', allowedArr.join(', '))\n            }\n          }\n        }\n      }\n    }\n    return mw\n  }\n\n  /**\n   * Redirect `source` to `destination` URL with optional 30x status `code`.\n   * Both `source` and `destination` can be route names.\n   *\n   * @param {string} source URL or route name.\n   * @param {string} destination URL or route name.\n   * @param {number} [code] HTTP status code (default: 301).\n   */\n  redirect(source, destination, code = 301) {\n    // lookup source route by name\n    if (source[0] != '/') {\n      const s = this.url(source)\n      if (s instanceof Error) throw s\n      source = s\n    }\n\n    // lookup destination route by name\n    if (destination[0] != '/') {\n      const d = this.url(destination)\n      if (d instanceof Error) throw d\n      destination = d\n    }\n\n    return this['all'](source, ctx => {\n      ctx.redirect(destination)\n      ctx.status = /** @type {number} */ (code)\n    })\n  }\n\n  /**\n   * Create and register a route.\n   *\n   * @param {string|!Array<string>|RegExp} path The path string or an array of paths.\n   * @param {!Array<string>} methods Array of HTTP verbs.\n   * @param {!_goa.Middleware|!Array<!_goa.Middleware>} middleware Multiple middleware also accepted.\n   * @param {!Object} [opts]\n   * @private\n   */\n  register(path, methods, middleware, opts = {}) {\n    const { ignoreCaptures, prefix = this.opts.prefix || '',\n      strict = this.opts.strict || false, end = true, name,\n      sensitive = this.opts.sensitive || false } = opts\n\n    // support array of paths\n    if (Array.isArray(path)) {\n      path.forEach((p) => {\n        this.register(p, methods, middleware, opts)\n      })\n\n      return this\n    }\n\n    // create route\n    const route = new Layer(path, methods, middleware, {\n      end,\n      name,\n      sensitive,\n      strict,\n      prefix,\n      ignoreCaptures,\n    })\n\n    if (this.opts.prefix) {\n      route.setPrefix(this.opts.prefix)\n    }\n\n    // add parameter middleware\n    Object.keys(this.params).forEach((param) => {\n      route.param(param, this.params[param])\n    })\n\n    this.stack.push(route)\n\n    return route\n  }\n\n  /**\n   * Lookup route with given `name`.\n   * @param {string} name\n   */\n  route(name) {\n    const routes = this.stack\n\n    for (let len = routes.length, i=0; i<len; i++) {\n      if (routes[i].name && routes[i].name == name) {\n        return routes[i]\n      }\n    }\n\n    return null\n  }\n\n  /**\n   * Generate URL for route. Takes a route name and map of named `params`.\n   * @param {string} name route name\n   * @param {...!Object} params url parameters and options\n   */\n  url(name, ...params) {\n    const route = this.route(name)\n\n    if (route)\n      return route.url(...params)\n\n    return new Error(`No route found for name: ${name}`)\n  }\n\n  /**\n   * Match given `path` and return corresponding routes.\n   *\n   * @param {string} path\n   * @param {string} method\n   * path and method.\n   * @private\n   */\n  match(path, method) {\n    const layers = this.stack\n    let layer\n    const matched = {\n      /** @type {!Array<!Layer>} */\n      path: [],\n      /** @type {!Array<!Layer>} */\n      pathAndMethod: [],\n      route: false,\n    }\n\n    for (let len = layers.length, i = 0; i < len; i++) {\n      layer = layers[i]\n\n      debug('test %s %s', layer.path, layer.regexp)\n\n      if (layer.match(path)) {\n        matched.path.push(layer)\n\n        if (layer.methods.length == 0 || layer.methods.includes(method)) {\n          matched.pathAndMethod.push(layer)\n          if (layer.methods.length) matched.route = true\n        }\n      }\n    }\n\n    return matched\n  }\n\n  /**\n   * Run middleware for named route parameters. Useful for auto-loading or\n   * validation.\n   * @param {string} param\n   * @param {!_goa.Middleware} middleware\n   */\n  param(param, middleware) {\n    this.params[param] = middleware\n    this.stack.forEach((route) => {\n      route.param(param, middleware)\n    })\n    return this\n  }\n\n  /**\n   * Generate URL from url pattern and given `params`.\n   * @param {string} path Url pattern.\n   * @param {!Array<!Object>} params Url parameters.\n   */\n  static url(path, ...params) {\n    return Layer.prototype.url.apply(/** @type {!Layer} */ ({ path }), params)\n  }\n  /**\n   * Set the path prefix for a Router instance that was already initialized.\n   * @param {string} prefix The prefix to set.\n   */\n  prefix(prefix) {\n    prefix = prefix.replace(/\\/$/, '')\n\n    this.opts.prefix = prefix\n\n    this.stack.forEach((route) => {\n      route.setPrefix(prefix)\n    })\n\n    return this\n  }\n  /**\n   * Use given middleware.\n   *\n   * Middleware run in the order they are defined by `.use()`. They are invoked\n   * sequentially, requests start at the first middleware and work their way\n   * \"down\" the middleware stack.\n   *\n   * @param {string|Array<string>|!_goa.Middleware} path\n   * @param {...!_goa.Middleware} middleware\n   */\n  use(path, ...middleware) {\n    // support array of paths\n    if (Array.isArray(path) && typeof path[0] == 'string') {\n      path.forEach((p) => {\n        this.use(p, ...middleware)\n      })\n      return this\n    }\n\n    const hasPath = typeof path == 'string'\n    if (!hasPath) {\n      middleware.unshift(path)\n      path = null\n    }\n\n    middleware.forEach((m) => {\n      const router = /** @type {Router} */ (m.router)\n      if (router) {\n        router.stack.forEach((nestedLayer) => {\n          if (path) nestedLayer.setPrefix(/** @type {string} */ (path))\n          if (this.opts.prefix) nestedLayer.setPrefix(this.opts.prefix)\n          this.stack.push(nestedLayer)\n        })\n\n        if (this.params) {\n          Object.keys(this.params).forEach((key) => {\n            router.param(key, this.params[key])\n          })\n        }\n      } else {\n        this.register(/** @type {string} */ (path || '(.*)'), [], m, { end: false, ignoreCaptures: !hasPath })\n      }\n    })\n\n    return this\n  }\n  get routes() {\n    return this.middleware\n  }\n  /**\n   * Returns router middleware which dispatches a route matching the request.\n   */\n  middleware() {\n    /**\n     * @type {!_idio.Middleware}\n     */\n    const dispatch = (ctx, next) => {\n      debug('%s %s', ctx.method, ctx.path)\n\n      const path = this.opts.routerPath || ctx.routerPath || ctx.path\n      const matched = this.match(path, ctx.method)\n      let layerChain\n\n      if (ctx.matched) {\n        ctx.matched.push(matched.path)\n      } else {\n        ctx.matched = matched.path\n      }\n\n      ctx.router = this\n\n      if (!matched.route) return next()\n\n      const matchedLayers = matched.pathAndMethod\n      const mostSpecificLayer = matchedLayers[matchedLayers.length - 1]\n      ctx._matchedRoute = mostSpecificLayer.path\n      if (mostSpecificLayer.name) {\n        ctx._matchedRouteName = mostSpecificLayer.name\n      }\n\n      layerChain = matchedLayers.reduce((acc, layer) => {\n        /**\n         * @type {!_idio.Middleware}\n         */\n        const link = (c, n) => {\n          c.captures = layer.captures(path)\n          c.params = layer.params(path, c.captures, c.params)\n          c.routerName = layer.name\n          return n()\n        }\n        acc.push(link)\n        return acc.concat(layer.stack)\n      }, [])\n\n      return compose(layerChain)(ctx, next)\n    }\n\n    dispatch.router = this\n\n    return dispatch\n  }\n}\n\nRouter['url'] = Router.url // eslint-disable-line\n\nexport const methods = METHODS.map((m) => m.toLowerCase())\n\n;[...methods, 'all'].forEach((method) => {\n  /**\n   * A verb.\n   * @this {_goa.Router}\n   */\n  function m(name, path, ...middleware) {\n    let mw\n\n    if (typeof path == 'string' || path instanceof RegExp) {\n      mw = middleware\n    } else {\n      mw = [path, ...middleware]\n      path = name\n      name = null\n    }\n\n    this.register(path, method == 'all' ? methods : [method], mw, {\n      name,\n    })\n\n    return this\n  }\n  Router.prototype[method] = m\n  if (method == 'delete') {\n    Router.prototype['del'] = m\n  }\n})\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').RouterConfig} _goa.RouterConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').AllowedMethodsOptions} _goa.AllowedMethodsOptions\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').Router} _goa.Router\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/idio').Middleware} _idio.Middleware\n */","import Context from '@goa/goa/src/context'\n\n/**\n * @implements {_idio.Context}\n */\nexport default class IdioContext extends Context {\n  constructor() {\n    super()\n    this.session = undefined\n    this.sessionOptions = undefined\n    this.compress = null\n    // router\n    this._matchedRoute = null\n    this._matchedRouteName = null\n    this.params = null\n    this.router = null\n  }\n}","/**\n * @param {!http.Server} server\n */\nexport const enableDestroy = (server) => {\n  /** @type {Object<string, !net.Socket>} */\n  const connections = {}\n  server.on('connection', (con) => {\n    const { remoteAddress, remotePort } = con\n    const k = [remoteAddress, remotePort].join(':')\n    connections[k] = con\n    con.on('close', () => {\n      delete connections[k]\n    })\n  })\n  server.destroy = async () => {\n    await new Promise(r => {\n      server.close(r)\n      for (let k in connections) {\n        connections[k].destroy()\n      }\n    })\n  }\n}\n","import setupMiddleware from './setup-middleware'\nimport Goa from '@goa/goa'\nimport Router from '@goa/router'\n// import Debug from '@idio/debug'\nimport erotic from 'erotic'\nimport IdioContext from './idio'\nimport { enableDestroy } from './lib'\n\n/**\n * @type {_idio.idio}\n */\nasync function $idio(middlewareConfig = {}, config = {}) {\n  const {\n    port = 5000,\n    host = '0.0.0.0',\n    router: routerConfig,\n  } = config\n\n  // close all connections when running nodemon\n  const sigListener = () => {\n    app.destroy().then(() => {\n      process.kill(process.pid, 'SIGUSR2')\n    })\n  }\n  process.once('SIGUSR2', sigListener)\n\n  const appMeta = await createApp(middlewareConfig, routerConfig)\n  const { app, middleware, router } = appMeta\n\n  const server = await listen(app, port, host)\n\n  enableDestroy(server)\n  app.destroy = async () => {\n    await server.destroy()\n    process.removeListener('SIGUSR2', sigListener)\n  }\n  const { port: p } = server.address()\n\n  const url = `http://localhost:${p}`\n\n  return { app, middleware, url, server, router }\n}\n\nexport default $idio\n\n/**\n * @param {!_idio.MiddlewareConfig} [middlewareConfig]\n * @param {!_goa.RouterConfig} [routerConfig]\n */\nexport const createApp = async (middlewareConfig = {}, routerConfig = {}) => {\n  const app = new Goa({\n    Context: IdioContext,\n  })\n\n  const middleware = await setupMiddleware(middlewareConfig, app)\n\n  if (app.env == 'production') {\n    app.proxy = true\n  }\n\n  const router = new Router(routerConfig)\n\n  return {\n    app,\n    middleware,\n    router,\n  }\n}\n\n/**\n * @param {_goa.Application} app\n * @param {number} [port]\n * @param {string} [hostname='0.0.0.0']\n * @return {!Promise<!http.Server>}\n */\nfunction listen(app, port, hostname = '0.0.0.0') {\n  const cb = erotic(true)\n  return new Promise((r, j) => {\n    const ec = (err) => {\n      const e = cb(err)\n      j(e)\n    }\n    /** @type {http.Server} */\n    const server = app.listen(port, hostname, () => {\n      r(server)\n      app.removeListener('error', ec)\n    }).once('error', ec)\n  })\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/goa').Application} _goa.Application\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('http').Server} http.Server\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('net').Socket} net.Socket\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').Config} _idio.Config\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').MiddlewareConfig} _idio.MiddlewareConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').Idio} _idio.Idio\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/goa').Application} _goa.Application\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@goa/router').RouterConfig} _goa.RouterConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types/api').idio} _idio.idio\n */\n","import '../types/modules/externs'\nimport '../types/options/externs'\nimport '../types/externs'\nimport '../types/externs/'\nimport startApp, { Router, createApp, compose, httpErrors, mount, Keygrip } from './'\n\nmodule.exports = {\n  '_createApp': createApp,\n  '_compose': compose,\n  '_startApp': startApp,\n  '_httpErrors': httpErrors,\n  '_mount': mount,\n  '_Keygrip': Keygrip,\n  '_Router': Router,\n}"],
"names":["compose","middleware","Array","isArray","TypeError","fn","context","next","dispatch","i","index","Promise","reject","Error","length","resolve","bind","err","$jscompDefaultExport","codes","populateStatusesMap","redirect","empty","statuses","status","arr","Object","keys","statusCodes","forEach","code","message","s","Number","toLowerCase","push","n","parseInt","isNaN","createError","args","msg","props","arg","statusCode","process","emitWarning","HttpError","String","charAt","captureStackTrace","expose","key","headers","CodeError","name","toIdentifier","className","match","str","split","map","token","slice","toUpperCase","join","replace","assert","equal","tty","format","util","inspect","val","options","type","parse","isFinite","long","msAbs","Math","abs","ms","d","plural","h","m","round","JSON","stringify","exec","parseFloat","y","w","formatThousandsRegExp","formatDecimalsRegExp","pow","value","mag","thousandsSeparator","unitSeparator","decimalPlaces","undefined","fixedDecimals","unit","toFixed","colors","c","string","color","cc","v","inspectOpts","env","filter","test","reduce","obj","prop","substring","_","k","NodeEnv","init","debug","log","stderr","write","formatArgs","namespace","diff","uc","colorCode","prefix","toISOString","Date","save","namespaces","load","useColors","isatty","fd","formatters","o","opts","O","f","getDebug","enabled","curr","prevTime","prev","coerce","unshift","formatter","call","splice","apply","createDebug","instances","selectColor","hash","charCodeAt","enable","names","skips","len","RegExp","substr","instance","Debug","indexOf","setup","destroy","debug.destroy","extend","debug.extend","ns","delimiter","newDebug","stack","node","mount","app","path","p","newPath","trailingSlash","downstream","ctx","upstream","createHmac","_crypto","randomBytes","sign","data","algorithm","encoding","update","digest","x","constantTimeCompare","val1","val2","result","Keygrip","l","sig","nodeRNG","byteToHex","j","toString","v4","buffer","offset","random","rngFn","rng","rnds","ii","buf","Session","sessionContext","_expire","_requireSave","_sessCtx","_ctx","sessionOptions","maxAge","_maxAge","isNew","toJSON","commit","decode","body","Buffer","from","json","encode","initFromExternal","externalKey","get","cookies","store","rolling","valid","create","prevHash","session","sess","_shouldSaveSession","renew","expire","now","ContextSession","ContextStore","initFromCookie","cookie","SyntaxError","set","response","emit","event","setImmediate","genid","beforeSave","remove","reason","changed","optsExternalKey","ONE_DAY","CONTEXT_SESSION","Symbol","formatOpts","extendContext","autoCommit","overwrite","httpOnly","signed","prototype","opts.genid","hasOwnProperty","defineProperties","configurable","FIELD_NAME_REGEXP","append","header","field","fields","vals","includes","fld","end","list","start","Cors","config","allowMethods","exposeHeaders","allowHeaders","credentials","keepHeadersOnError","Origin","cors","requestOrigin","vary","origin","headersSet","method","errHeadersSet","varyWithOrigin","Vary","assign","basename","extname","isAbsolute","normalize","sep","ReadStream","fs","createReadStream","exists","stat","getStackSegment","oneLine","splitStack","item","items","getEntryStack","transparent","stackSegment","getCallerFromArguments","caller","homedir","os","extractPathRegex","pathRegex","homeDir","cleanStack","pretty","ignoredModules","re","source","pathMatches","trim","p1","makeCallback","entryCaller","entryStack","shadow","cb","messageOrError","arguments","errorStack","calleeStackLine","isError","stackMessage","stackHeading","e","properties","erotic","checkArgumentIndex","makePromise","resolveValue","er","fnLength","res","error","allArgs","UP_PATH_REGEXP","resolvePath","rootPath","relativePath","root","cwd","fsExists","fsStat","send","maxage","immutable","hidden","extensions","brotli","gzip","setHeaders","decodeURIComponent","throw","encodingExt","acceptsEncodings","removeHeader","concat","ext","stats","isDirectory","notfound","size","mtime","toUTCString","directives","file","defer","serve","done","db","require","COMPRESSIBLE_TYPE_REGEXP","EXTRACT_TYPE_REGEXP","compressible","mime","isJSON","isBuffer","stream","Z_SYNC_FLUSH","zlib","b","kb","mb","gb","tb","pb","parseRegExp","bytes","results","floatValue","floor","encodingMethods","createGzip","deflate","createDeflate","Compress","threshold","headersSent","writable","compress","request","Stream","pipe","roots","r","Mount","flush","ses","oh","find","found","a","initMiddleware","conf","use","middlewareConstructor","setupMiddleware","middlewareConfig","acc","installed","all","toStr","fnToStr","Function","isFnRegex","hasToStringTag","toStringTag","getProto","getPrototypeOf","generatorFunc","GeneratorFunction","METHODS","http","OutgoingMessage","createServer","events","first","stuff","callback","cleanup","cleanups","ee","removeListener","thunk","listener","on","cancel","onevent","arg1","onFinished","socket","finished","complete","u","readable","attached","__onFinished","queue","createListener","attachFinishedListener","onFinish","eeMsg","eeSocket","onSocket","close","onOpenClose","TEXT_TYPE_REGEXP","types","populateMaps","lookup","preference","exts","to","PARAM_REGEXP","QESC_REGEXP","TYPE_REGEXP","getHeader","ContentType","lastIndex","parameters","typeis","expected","actualParts","expectedParts","typeofrequest","req","ENCODE_URL_ATTR_CHAR_REGEXP","HEX_ESCAPE_REGEXP","NON_LATIN1_REGEXP","QUOTE_REGEXP","TEXT_REGEXP","TOKEN_REGEXP","contentDisposition","filename","fallback","params","createparams","ContentDisposition","isQuotedString","fallbackName","hasFallback","param","sort","encodeURIComponent","encoded","pencode","char","listeners","_update","cache","max","_cache","Map","LRU","getNow","expired","checkEntry","entry","cacheKeys","add","Set","entries","typeLRUCache","matchHtmlRegExp","fieldContentRegExp","sameSiteRegExp","toHeader","expires","domain","sameSite","secure","Cookie","attrs","Cookies","sigName","remote","proto","encrypted","connection","rest","pushCookie","setHeader","simpleCharsetRegExp","parseAcceptCharset","accept","accepts","charset","q","Boolean","preferredCharsets","provided","isQuality","compareSpecs","getFullCharset","priorities","priority","spec","simpleEncodingRegExp","parseAcceptEncoding","hasIdentity","minQuality","specify","min","preferredEncodings","getFullEncoding","getPriority","getEncoding","simpleLanguageRegExp","parseAcceptLanguage","language","parseLanguage","suffix","full","preferredLanguages","getFullLanguage","getLanguage","simpleMediaTypeRegExp","parseAccept","quoteCount","mediaType","parseMediaType","subtype","kvps","splitKeyValuePair","pair","every","preferredMediaTypes","getFullType","getType","count","Negotiator","available","charsets","encodings","languages","mediaTypes","Accepts","negotiator","mimes","extToMime","validMime","getter","target","getters","__defineGetter__","setter","setters","__defineSetter__","Delegator","methods","URL","url","Url","isIP","net","querystring","parseurl","parsed","_parsedUrl","pathname","query","search","_raw","CACHE_CONTROL_NO_CACHE_REGEXP","fresh","reqHeaders","resHeaders","modifiedSince","noneMatch","cacheControl","etag","etagStale","lastModified","modifiedStale","parseHttpDate","date","timestamp","NaN","IP","Request","originalUrl","_querycache","_accept","memoizedURL","protocol","host","qsParse","qsStringify","proxy","httpVersionMajor","hostname","parseContentType","ips","remoteAddress","_ip","subdomainOffset","reverse","lang","referrer","referer","custom","COOKIES","Context","state","respond","idempotent","is","acceptsCharsets","acceptsLanguages","flushHeaders","attachment","ip","stale","subdomains","href","headerSent","httpAssert","getHeaderNames","byteLength","_cookies","Delegate","access","Response","_explicitStatus","_body","getHeaders","isInteger","statusMessage","original","setType","ensureErrorHandler","onerror","trunc","alt","html","escape","mimeType","handleRequest","Application","EventEmitter","NODE_ENV","C","silent","server","listen","_name","listenerCount","createContext","console","lexer","tokens","pattern","prefixes","defaultPattern","escapeString","tryConsume","mustConsume","nextType","consumeText","modifier","open","compile","tokensToFunction","reFlags","flags","validate","matches","optional","repeat","segment","typeOfMessage","sensitive","arrayToRegexp","paths","parts","pathToRegexp","tokensToRegexp","strict","endsWith","route","mod","endToken","isEndDelimited","groups","setPrefix","paramNames","regexp","pathToRegExp","Layer","captures","text","ignoreCaptures","toPath","some","replaced","mw","Router","t","notImplemented","methodNotAllowed","allowed","matched","allowedArr","notImplementedThrowable","notAllowedThrowable","destination","register","routes","layers","layer","pathAndMethod","hasPath","router","nestedLayer","routerPath","matchedLayers","mostSpecificLayer","_matchedRoute","_matchedRouteName","layerChain","link","routerName","IdioContext","enableDestroy","connections","con","remotePort","server.destroy","createApp","routerConfig","Goa","port","ec","once","module","exports","$idio","sigListener","then","kill","pid","appMeta","app.destroy","address","httpErrors"]
}
